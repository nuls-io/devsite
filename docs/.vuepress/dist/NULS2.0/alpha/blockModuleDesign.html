<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Block management module design documents | NULS</title>
    <meta name="description" content="NULS">
    <link rel="icon" href="/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.3751d6d5.css" as="style"><link rel="preload" href="/assets/js/app.0877bdcb.js" as="script"><link rel="preload" href="/assets/js/27.d07d1fcb.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc8f5c2.js"><link rel="prefetch" href="/assets/js/100.d3a152d6.js"><link rel="prefetch" href="/assets/js/101.2a081cb7.js"><link rel="prefetch" href="/assets/js/102.a47ba456.js"><link rel="prefetch" href="/assets/js/103.d5ac9751.js"><link rel="prefetch" href="/assets/js/104.7595a7fc.js"><link rel="prefetch" href="/assets/js/105.828dda8f.js"><link rel="prefetch" href="/assets/js/106.e754f194.js"><link rel="prefetch" href="/assets/js/107.775c5175.js"><link rel="prefetch" href="/assets/js/108.8b1f0e7f.js"><link rel="prefetch" href="/assets/js/109.2f3b3253.js"><link rel="prefetch" href="/assets/js/11.b0ceb74e.js"><link rel="prefetch" href="/assets/js/110.aa04c678.js"><link rel="prefetch" href="/assets/js/111.f62d78bb.js"><link rel="prefetch" href="/assets/js/112.69acd927.js"><link rel="prefetch" href="/assets/js/113.888160f3.js"><link rel="prefetch" href="/assets/js/114.29e41199.js"><link rel="prefetch" href="/assets/js/115.d2ee5369.js"><link rel="prefetch" href="/assets/js/116.51fc87d4.js"><link rel="prefetch" href="/assets/js/117.4c9dc648.js"><link rel="prefetch" href="/assets/js/118.83070636.js"><link rel="prefetch" href="/assets/js/119.665c7995.js"><link rel="prefetch" href="/assets/js/12.02dfbd69.js"><link rel="prefetch" href="/assets/js/120.214bbe7a.js"><link rel="prefetch" href="/assets/js/121.bf9971ed.js"><link rel="prefetch" href="/assets/js/122.7560b52a.js"><link rel="prefetch" href="/assets/js/123.1d267c1f.js"><link rel="prefetch" href="/assets/js/124.f5bbb448.js"><link rel="prefetch" href="/assets/js/125.376b8644.js"><link rel="prefetch" href="/assets/js/126.f44dfff9.js"><link rel="prefetch" href="/assets/js/127.4bfabc7b.js"><link rel="prefetch" href="/assets/js/128.f1386192.js"><link rel="prefetch" href="/assets/js/129.bc8e43b2.js"><link rel="prefetch" href="/assets/js/13.6ff2f0d4.js"><link rel="prefetch" href="/assets/js/130.cacc4ae3.js"><link rel="prefetch" href="/assets/js/131.84d456ba.js"><link rel="prefetch" href="/assets/js/132.2aae8ca6.js"><link rel="prefetch" href="/assets/js/133.1a312ad1.js"><link rel="prefetch" href="/assets/js/134.703ce965.js"><link rel="prefetch" href="/assets/js/135.8cee3887.js"><link rel="prefetch" href="/assets/js/136.b36f5811.js"><link rel="prefetch" href="/assets/js/137.eda59c8e.js"><link rel="prefetch" href="/assets/js/138.551346e5.js"><link rel="prefetch" href="/assets/js/139.3a3f1471.js"><link rel="prefetch" href="/assets/js/14.fa820f23.js"><link rel="prefetch" href="/assets/js/140.1e504789.js"><link rel="prefetch" href="/assets/js/141.4bf908a3.js"><link rel="prefetch" href="/assets/js/142.618b966f.js"><link rel="prefetch" href="/assets/js/143.36491f90.js"><link rel="prefetch" href="/assets/js/144.76d9a156.js"><link rel="prefetch" href="/assets/js/145.be4615d5.js"><link rel="prefetch" href="/assets/js/146.a073f6bd.js"><link rel="prefetch" href="/assets/js/147.fec28542.js"><link rel="prefetch" href="/assets/js/148.1a4b00b2.js"><link rel="prefetch" href="/assets/js/149.6671cebe.js"><link rel="prefetch" href="/assets/js/15.1f656e2a.js"><link rel="prefetch" href="/assets/js/150.75db4652.js"><link rel="prefetch" href="/assets/js/151.b3ee235e.js"><link rel="prefetch" href="/assets/js/152.63fb9894.js"><link rel="prefetch" href="/assets/js/153.852b7cff.js"><link rel="prefetch" href="/assets/js/154.dbd3a07d.js"><link rel="prefetch" href="/assets/js/155.6f6f946b.js"><link rel="prefetch" href="/assets/js/156.8e16b0e8.js"><link rel="prefetch" href="/assets/js/157.8dbfeb43.js"><link rel="prefetch" href="/assets/js/158.919c857b.js"><link rel="prefetch" href="/assets/js/159.09925f42.js"><link rel="prefetch" href="/assets/js/16.aa19419e.js"><link rel="prefetch" href="/assets/js/160.797785d9.js"><link rel="prefetch" href="/assets/js/161.4d34eb09.js"><link rel="prefetch" href="/assets/js/162.94099c67.js"><link rel="prefetch" href="/assets/js/163.9f984d63.js"><link rel="prefetch" href="/assets/js/164.9e26163d.js"><link rel="prefetch" href="/assets/js/165.c8de855f.js"><link rel="prefetch" href="/assets/js/166.d8e0213d.js"><link rel="prefetch" href="/assets/js/167.778d1b2a.js"><link rel="prefetch" href="/assets/js/168.6ad455d7.js"><link rel="prefetch" href="/assets/js/169.f26a480a.js"><link rel="prefetch" href="/assets/js/17.4eef6f4e.js"><link rel="prefetch" href="/assets/js/170.9f0e1298.js"><link rel="prefetch" href="/assets/js/171.fc4a1cfb.js"><link rel="prefetch" href="/assets/js/172.d5c28bec.js"><link rel="prefetch" href="/assets/js/173.2cfc6896.js"><link rel="prefetch" href="/assets/js/174.6ac11f1d.js"><link rel="prefetch" href="/assets/js/175.ff16c02e.js"><link rel="prefetch" href="/assets/js/176.5d7156d4.js"><link rel="prefetch" href="/assets/js/177.89dacd78.js"><link rel="prefetch" href="/assets/js/178.a59d32eb.js"><link rel="prefetch" href="/assets/js/179.a6c468fe.js"><link rel="prefetch" href="/assets/js/18.f6c2f0b8.js"><link rel="prefetch" href="/assets/js/180.ebd647d5.js"><link rel="prefetch" href="/assets/js/181.872ce38a.js"><link rel="prefetch" href="/assets/js/182.0db6d70c.js"><link rel="prefetch" href="/assets/js/183.963128a1.js"><link rel="prefetch" href="/assets/js/184.b537b1fa.js"><link rel="prefetch" href="/assets/js/185.30696c6b.js"><link rel="prefetch" href="/assets/js/186.0ad2973d.js"><link rel="prefetch" href="/assets/js/187.ada551ca.js"><link rel="prefetch" href="/assets/js/188.0bf963be.js"><link rel="prefetch" href="/assets/js/189.39991fc7.js"><link rel="prefetch" href="/assets/js/19.c066ca9d.js"><link rel="prefetch" href="/assets/js/190.7453b0ea.js"><link rel="prefetch" href="/assets/js/191.6f8d2b48.js"><link rel="prefetch" href="/assets/js/192.ffa7a0ae.js"><link rel="prefetch" href="/assets/js/193.6b5187de.js"><link rel="prefetch" href="/assets/js/194.33c85b12.js"><link rel="prefetch" href="/assets/js/195.6ce6baa9.js"><link rel="prefetch" href="/assets/js/196.b7f7795d.js"><link rel="prefetch" href="/assets/js/197.56c70085.js"><link rel="prefetch" href="/assets/js/198.2b4a23bb.js"><link rel="prefetch" href="/assets/js/199.07618bd4.js"><link rel="prefetch" href="/assets/js/2.434158f1.js"><link rel="prefetch" href="/assets/js/20.5171c565.js"><link rel="prefetch" href="/assets/js/200.cd38ef32.js"><link rel="prefetch" href="/assets/js/201.63a35536.js"><link rel="prefetch" href="/assets/js/202.8463e76c.js"><link rel="prefetch" href="/assets/js/203.c2eff4d8.js"><link rel="prefetch" href="/assets/js/204.1b6a7ee2.js"><link rel="prefetch" href="/assets/js/205.84d64836.js"><link rel="prefetch" href="/assets/js/21.db5c56e6.js"><link rel="prefetch" href="/assets/js/22.498863f8.js"><link rel="prefetch" href="/assets/js/23.9f1f092a.js"><link rel="prefetch" href="/assets/js/24.2dd53084.js"><link rel="prefetch" href="/assets/js/25.0460bbcd.js"><link rel="prefetch" href="/assets/js/26.cac7fce9.js"><link rel="prefetch" href="/assets/js/28.af448362.js"><link rel="prefetch" href="/assets/js/29.014f7be8.js"><link rel="prefetch" href="/assets/js/3.944c2fb9.js"><link rel="prefetch" href="/assets/js/30.71024fdc.js"><link rel="prefetch" href="/assets/js/31.a1d400ee.js"><link rel="prefetch" href="/assets/js/32.f6916684.js"><link rel="prefetch" href="/assets/js/33.7a11d236.js"><link rel="prefetch" href="/assets/js/34.2e902b60.js"><link rel="prefetch" href="/assets/js/35.77cbe800.js"><link rel="prefetch" href="/assets/js/36.b4a03b7d.js"><link rel="prefetch" href="/assets/js/37.835e1993.js"><link rel="prefetch" href="/assets/js/38.d905a078.js"><link rel="prefetch" href="/assets/js/39.9a0ea84a.js"><link rel="prefetch" href="/assets/js/4.10b50b1a.js"><link rel="prefetch" href="/assets/js/40.6894dc38.js"><link rel="prefetch" href="/assets/js/41.9abdd72f.js"><link rel="prefetch" href="/assets/js/42.791cbfec.js"><link rel="prefetch" href="/assets/js/43.b4204359.js"><link rel="prefetch" href="/assets/js/44.79523177.js"><link rel="prefetch" href="/assets/js/45.52dab45f.js"><link rel="prefetch" href="/assets/js/46.d45f0044.js"><link rel="prefetch" href="/assets/js/47.66798c19.js"><link rel="prefetch" href="/assets/js/48.2f7186f9.js"><link rel="prefetch" href="/assets/js/49.5efe22f1.js"><link rel="prefetch" href="/assets/js/5.54beffe8.js"><link rel="prefetch" href="/assets/js/50.76124638.js"><link rel="prefetch" href="/assets/js/51.b430df64.js"><link rel="prefetch" href="/assets/js/52.dc55c14c.js"><link rel="prefetch" href="/assets/js/53.32933bde.js"><link rel="prefetch" href="/assets/js/54.5f4ba8e6.js"><link rel="prefetch" href="/assets/js/55.07cb4238.js"><link rel="prefetch" href="/assets/js/56.051d4b4e.js"><link rel="prefetch" href="/assets/js/57.bd3f6e79.js"><link rel="prefetch" href="/assets/js/58.220ce9c8.js"><link rel="prefetch" href="/assets/js/59.896c6030.js"><link rel="prefetch" href="/assets/js/6.0c2e36a1.js"><link rel="prefetch" href="/assets/js/60.936ac7e3.js"><link rel="prefetch" href="/assets/js/61.f607b3ec.js"><link rel="prefetch" href="/assets/js/62.a2eb63e8.js"><link rel="prefetch" href="/assets/js/63.42f2c68e.js"><link rel="prefetch" href="/assets/js/64.ab1a2432.js"><link rel="prefetch" href="/assets/js/65.23af0670.js"><link rel="prefetch" href="/assets/js/66.2cf2b73c.js"><link rel="prefetch" href="/assets/js/67.dd039849.js"><link rel="prefetch" href="/assets/js/68.c1f2396d.js"><link rel="prefetch" href="/assets/js/69.f64d6dc5.js"><link rel="prefetch" href="/assets/js/7.66c6371d.js"><link rel="prefetch" href="/assets/js/70.1b8f30ff.js"><link rel="prefetch" href="/assets/js/71.6abde1ee.js"><link rel="prefetch" href="/assets/js/72.a80f16f5.js"><link rel="prefetch" href="/assets/js/73.6690fcbd.js"><link rel="prefetch" href="/assets/js/74.d7f82bfd.js"><link rel="prefetch" href="/assets/js/75.fc906157.js"><link rel="prefetch" href="/assets/js/76.106a4524.js"><link rel="prefetch" href="/assets/js/77.ad77edec.js"><link rel="prefetch" href="/assets/js/78.10c7b197.js"><link rel="prefetch" href="/assets/js/79.08097c6d.js"><link rel="prefetch" href="/assets/js/8.b37e7034.js"><link rel="prefetch" href="/assets/js/80.c33bd3c0.js"><link rel="prefetch" href="/assets/js/81.c1c8227b.js"><link rel="prefetch" href="/assets/js/82.042ca332.js"><link rel="prefetch" href="/assets/js/83.371427a4.js"><link rel="prefetch" href="/assets/js/84.95658ce6.js"><link rel="prefetch" href="/assets/js/85.e4365ba5.js"><link rel="prefetch" href="/assets/js/86.c5ed5194.js"><link rel="prefetch" href="/assets/js/87.1a56019a.js"><link rel="prefetch" href="/assets/js/88.a0664933.js"><link rel="prefetch" href="/assets/js/89.365bb774.js"><link rel="prefetch" href="/assets/js/9.c34e88ed.js"><link rel="prefetch" href="/assets/js/90.2330af89.js"><link rel="prefetch" href="/assets/js/91.25be9d8a.js"><link rel="prefetch" href="/assets/js/92.7fca59f6.js"><link rel="prefetch" href="/assets/js/93.5d25de24.js"><link rel="prefetch" href="/assets/js/94.52f3f774.js"><link rel="prefetch" href="/assets/js/95.3da9bca5.js"><link rel="prefetch" href="/assets/js/96.24b73c87.js"><link rel="prefetch" href="/assets/js/97.cd2d42fb.js"><link rel="prefetch" href="/assets/js/98.a520e926.js"><link rel="prefetch" href="/assets/js/99.22c2d988.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3751d6d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NULS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/NULS1.0/" class="nav-link">NULS1.0</a></div><div class="nav-item"><a href="/NULS2.0/" class="nav-link router-link-active">NULS2.0</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NULS2.0/alpha/blockModuleDesign.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/NULS1.0/" class="nav-link">NULS1.0</a></div><div class="nav-item"><a href="/NULS2.0/" class="nav-link router-link-active">NULS2.0</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NULS2.0/alpha/blockModuleDesign.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Alpha</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/NULS2.0/quickStart.html" class="sidebar-link">Quick Start</a></li><li><a href="/NULS2.0/packageGeneration.html" class="sidebar-link">Package Generation</a></li><li><a href="/NULS2.0/developModule.html" class="sidebar-link">Develop Business Modules</a></li><li><a href="/NULS2.0/linuxTutorial.html" class="sidebar-link">Linux CLI Manual</a></li><li><a href="/NULS2.0/howToUseNulsBuildChain.html" class="sidebar-link">Build Chain</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/NULS2.0/startSmartContract.html" class="sidebar-link">Quick Start</a></li><li><a href="/NULS2.0/developerManual.html" class="sidebar-link">Development Manual</a></li><li><a href="/NULS2.0/ideaPlugin.html" class="sidebar-link">IDEA Plugin</a></li><li><a href="/NULS2.0/NRC-20TokenStandard.html" class="sidebar-link">NRC-20 Token Standard</a></li><li><a href="/NULS2.0/smartContractFee.html" class="sidebar-link">Service Charge</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="block-management-module-design-documents"><a href="#block-management-module-design-documents" aria-hidden="true" class="header-anchor">#</a> Block management module design documents</h1> <p>[TOC]</p> <h2 id="chapter-1-general-description"><a href="#chapter-1-general-description" aria-hidden="true" class="header-anchor">#</a> Chapter 1. General description</h2> <h3 id="_1-1-the-module-overview"><a href="#_1-1-the-module-overview" aria-hidden="true" class="header-anchor">#</a> 1.1 The module overview</h3> <h4 id="_1-1-1-why-do-you-should-have-the-block-management-module"><a href="#_1-1-1-why-do-you-should-have-the-block-management-module" aria-hidden="true" class="header-anchor">#</a> 1.1.1 Why do you should have the block management module</h4> <p>All transaction data in the blockchain is stored in the block, so there is a module responsible for the saving and management of the block, so that other modules can obtain the block when verifying the data in the block and processing the business etc.</p> <p>When the blockchain program is started for the first time, it is necessary to synchronize the full blocks from the network to the local. This process is generally time consuming, and the transaction cannot be initiated when the synchronization is not completed, so it is suitable for the work to be performed by a separate module.</p> <p>In summary, it is necessary to provide a unified block data service for other modules, and it is also better to separate the management of the block from the specific service of the block. The modules who used the block do not have to care about the details of block's acquire.</p> <h4 id="_1-1-2-block-management-module-s-tasks"><a href="#_1-1-2-block-management-module-s-tasks" aria-hidden="true" class="header-anchor">#</a> 1.1.2 Block management module's tasks</h4> <ol><li><p>When the system starts, it is judged whether the height of the local block reaches the latest height of most nodes on the network. If it is not reached, the block is downloaded from the network to the local, and then the block will be verified. If the verification is passed, the data is saved to the local database. This is called synchronization of blocks.</p></li> <li><p>After the block synchronization is completed, the system starts normal operation.Let's discuss separately below</p></li></ol> <ul><li><p>If the self-node performs the packing block, the consensus module broadcasts the block information to the network before the packaged block is handed over to the block management module. The block management module verifies whether the block is legal, if legal then save it to the database, and respond to requests from other nodes on the network to get this block.</p></li> <li><p>If other nodes on the network are packing blocks, the local node will receive the forwarding block message sent from the network. At this time, the block information is obtained from other nodes, verified and saved.</p></li></ul> <ol start="3"><li><p>In the abnormal case, the block's verification fails, and the new block cannot be connected to the last block on the main chain. The block is regarded as a forked block and placed in the forked chain set for maintenance. When it is found that one of the forked chains A is longer than the main chain B, the switching is performed, and the bifurcation chain A is the latest main chain, and the original main chain B enters the bifurcation chain assembly maintenance.</p></li> <li><p>Provide block header and block's query services for other modules or clients.</p></li></ol> <h4 id="_1-1-3-the-position-of-block-management-module-in-the-system"><a href="#_1-1-3-the-position-of-block-management-module-in-the-system" aria-hidden="true" class="header-anchor">#</a> 1.1.3 The position of block management module in the system</h4> <p>Block management is one of the underlying modules. The following sub-functions discuss module dependencies.</p> <p>rely</p> <ul><li>Block synchronization - depends on the communication interface of the network module, relying on the serialization tool of the tool module</li> <li>Block storage, rollback-dependent tool module database storage tool, consensus module, transaction management module</li> <li>Block forwarding - dependent on the network module's broadcast message interface</li></ul> <p>Be dependent</p> <ul><li>The entire system can initiate transactions - block synchronization</li> <li>Consensus module: block detailed verification, packing - block query, block saving, block broadcasting, block rollback</li></ul> <h3 id="_1-2-architecture-diagram"><a href="#_1-2-architecture-diagram" aria-hidden="true" class="header-anchor">#</a> 1.2 Architecture diagram</h3> <p><img src="/assets/img/block-module.ffc57f74.png" alt></p> <h2 id="chapter-2-functional-design"><a href="#chapter-2-functional-design" aria-hidden="true" class="header-anchor">#</a> Chapter 2. Functional design</h2> <h3 id="_2-1-functional-architecture-diagram"><a href="#_2-1-functional-architecture-diagram" aria-hidden="true" class="header-anchor">#</a> 2.1 Functional architecture diagram</h3> <p><img src="image/block-module/block-functions.png" alt></p> <ol><li>Provide the API to block storage, query, rollback operations.</li> <li>Synchronous latest blocks from the Internet, a preliminary verification, validation, bifurcation without bifurcate, call consensus in a consensus based verification, the trading module dual authentication, all validation after saved to the local.</li> <li>Block synchronization, broadcasting, forwarding message process</li> <li>Fork blocks judgment and storage</li> <li>Fork chains maintenance and switch</li></ol> <h3 id="_2-2-the-module-service"><a href="#_2-2-the-module-service" aria-hidden="true" class="header-anchor">#</a> 2.2 The module service</h3> <h4 id="_2-2-1-get-the-latest-local-block-header"><a href="#_2-2-1-get-the-latest-local-block-header" aria-hidden="true" class="header-anchor">#</a> 2.2.1 Get the latest local block header</h4> <ul><li>Interface specification</li></ul> <ol><li>Query the DB according to the chain ID and the latest block height in the cache to get the latest block header HASH.</li> <li>According to the HASH query DB to get the block header byte array</li> <li>Deserialize to block header object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_bestBlockHeader&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;hash&quot;: &quot;xxxxxxx&quot;,
        &quot;preHash&quot;: &quot;xxxxxxx&quot;,
        &quot;merkleHash&quot;: &quot;1&quot;,
        &quot;height&quot;: 1,
        &quot;size&quot;: 1,
        &quot;time&quot;: 1,
        &quot;txCount&quot;: 1,
        &quot;packingAddress&quot;: &quot;1&quot;,
        &quot;reward&quot;: 0,
        &quot;fee&quot;: 0,
        &quot;extend&quot;: xxxxxxx,HEX
        &quot;scriptSig&quot;: &quot;1&quot;
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>Long</td> <td>chain ID</td></tr> <tr><td>hash</td> <td>String</td> <td>block HASH</td></tr> <tr><td>preHash</td> <td>String</td> <td>pre block HASH</td></tr> <tr><td>merkleHash</td> <td>String</td> <td>block's MerkleHash</td></tr> <tr><td>height</td> <td>Long</td> <td>block height</td></tr> <tr><td>size</td> <td>Integer</td> <td>block size</td></tr> <tr><td>time</td> <td>Long</td> <td>packing timestamp</td></tr> <tr><td>txCount</td> <td>Integer</td> <td>count of transactions</td></tr> <tr><td>packingAddress</td> <td>String</td> <td>packing address</td></tr> <tr><td>reward</td> <td>Long</td> <td>Consensus reward</td></tr> <tr><td>fee</td> <td>Long</td> <td>procedure fee</td></tr> <tr><td>extend</td> <td>String</td> <td>Extension field,HEX,contains roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot</td></tr> <tr><td>scriptSig</td> <td>String</td> <td>block's signature</td></tr></tbody></table> <h4 id="_2-2-2-get-the-latest-local-block"><a href="#_2-2-2-get-the-latest-local-block" aria-hidden="true" class="header-anchor">#</a> 2.2.2 Get the latest local block</h4> <ul><li>Interface specification：</li></ul> <ol><li>Get the latest local block header according to the the chain ID</li> <li>Query the DB according to the block head height to get the transaction HASH list.</li> <li>Obtain transaction data from the transaction management module according to the HASH list</li> <li>Assemble into a block object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_bestBlock&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [“888”]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <pre><code>```
{
    &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
```
</code></pre> <p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
    	&quot;blockHeader&quot;: {
            &quot;chainId&quot;: &quot;888&quot;,
            &quot;hash&quot;: &quot;xxxxxxx&quot;,
            &quot;preHash&quot;: &quot;xxxxxxx&quot;,
            &quot;merkleHash&quot;: &quot;1&quot;,
            &quot;height&quot;: 1,
            &quot;size&quot;: 1,
            &quot;time&quot;: 1,
            &quot;txCount&quot;: 1,
            &quot;packingAddress&quot;: &quot;1&quot;,
            &quot;reward&quot;: 0,
            &quot;fee&quot;: 0,
            &quot;extend&quot;: xxxxxxx,HEX
            &quot;scriptSig&quot;: &quot;1&quot;
    	}, //block header
    	&quot;transactions&quot;: [
    	    {
                &quot;chainId&quot;: &quot;888&quot;, //chain Id
                &quot;height&quot;: &quot;1&quot;, //block height
                &quot;hash&quot;: &quot;1&quot;, //transaction HASH
                &quot;remark&quot;: &quot;1&quot;, //transaction remark
                &quot;size&quot;: &quot;1&quot;, //transaction size
                &quot;time&quot;: &quot;1&quot;, //transaction timestamp
                &quot;type&quot;: &quot;1&quot;, //transaction type
                &quot;transactionSignature&quot;: &quot;1&quot;, //transaction sign
                &quot;coinData&quot;: {
                    &quot;from&quot; : [
                        {
                            “fromAssetsChainId”：“”  
                            “fromAssetsId”：“”
                            “fromAddress”：“”
                            “amount”：“”
                            “nonce”：“”//Transaction sequence number and increasing
                        },{...}
                    ]
                    &quot;to&quot; : [
                        {
                            “toAssetsChainId”：“”
                            “toAssetsId”：“”
                            “toAddress”：“”
                            “amount”：“”
                            “locktime”：“”
                        },{...}
                    ]
                }
                &quot;txData&quot;: XXXX, //Special transaction data HEX
    	    },
    	    {...}
    	], //transaction list
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p> <p>omit</p></li></ul> <h4 id="_2-2-3-get-block-header-according-to-the-height"><a href="#_2-2-3-get-block-header-according-to-the-height" aria-hidden="true" class="header-anchor">#</a> 2.2.3 get block header according to the height</h4> <ul><li>Interface specification</li></ul> <ol><li>Query DB according to the chain ID and height, get the latest block header HASH</li> <li>Query DB according to the HASH to get the block header byte array</li> <li>Deserialize to block header object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockHeaderByHeight&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;111&quot;,&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>height</td> <td>true</td> <td>Long</td> <td style="text-align:center">block's height</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;hash&quot;: &quot;xxxxxxx&quot;,
        &quot;preHash&quot;: &quot;xxxxxxx&quot;,
        &quot;merkleHash&quot;: &quot;1&quot;,
        &quot;height&quot;: 1,
        &quot;size&quot;: 1,
        &quot;time&quot;: 1,
        &quot;txCount&quot;: 1,
        &quot;packingAddress&quot;: &quot;1&quot;,
        &quot;reward&quot;: 0,
        &quot;fee&quot;: 0,
        &quot;extend&quot;: xxxxxxx,HEX
        &quot;scriptSig&quot;: &quot;1&quot;
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>Long</td> <td>chain ID</td></tr> <tr><td>hash</td> <td>String</td> <td>block hash</td></tr> <tr><td>preHash</td> <td>String</td> <td>pre block hash</td></tr> <tr><td>merkleHash</td> <td>String</td> <td>block's MerkleHash</td></tr> <tr><td>height</td> <td>Long</td> <td>block's height</td></tr> <tr><td>size</td> <td>Integer</td> <td>block's size</td></tr> <tr><td>time</td> <td>Long</td> <td>block's packing timestamp</td></tr> <tr><td>txCount</td> <td>Integer</td> <td>count of transactions</td></tr> <tr><td>packingAddress</td> <td>String</td> <td>address of packing</td></tr> <tr><td>reward</td> <td>Long</td> <td>Consensus reward</td></tr> <tr><td>fee</td> <td>Long</td> <td>procedure fee</td></tr> <tr><td>extend</td> <td>String</td> <td>Extension field,HEX,contains roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot</td></tr> <tr><td>scriptSig</td> <td>String</td> <td>Signature of block</td></tr></tbody></table> <h4 id="_2-2-4-get-block-according-to-the-height"><a href="#_2-2-4-get-block-according-to-the-height" aria-hidden="true" class="header-anchor">#</a> 2.2.4 get block according to the height</h4> <ul><li>Interface specification：</li></ul> <ol><li>Get the block header according to the chain ID and height</li> <li>Query the DB according to the block head height to get the transaction HASH list.</li> <li>Obtain transaction data from the transaction management module according to the HASH list</li> <li>Assemble into a block object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockByHeight&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [“111”,&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>height</td> <td>true</td> <td>Long</td> <td style="text-align:center">block's height</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <pre><code>```
{
    &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
```
</code></pre> <p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
    	&quot;blockHeader&quot;: {
            &quot;chainId&quot;: &quot;888&quot;,
            &quot;hash&quot;: &quot;xxxxxxx&quot;,
            &quot;preHash&quot;: &quot;xxxxxxx&quot;,
            &quot;merkleHash&quot;: &quot;1&quot;,
            &quot;height&quot;: 1,
            &quot;size&quot;: 1,
            &quot;time&quot;: 1,
            &quot;txCount&quot;: 1,
            &quot;packingAddress&quot;: &quot;1&quot;,
            &quot;reward&quot;: 0,
            &quot;fee&quot;: 0,
            &quot;extend&quot;: xxxxxxx,HEX
            &quot;scriptSig&quot;: &quot;1&quot;
    	}, //block header
    	&quot;transactions&quot;: [
    	    {
                &quot;chainId&quot;: &quot;888&quot;,//chain ID
                &quot;height&quot;: &quot;1&quot;, //block's height
                &quot;hash&quot;: &quot;1&quot;, //transaction's hash
                &quot;remark&quot;: &quot;1&quot;, //transaction's remark
                &quot;size&quot;: &quot;1&quot;, //transaction's size
                &quot;time&quot;: &quot;1&quot;, //transaction's timestamp
                &quot;type&quot;: &quot;1&quot;, //transaction's type
                &quot;transactionSignature&quot;: &quot;1&quot;, //transaction's sign
                &quot;coinData&quot;: {
                    &quot;from&quot; : [
                        {
                            “fromAssetsChainId”：“”  
                            “fromAssetsId”：“”
                            “fromAddress”：“”
                            “amount”：“”
                            “nonce”：“”
                        },{...}
                    ]
                    &quot;to&quot; : [
                        {
                            “toAssetsChainId”：“”  
                            “toAssetsId”：“”
                            “toAddress”：“”
                            “amount”：“”
                            “nonce”：“”
                        },{...}
                    ]
                }
                &quot;txData&quot;: XXXX, //HEX
    	    },
    	    {...}
    	], 
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p> <p>omit</p></li></ul> <h4 id="_2-2-5-get-block-header-according-to-the-hash"><a href="#_2-2-5-get-block-header-according-to-the-hash" aria-hidden="true" class="header-anchor">#</a> 2.2.5 get block header according to the hash</h4> <ul><li>Interface specification</li></ul> <ol><li>According to the chain ID, HASH query DB to get the block header byte array</li> <li>Deserialize to block header object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockHeaderByHash&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;,&quot;aaa&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>hash</td> <td>true</td> <td>String</td> <td style="text-align:center">block hash</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;hash&quot;: &quot;xxxxxxx&quot;,
        &quot;preHash&quot;: &quot;xxxxxxx&quot;,
        &quot;merkleHash&quot;: &quot;1&quot;,
        &quot;height&quot;: 1,
        &quot;size&quot;: 1,
        &quot;time&quot;: 1,
        &quot;txCount&quot;: 1,
        &quot;packingAddress&quot;: &quot;1&quot;,
        &quot;reward&quot;: 0,
        &quot;fee&quot;: 0,
        &quot;extend&quot;: xxxxxxx,HEX
        &quot;scriptSig&quot;: &quot;1&quot;
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>Long</td> <td>chain ID</td></tr> <tr><td>hash</td> <td>String</td> <td>block hash</td></tr> <tr><td>preHash</td> <td>String</td> <td>pre block hash</td></tr> <tr><td>merkleHash</td> <td>String</td> <td>block's MerkleHash</td></tr> <tr><td>height</td> <td>Long</td> <td>block's height</td></tr> <tr><td>size</td> <td>Integer</td> <td>block's size</td></tr> <tr><td>time</td> <td>Long</td> <td>block's packing timestamp</td></tr> <tr><td>txCount</td> <td>Integer</td> <td>count of transactions</td></tr> <tr><td>packingAddress</td> <td>String</td> <td>address of packing</td></tr> <tr><td>reward</td> <td>Long</td> <td>Consensus reward</td></tr> <tr><td>fee</td> <td>Long</td> <td>procedure fee</td></tr> <tr><td>extend</td> <td>String</td> <td>Extension field,HEX,contains roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot</td></tr> <tr><td>scriptSig</td> <td>String</td> <td>Signature of block</td></tr></tbody></table> <h4 id="_2-2-6-get-block-according-to-the-hash"><a href="#_2-2-6-get-block-according-to-the-hash" aria-hidden="true" class="header-anchor">#</a> 2.2.6 get block according to the hash</h4> <ul><li>Interface specification：</li></ul> <ol><li>Get the block header according to the chain ID and hash</li> <li>Query the DB according to the block head height to get the transaction HASH list.</li> <li>Obtain transaction data from the transaction management module according to the HASH list</li> <li>Assemble into a block object</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockByHash&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;,“aaa”]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>hash</td> <td>true</td> <td>String</td> <td style="text-align:center">block hash</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <pre><code>```
{
    &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
```
</code></pre> <p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
    	&quot;blockHeader&quot;: {
    	    &quot;chainId&quot;: &quot;888&quot;,
            &quot;hash&quot;: &quot;xxxxxxx&quot;,
            &quot;preHash&quot;: &quot;xxxxxxx&quot;,
            &quot;merkleHash&quot;: &quot;1&quot;,
            &quot;height&quot;: 1,
            &quot;size&quot;: 1,
            &quot;time&quot;: 1,
            &quot;txCount&quot;: 1,
            &quot;packingAddress&quot;: &quot;1&quot;,
            &quot;reward&quot;: 0,
            &quot;fee&quot;: 0,
            &quot;extend&quot;: xxxxxxx,HEX
            &quot;scriptSig&quot;: &quot;1&quot;
    	}, //block header
    	&quot;transactions&quot;: [
    	    {
    	        &quot;chainId&quot;: &quot;888&quot;,
                &quot;height&quot;: &quot;1&quot;, //block's height
                &quot;hash&quot;: &quot;1&quot;, //transaction's hash
                &quot;remark&quot;: &quot;1&quot;, //transaction's remark
                &quot;size&quot;: &quot;1&quot;, //transaction's size
                &quot;time&quot;: &quot;1&quot;, //transaction's timestamp
                &quot;type&quot;: &quot;1&quot;, //transaction's type
                &quot;transactionSignature&quot;: &quot;1&quot;, //transaction's sign
                &quot;coinData&quot;: {
                    &quot;from&quot; : [
                        {
                            “fromAssetsChainId”：“”  
                            “fromAssetsId”：“”
                            “fromAddress”：“”
                            “amount”：“”
                            “nonce”：“”
                        },{...}
                    ]
                    &quot;to&quot; : [
                        {
                            “toAssetsChainId”：“”  
                            “toAssetsId”：“”
                            “toAddress”：“”
                            “amount”：“”
                            “nonce”：“”
                        },{...}
                    ]
                }
                &quot;txData&quot;: XXXX, //HEX
    	    },
    	    {...}
    	], 
    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p> <p>omit</p></li></ul> <h4 id="_2-2-7-get-sync-status"><a href="#_2-2-7-get-sync-status" aria-hidden="true" class="header-anchor">#</a> 2.2.7 get sync status</h4> <ul><li>Interface specification</li></ul> <p>When the block synchronization on a ChainID is completed, the cached synchronization status identifier is updated. It is forbidden to initiate a transaction when the block synchronization is not completed.</p> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getSynchronizeInfo&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {&quot;sync&quot;: &quot;true&quot;}
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>sync</td> <td>String</td> <td>Block the synchronization to be achieved</td></tr></tbody></table> <h4 id="_2-2-8-get-block-header-according-to-the-height-range"><a href="#_2-2-8-get-block-header-according-to-the-height-range" aria-hidden="true" class="header-anchor">#</a> 2.2.8 get block header according to the height range</h4> <ul><li>Interface specification</li></ul> <ol><li>Make queryHash = endHash</li> <li>Query DB according to queryHash to get block header byte array</li> <li>Deserialization for block header object blockHeader, added to the List as a return value</li> <li>If the blockHeader.Hash!= startHash, make queryHash = blockHeader.preHash, repeat step 2</li> <li>Return to the List</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockHeaderBetweenHeights&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;,111&quot;,&quot;111&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>startHeight</td> <td>true</td> <td>Long</td> <td style="text-align:center">start Height</td></tr> <tr><td>2</td> <td>endHeight</td> <td>true</td> <td>Long</td> <td style="text-align:center">end Height</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        “list” : [
            {
           &quot;chainId&quot;: &quot;888&quot;,
           &quot;hash&quot;: &quot;xxxxxxx&quot;,
           &quot;preHash&quot;: &quot;xxxxxxx&quot;,
           &quot;merkleHash&quot;: &quot;1&quot;,
           &quot;height&quot;: 1,
           &quot;size&quot;: 1,
           &quot;time&quot;: 1,
           &quot;txCount&quot;: 1,
           &quot;packingAddress&quot;: &quot;1&quot;,
           &quot;reward&quot;: 0,
           &quot;fee&quot;: 0,
           &quot;extend&quot;: xxxxxxx,HEX
           &quot;scriptSig&quot;: &quot;1&quot;
           }
        ]

    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>Long</td> <td>chain ID</td></tr> <tr><td>hash</td> <td>String</td> <td>block hash</td></tr> <tr><td>preHash</td> <td>String</td> <td>pre block hash</td></tr> <tr><td>merkleHash</td> <td>String</td> <td>block's MerkleHash</td></tr> <tr><td>height</td> <td>Long</td> <td>block's height</td></tr> <tr><td>size</td> <td>Integer</td> <td>block's size</td></tr> <tr><td>time</td> <td>Long</td> <td>block's packing timestamp</td></tr> <tr><td>txCount</td> <td>Integer</td> <td>count of transactions</td></tr> <tr><td>packingAddress</td> <td>String</td> <td>address of packing</td></tr> <tr><td>reward</td> <td>Long</td> <td>Consensus reward</td></tr> <tr><td>fee</td> <td>Long</td> <td>procedure fee</td></tr> <tr><td>extend</td> <td>String</td> <td>Extension field,HEX,contains roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot</td></tr> <tr><td>scriptSig</td> <td>String</td> <td>Signature of block</td></tr></tbody></table> <h4 id="_2-2-9-get-block-according-to-the-height-range"><a href="#_2-2-9-get-block-according-to-the-height-range" aria-hidden="true" class="header-anchor">#</a> 2.2.9 get block according to the height range</h4> <ul><li>Interface specification</li></ul> <ol><li>make queryHash=endHash</li> <li>Query DB according to the chain ID, queryHash to get the block byte array</li> <li>Deserialize to block object block, add to List as return value</li> <li>If block.hash!=startHash, make queryHash=block.preHash, repeat step 2</li> <li>Return to List</li></ol> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_getBlockBetweenHeights&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;,111&quot;,&quot;111&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">chain ID</td></tr> <tr><td>1</td> <td>startHeight</td> <td>true</td> <td>Long</td> <td style="text-align:center">start Height</td></tr> <tr><td>2</td> <td>endHeight</td> <td>true</td> <td>Long</td> <td style="text-align:center">end Height</td></tr></tbody></table> <ul><li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        “list” : [
            {
                &quot;blockHeader&quot;: {
                    &quot;chainId&quot;: &quot;888&quot;,
                    &quot;hash&quot;: &quot;xxxxxxx&quot;,
                    &quot;preHash&quot;: &quot;xxxxxxx&quot;,
                    &quot;merkleHash&quot;: &quot;1&quot;,
                    &quot;height&quot;: 1,
                    &quot;size&quot;: 1,
                    &quot;time&quot;: 1,
                    &quot;txCount&quot;: 1,
                    &quot;packingAddress&quot;: &quot;1&quot;,
                    &quot;reward&quot;: 0,
                    &quot;fee&quot;: 0,
                    &quot;extend&quot;: xxxxxxx,HEX
                    &quot;scriptSig&quot;: &quot;1&quot;
                }, //block header
                &quot;transactions&quot;: [
                    {
                        &quot;chainId&quot;: &quot;888&quot;,
                        &quot;height&quot;: &quot;1&quot;, //block's height
                        &quot;hash&quot;: &quot;1&quot;, //transaction's hash
                        &quot;remark&quot;: &quot;1&quot;, //transaction's remark
                        &quot;size&quot;: &quot;1&quot;, //transaction's size
                        &quot;time&quot;: &quot;1&quot;, //transaction's timestamp
                        &quot;type&quot;: &quot;1&quot;, //transaction's type
                        &quot;transactionSignature&quot;: &quot;1&quot;, //transaction's sign
                        &quot;coinData&quot;: {
                            &quot;from&quot; : [
                                {
                                    “fromAssetsChainId”：“”  
                                    “fromAssetsId”：“”
                                    “fromAddress”：“”
                                    “amount”：“”
                                    “nonce”：“”
                                },{...}
                            ]
                            &quot;to&quot; : [
                                {
                                    “toAssetsChainId”：“”  
                                    “toAssetsId”：“”
                                    “toAddress”：“”
                                    “amount”：“”
                                    “nonce”：“”
                                },{...}
                            ]
                        }
                        &quot;txData&quot;: XXXX, //HEX
                    },
                    {...}
                ], 
           }
        ]

    }
}
</code></pre></div></li> <li><p>Instructions of response parameters</p> <p>omit</p></li></ul> <h4 id="_2-2-10-receive-the-latest-packaging-block"><a href="#_2-2-10-receive-the-latest-packaging-block" aria-hidden="true" class="header-anchor">#</a> 2.2.10 Receive the latest packaging block</h4> <ul><li>Interface specification</li></ul> <p>After the local node's consensus module paking a block, this interface is called to save the block data.</p> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_receivePackingBlock&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [
  	blockhex
  ]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p> <p>omit</p></li> <li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {&quot;sync&quot;: &quot;true&quot;}
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>sync</td> <td>String</td> <td>wherther the Block's save is completed</td></tr></tbody></table> <h4 id="_2-2-11-run-a-chain"><a href="#_2-2-11-run-a-chain" aria-hidden="true" class="header-anchor">#</a> 2.2.11 run a chain</h4> <ul><li>Interface specification</li></ul> <p>After the chain factory releases a chain, the core module calls the interface of the block management module, initializes the block and the forked chain database according to the chainID, starts a series of work threads corresponding to the chainID, and prepares for running the new chain.</p> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_startChain&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p> <p>omit</p></li> <li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {&quot;result&quot;: &quot;true&quot;}
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>result</td> <td>String</td> <td>whether the new chain started successfully</td></tr></tbody></table> <h4 id="_2-2-12-stop-a-chain"><a href="#_2-2-12-stop-a-chain" aria-hidden="true" class="header-anchor">#</a> 2.2.12 stop a chain</h4> <ul><li>Interface specification</li></ul> <p>After stopping a chain in the chain factory, the core module will call the interface of the block management module, delete the cache block and the fork chain data of the chain, and stop a series of work threads corresponding to the chainID.</p> <ul><li><p>Sample request</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;bl_stopChain&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Instructions of request parameters</p> <p>omit</p></li> <li><p>response sample</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {&quot;result&quot;: &quot;true&quot;}
}
</code></pre></div></li> <li><p>Instructions of response parameters</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>result</td> <td>String</td> <td>whether the new chain started successfully</td></tr></tbody></table> <h3 id="_2-3-module-s-internal-function"><a href="#_2-3-module-s-internal-function" aria-hidden="true" class="header-anchor">#</a> 2.3 module's internal function</h3> <h4 id="_2-3-1-module-s-boot"><a href="#_2-3-1-module-s-boot" aria-hidden="true" class="header-anchor">#</a> 2.3.1 module's boot</h4> <ul><li><p>Functional specifications：</p> <p>omit</p></li> <li><p>process description</p></li></ul> <p><img src="/assets/img/block-module-boot.4686b7bf.png" alt></p> <ol><li>Load block module configuration information</li> <li>Register block module's message handlers</li> <li>Register block module's service interfaces</li> <li>Register block module's events</li> <li>Start the synchronization thread, the block monitoring thread, branching chain processing thread.</li></ol> <ul><li><p>Dependent service</p> <p>Tool module、kernel module</p></li></ul> <h4 id="_2-3-2-block-s-storage"><a href="#_2-3-2-block-s-storage" aria-hidden="true" class="header-anchor">#</a> 2.3.2 block's storage</h4> <ul><li>Functional specifications：</li></ul> <p>Description storage table division</p> <ul><li>main chain's storage</li></ul> <p>A complete block consists of a block header and a transaction, and the block header is stored separately from the transaction.
Block header: (in the block management module)
Key(block's height)-value(block header hash) block-header-index
Key(block headerhash)-value(complete block header) block-header
Trading: (put in the transaction management module)</p> <ul><li><p>fork chain's storage
Cache each forked chain (starting height, starting hash, ending height, ending hash) in memory, and cache full forked chain data in the hard disk
         There are different tables for the bifurcation chain collection of different chains. The table name is added with the chainID suffix. Each bifurcation chain object is as follows:
             Key (start block height + start block hash) - value (complete chains) fork chains
         Private chain chain;
                 Private String id;
                 Private String preChainId;
                 Private BlockHeader startBlockHeader;
                 Private BlockHeader endBlockHeader;
                 Private List<BlockHeader> blockHeaderList;
                 Private List<Block> blockList;</Block></BlockHeader></p></li> <li><p>process description</p> <p>omit</p></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-2-block-s-synchronization"><a href="#_2-3-2-block-s-synchronization" aria-hidden="true" class="header-anchor">#</a> 2.3.2 block's Synchronization</h4> <ul><li><p>Functional specifications：</p> <p>omit</p></li> <li><p>process description</p> <ul><li>Block synchronization main flow</li></ul> <p><img src="/assets/img/block-synchronization.3b5f0ded.png" alt></p> <ul><li>Get a list of available nodes on the network</li></ul> <div class="language- extra-class"><pre class="language-text"><code>    1. Traverse the node and count the two MAPs, assuming that each node (the latest HASH+ latest height) is the key
    2. A key with the key as the number of statistics
    3. A key is used to record the list of nodes holding the key.
    4. Finally, the most frequently occurring key is obtained, and the current trusted latest height and latest hash, as well as the list of trusted nodes are obtained.
    
    for example:
    Now connect to 10 nodes at the same time. The latest block's height of 4 nodes (A, B, C, D) is 100, the latest block hash is aaa, and the latest block's height of 6 nodes (E, F, G, H, I, J) is 101. The latest block hash is bbb.
    Finally return (101, bbb, [E, F, G, H, I, J]).
</code></pre></div><ul><li>Download block logic</li></ul> <p><img src="/assets/img/block-synchronization2.1bde323a.png" alt></p> <div class="language- extra-class"><pre class="language-text"><code>        Before the official download of the block, it is necessary to determine whether the local and the network are forked, and whether it needs to be rolled back. In order to find the exact block download height.
        The following discussion is divided into:
        Take the result of the previous step (101, bbb, [E, F, G, H, I, J]), while LH(N) represents the hash of the local Nth block, and RH(N) represents the hash of the Nth block on the network. .
        1. Local height 100 &lt; network height 101, LH (100) == RH (100), normal, behind the remote node, download block
        2. Local height 100 &lt; network height 101, LH (100)! = RH (100), think local fork, roll back the local block, if LH (99) == RH (99)
        At the end of the rollback, download from 99 blocks. If LH(99)!=RH(99), continue to roll back and repeat the above logic. However, if you roll back 10 blocks at most, it will stop and wait for the next synchronization. This will avoid being attacked by malicious nodes and roll back normal blocks in large quantities.
        3. Local height 102&gt; network height 101, LH (101) == RH (101), normal, leading than remote node, no need to download block
        4. Local height 102&gt; network height 101, LH (101)! = RH (101), think local fork, first roll back to the height and remote consistency, repeat scene 2
        5. Local height 101 = network height 101, LH (101) == RH (101), normal, consistent with the remote node, no need to download the block
        6. Local height 101 = network height 101, LH (101)! = RH (101), think local fork, repeat scene 2
        
        In the scenario that needs to be rolled back, the number of available nodes (10) &gt; configuration, the number of consistent available nodes (6) accounted for more than 80%, and avoiding too few nodes leads to frequent rollback. The above two conditions are not met, empty the connected nodes, and re-acquire the available nodes.
 
        When you actually download the block, give a chestnut:
        The current height is 100, the network height is 500, 12 nodes are available, 10 nodes are consistently available, and each node downloads 2 blocks at a time.
        Then calculate that you need to download 400 blocks, 400/(2*10)=20 rounds of downloading, and you can calculate the height range of each node download block per round.
        Pseudo code representation
            For (20 rounds){
                For (10 nodes) {
                    Each node downloads the corresponding block and puts it in the shared queue for the block verification thread to process
                }
            }
        Consider the case where the node is dropped during the download process. It is possible that 20 rounds cannot be downloaded, so the outer layer is added to the loop.
            While (not downloaded){
                Recalculate the round, download the block's height interval for each node
                For (20 rounds){
                    For (10 nodes) {
                        Each node downloads the corresponding block and puts it in the shared queue for the block verification thread to process
                    }
                }
            }
</code></pre></div><ul><li>Download blocks from a height interval from a node</li></ul> <p><img src="/assets/img/block-synchronization3.99496017.png" alt></p></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules、RPC tool</p></li></ul> <h4 id="_2-3-3-block-s-validation"><a href="#_2-3-3-block-s-validation" aria-hidden="true" class="header-anchor">#</a> 2.3.3 block's validation</h4> <ul><li><p>Functional specifications：</p> <p>Verify the correctness of the block's own data, verify during the download process, verify that there is no problem with the block data itself, and discard the block if the verification fails.</p></li> <li><p>process description</p> <ul><li>block's basic validation</li></ul> <p><img src="/assets/img/block-basic-validation.07557d70.png" alt></p> <ul><li>block header's validation</li></ul> <p><img src="/assets/img/block-basic-validation1.cf392d66.png" alt></p> <ul><li>Merkelhash validation</li></ul> <p><img src="/assets/img/block-basic-validation2.ed057a96.png" alt></p></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-4-fork-block-management"><a href="#_2-3-4-fork-block-management" aria-hidden="true" class="header-anchor">#</a> 2.3.4 fork block management</h4> <ul><li><p>Functional specifications：</p> <p>Verify the correctness of the block context. After the download is complete, verify that the block is connected to the main chain.
The verification failure indicates that the block is bifurcated and enters the forked chain processing logic.</p></li> <li><p>process description</p> <ul><li>Define a main chain (MasterChain), a fork chain set (forkChains)
    - Define the block to be verified as Block
    - Define the main chain height MG, to be verified block's heightBG
    - Define the latest block HASH of the main chain as MH, the HASH of the block to be verified is BH, and the PHHASH of the block to be verified is BPH
    
    - Discussion in six situations
    - 1.MG==BG, MH==BH, indicating that the latest main chain block is repeatedly received and discarded.
    - 2.MG==BG, MH!=BH, indicating network fork
        - Traverse the existing set of forked chains to determine if this block already exists
            - discard the block if it already exists
            - If it does not exist, create a new fork chain
              - Determine if you can connect to other fork chains (if you can connect, connect to other fork chains as a chain)
              - Recursive judgment
    - 3.MG==BG-1, MH==BPH, indicating that the block is continuous and saved to the main chain
    - 4.MG==BG-1, MH!=BPH, indicating network fork, processing the same as step 2
    - 5.MG&lt;BG-1, indicating network fork, processing the same as step 2
    - 6.MG&gt;BG, indicating network fork, processing the same as step 2
    
    The height difference is less than 1000 cached to disk, the disk space is limited in size, and the height is discarded.
If the cache space is full, the forked chain is cleared in the order of adding cache time.</li></ul></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-5-fork-chain-management"><a href="#_2-3-5-fork-chain-management" aria-hidden="true" class="header-anchor">#</a> 2.3.5 fork chain management</h4> <ul><li><p>Functional specifications：</p> <p>Determine if the fork chain and the main chain need to be switched</p></li> <li><p>process description
​</p> <ul><li>Check if there is an orphan chain that links to the main chain or the forked chain, if any</li> <li>Take the longest one of the fork chains and compare the length of the main chain to determine whether you need to switch the main chain
<ul><li>If the length of the fork chain is longer than the length of the main chain by 3 (configured), you need to switch the main chain.</li> <li>Find the bifurcation point of the main chain and the longest bifurcation chain</li> <li>Verify the block in the forked chain if the verification continues by going down</li> <li>Roll back the main chain block</li> <li>Switch the fork chain as the main chain</li></ul></li></ul></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-6-forward-block"><a href="#_2-3-6-forward-block" aria-hidden="true" class="header-anchor">#</a> 2.3.6 forward block</h4> <ul><li><p>Functional specifications：</p> <p>omit</p></li> <li><p>process description</p></li></ul> <ol><li>Use the blockHash to assemble the ForwardSmallBlockMessage and send it to the target node.</li> <li>After receiving the ForwardSmallBlockMessage, the target node takes out the hash to determine whether it is duplicated. If it does not repeat, use the hash assembly GetSmallBlockMessage to send to the source node.</li> <li>After the source node receives the GetSmallBlockMessage, it takes out the hash, queries the SmallBlock and assembles the SmallBlockMessage, and sends it to the target node.</li> <li>Subsequent interaction process reference broadcast block</li></ol> <ul><li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-7-braodcast-block"><a href="#_2-3-7-braodcast-block" aria-hidden="true" class="header-anchor">#</a> 2.3.7 braodcast block</h4> <ul><li><p>Functional specifications：</p> <p>omit</p></li> <li><p>process description</p></li></ul> <ol><li>Get BlockHeader, TxList according to HASH, assemble into SmallBlock,</li> <li>Put a SmallBlock into the memory. If it is not deleted actively, it will be automatically cleared when the cache is full or exists for more than 1000 seconds.</li> <li>Local cache blockHash for filtering duplicate downloads</li> <li>Assem the SmallBlockMessage and call the RPC module to send a message to the target node.</li> <li>After receiving the message, the target node determines which transactions are not locally based on txHashList, and then assembles GetTxGroupRequest to the source node.</li> <li>After receiving the information, the source node assembles the TxGroupMessage according to the hashlist and returns it to the target node.</li> <li>All block data has been sent to the target node.</li></ol> <ul><li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h4 id="_2-3-8-block-monitoring"><a href="#_2-3-8-block-monitoring" aria-hidden="true" class="header-anchor">#</a> 2.3.8 Block monitoring</h4> <ul><li><p>Functional specifications：</p> <p>omit</p></li> <li><p>process description</p> <ul><li>Start monitoring scheduled tasks, once every minute</li> <li>Take the local latest block header</li> <li>Verify that the network module needs to be restarted (if the latest local block has not been updated for 3 minutes, the network module needs to be disconnected and reconnected randomly)</li> <li>to be perfected</li></ul></li> <li><p>Dependent service</p> <p>Database storage tool of tool modules</p></li></ul> <h2 id="chapter-3-events"><a href="#chapter-3-events" aria-hidden="true" class="header-anchor">#</a> Chapter 3. Events</h2> <h3 id="_3-1-published-event"><a href="#_3-1-published-event" aria-hidden="true" class="header-anchor">#</a> 3.1 published event</h3> <h4 id="_3-1-1-synchronization-completed"><a href="#_3-1-1-synchronization-completed" aria-hidden="true" class="header-anchor">#</a> 3.1.1 Synchronization completed</h4> <p>Description: The synchronization is completed. When the height of the area is the same as the height of the network, the event is released.</p> <p>Event_topic : &quot;bl_blockSyncComplete&quot;,</p> <div class="language- extra-class"><pre class="language-text"><code>Data:{
     chainId
     Height
     Hash
}
</code></pre></div><h4 id="_3-1-2-save-block-event"><a href="#_3-1-2-save-block-event" aria-hidden="true" class="header-anchor">#</a> 3.1.2 save block event</h4> <p>Description：Each save a block, release the event</p> <p>event_topic : &quot;evt_bl_saveBlock&quot;,</p> <div class="language- extra-class"><pre class="language-text"><code>data:{
    chainId
    height
    hash
}
</code></pre></div><h4 id="_3-1-3-rollback-block-event"><a href="#_3-1-3-rollback-block-event" aria-hidden="true" class="header-anchor">#</a> 3.1.3 rollback block event</h4> <p>Description：Each roll back a block, release the event</p> <p>event_topic : &quot;evt_bl_rollbackBlock&quot;,</p> <div class="language- extra-class"><pre class="language-text"><code>data:{
    chainId
    height
    hash
}
</code></pre></div><h3 id="_3-2-subscribed-event"><a href="#_3-2-subscribed-event" aria-hidden="true" class="header-anchor">#</a> 3.2 Subscribed event</h3> <pre><code>omit
</code></pre> <h2 id="chapter-4-network-message"><a href="#chapter-4-network-message" aria-hidden="true" class="header-anchor">#</a> Chapter 4. Network Message</h2> <h3 id="_4-1-network-communication-protocol"><a href="#_4-1-network-communication-protocol" aria-hidden="true" class="header-anchor">#</a> 4.1 Network communication protocol</h3> <pre><code>omit
</code></pre> <h3 id="_4-2-message-protocol"><a href="#_4-2-message-protocol" aria-hidden="true" class="header-anchor">#</a> 4.2 Message protocol</h3> <h4 id="_4-2-1-forward-block-message-forwardsmallblockmessage"><a href="#_4-2-1-forward-block-message-forwardsmallblockmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.1 Forward block message-ForwardSmallBlockMessage</h4> <ul><li><p>Message description：Used for the &quot;forward block&quot; function</p></li> <li><p>Message type（cmd）</p> <p>ForwardSmallBlock</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>hashLength</td> <td>VarInt</td> <td>array's length</td></tr> <tr><td>?</td> <td>hash</td> <td>byte[]</td> <td>hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>After receiving the message, the target node first determines whether the hash in the cache is duplicated according to the chainID.</li> <li>If it is repeated, it indicates that the SmallBlock forwarded by another node has been received, and the message is discarded.</li> <li>If there is no duplication, assemble GetSmallBlockMessage with hash and send it to the source node.</li></ol> <h4 id="_4-2-2-get-small-block-message-getsmallblockmessage"><a href="#_4-2-2-get-small-block-message-getsmallblockmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.2 Get small block message-GetSmallBlockMessage</h4> <ul><li><p>Message description：Used for the &quot;forward block&quot; function</p></li> <li><p>Message type（cmd）</p> <p>GetSmallBlock</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>hashLength</td> <td>VarInt</td> <td>array's length</td></tr> <tr><td>?</td> <td>hash</td> <td>byte[]</td> <td>hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Get the SmallBlock object according to the hash</li> <li>Assem the SmallBlockMessage and send it to the source node</li></ol> <h4 id="_4-2-3-block-broadcast-message-smallblockmessage"><a href="#_4-2-3-block-broadcast-message-smallblockmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.3 Block broadcast message-SmallBlockMessage</h4> <ul><li><p>Message description：Used for &quot;forwarding block&quot; and &quot;broadcast block&quot; functions</p></li> <li><p>Message type（cmd）</p> <p>SmallBlock</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>preHashLength</td> <td>VarInt</td> <td>preHash array's length</td></tr> <tr><td>?</td> <td>preHash</td> <td>byte[]</td> <td>preHash</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>merkleHashLength</td> <td>VarInt</td> <td>merkleHash array's length</td></tr> <tr><td>?</td> <td>merkleHash</td> <td>byte[]</td> <td>merkleHash</td></tr> <tr><td>48</td> <td>time</td> <td>Uint48</td> <td>time</td></tr> <tr><td>32</td> <td>height</td> <td>Uint32</td> <td>block's height</td></tr> <tr><td>32</td> <td>txCount</td> <td>Uint32</td> <td>count of transactions</td></tr> <tr><td>?</td> <td>extendLength</td> <td>VarInt</td> <td>extend array's length</td></tr> <tr><td>?</td> <td>extend</td> <td>byte[]</td> <td>extend</td></tr> <tr><td>32</td> <td>publicKeyLength</td> <td>Uint32</td> <td>public key array's length</td></tr> <tr><td>?</td> <td>publicKey</td> <td>byte[]</td> <td>public key</td></tr> <tr><td>1</td> <td>signAlgType</td> <td>byte</td> <td>Signature algorithm type</td></tr> <tr><td>?</td> <td>signBytesLength</td> <td>VarInt</td> <td>sign array's length</td></tr> <tr><td>?</td> <td>signBytes</td> <td>byte[]</td> <td>sign bytes</td></tr> <tr><td>?</td> <td>txHashListLength</td> <td>VarInt</td> <td>transaction's hash list array's length</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>txHashLength</td> <td>VarInt</td> <td>transaction's hash array's length</td></tr> <tr><td>?</td> <td>txHash</td> <td>byte[]</td> <td>transaction's hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Determine whether the block timestamp is greater than (current time +10s). If it is greater than this time, it is determined to be maliciously prematurely out of the block, ignoring the message.</li> <li>Determine whether the message is repeated according to the block hash. If it is repeated, ignore the message (requires maintenance of a set to store the received block hash)</li> <li>Query the DB according to the block hash to see if the block already exists in the local area. If it already exists, ignore the message.</li> <li>Verify the block header, if the verification fails, ignore the message</li> <li>Take txHashList, determine that tx is not local, assemble GetTxGroupMessage, and send it to the source node.</li></ol> <h4 id="_4-2-4-get-block-message-based-on-height-getblocksbyheightmessage"><a href="#_4-2-4-get-block-message-based-on-height-getblocksbyheightmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.4 Get block message based on height-GetBlocksByHeightMessage</h4> <ul><li><p>Message description：For the &quot;sync block&quot; function</p></li> <li><p>Message type（cmd）</p> <p>GetBlocksByHeight</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>32</td> <td>startHeight</td> <td>uint32</td> <td>start Height</td></tr> <tr><td>32</td> <td>endHeight</td> <td>uint32</td> <td>end Height</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Height parameter verification</li> <li>Return the response message ReactMessage</li> <li>Find the Block from endHeight, assemble the BlockMessage, and send it to the target node.</li> <li>Find the startHeight, assemble the CompleteMessage, and send it to the target node.</li></ol> <h4 id="_4-2-5-get-block-message-getblockmessage"><a href="#_4-2-5-get-block-message-getblockmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.5 Get block message-GetBlockMessage</h4> <ul><li><p>Message description：Used for &quot;block synchronization&quot;</p></li> <li><p>Message type（cmd）</p> <p>GetBlock</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>HashLength</td> <td>VarInt</td> <td>Hash array's length</td></tr> <tr><td>?</td> <td>Hash</td> <td>byte[]</td> <td>Hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Return the response message ReactMessage</li> <li>Find the Block according to the hash, assemble the BlockMessage, and send it to the target node.</li> <li>Assemble the CompleteMessage and send it to the target node.</li></ol> <h4 id="_4-2-6-complete-block-message-blockmessage"><a href="#_4-2-6-complete-block-message-blockmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.6 Complete block message-BlockMessage</h4> <ul><li><p>Message description：Used for &quot;block synchronization&quot;</p></li> <li><p>Message type（cmd）</p> <p>Block</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>preHashLength</td> <td>VarInt</td> <td>preHash array's length</td></tr> <tr><td>?</td> <td>preHash</td> <td>byte[]</td> <td>preHash</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>merkleHashLength</td> <td>VarInt</td> <td>merkleHash array's length</td></tr> <tr><td>?</td> <td>merkleHash</td> <td>byte[]</td> <td>merkleHash</td></tr> <tr><td>48</td> <td>time</td> <td>Uint48</td> <td>time</td></tr> <tr><td>32</td> <td>height</td> <td>Uint32</td> <td>block's height</td></tr> <tr><td>32</td> <td>txCount</td> <td>Uint32</td> <td>count of transactions</td></tr> <tr><td>?</td> <td>extendLength</td> <td>VarInt</td> <td>extend array's length</td></tr> <tr><td>?</td> <td>extend</td> <td>byte[]</td> <td>extend</td></tr> <tr><td>32</td> <td>publicKeyLength</td> <td>Uint32</td> <td>public key array's length</td></tr> <tr><td>?</td> <td>publicKey</td> <td>byte[]</td> <td>public key</td></tr> <tr><td>1</td> <td>signAlgType</td> <td>byte</td> <td>Signature algorithm type</td></tr> <tr><td>?</td> <td>signBytesLength</td> <td>VarInt</td> <td>sign array's length</td></tr> <tr><td>?</td> <td>signBytes</td> <td>byte[]</td> <td>Signature of block</td></tr> <tr><td>16</td> <td>type</td> <td>uint16</td> <td>transaction's type</td></tr> <tr><td>48</td> <td>time</td> <td>uint48</td> <td>transaction's timestamp</td></tr> <tr><td>?</td> <td>remarkLength</td> <td>VarInt</td> <td>remark array's length</td></tr> <tr><td>?</td> <td>remark</td> <td>byte[]</td> <td>remark bytes</td></tr> <tr><td>32</td> <td>fromCount</td> <td>Uint32</td> <td>count of froms</td></tr> <tr><td>32</td> <td>fromAssetsChainId</td> <td>Uint32</td> <td>chain id</td></tr> <tr><td>32</td> <td>fromAssetsId</td> <td>Uint32</td> <td>asset id</td></tr> <tr><td>?</td> <td>fromAddress</td> <td>VarChar</td> <td>from account address</td></tr> <tr><td>48</td> <td>amount</td> <td>Uint48</td> <td>Transfer amount</td></tr> <tr><td>32</td> <td>nonce</td> <td>Uint32</td> <td>Transaction sequence number, increment</td></tr> <tr><td>32</td> <td>toCount</td> <td>Uint32</td> <td>count of tos</td></tr> <tr><td>32</td> <td>toAssetsChainId</td> <td>Uint32</td> <td>chain id</td></tr> <tr><td>32</td> <td>toAssetsId</td> <td>Uint32</td> <td>asset id</td></tr> <tr><td>?</td> <td>toAddress</td> <td>VarChar</td> <td>to account address</td></tr> <tr><td>48</td> <td>amount</td> <td>Uint48</td> <td>Transfer amount</td></tr> <tr><td>32</td> <td>lockTime</td> <td>Uint32</td> <td>lock time</td></tr> <tr><td>?</td> <td>txData</td> <td>T</td> <td>data of special transaction</td></tr> <tr><td>?</td> <td>txSignLength</td> <td>VarInt</td> <td>transaction's sign array's length</td></tr> <tr><td>?</td> <td>txSign</td> <td>byte[]</td> <td>transaction's sign</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Put into the cache queue</li> <li>Wait for other blocks to be synchronized</li></ol> <h4 id="_4-2-7-data-message-not-found-notfoundmessage"><a href="#_4-2-7-data-message-not-found-notfoundmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.7 Data message not found-NotFoundMessage</h4> <ul><li><p>Message description：A generic message for an asynchronous request that marks the target node not finding the corresponding information.</p></li> <li><p>Message type（cmd）</p> <p>NotFound</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>msgType</td> <td>byte</td> <td>Data type not found</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>HashLength</td> <td>VarInt</td> <td>Hash array's length</td></tr> <tr><td>?</td> <td>Hash</td> <td>byte[]</td> <td>Hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Find the asynchronous request of the source node cache according to the chainID and hash, set the processing result flag to complete, and set the return result to null.</li></ol> <h4 id="_4-2-8-response-message-reactmessage"><a href="#_4-2-8-response-message-reactmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.8 Response message-ReactMessage</h4> <ul><li><p>Message description：A generic message, used for asynchronous requests, to flag that the target node receives the request and is processing it.</p></li> <li><p>Message type（cmd）</p> <p>React</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>HashLength</td> <td>VarInt</td> <td>Hash array's length</td></tr> <tr><td>?</td> <td>Hash</td> <td>byte[]</td> <td>Hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Find the asynchronous request of the source node cache according to the chainID and hash, and set the processing result flag to wait.</li></ol> <h4 id="_4-2-9-request-completion-message-completemessage"><a href="#_4-2-9-request-completion-message-completemessage" aria-hidden="true" class="header-anchor">#</a> 4.2.9 Request completion message-CompleteMessage</h4> <ul><li><p>Message description：A generic message for asynchronous requests that marks the end of asynchronous request processing.</p></li> <li><p>Message type（cmd）</p> <p>Complete</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>HashLength</td> <td>VarInt</td> <td>Hash array's length</td></tr> <tr><td>?</td> <td>Hash</td> <td>byte[]</td> <td>Hash</td></tr> <tr><td>1</td> <td>success</td> <td>byte</td> <td>flag</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>Find the asynchronous request of the source node cache according to the chainID and hash, and set the processing result flag to complete.</li></ol> <h4 id="_4-2-10-get-the-message-of-the-transaction-list-gettxgrouprequest"><a href="#_4-2-10-get-the-message-of-the-transaction-list-gettxgrouprequest" aria-hidden="true" class="header-anchor">#</a> 4.2.10 Get the message of the transaction list-GetTxGroupRequest</h4> <ul><li><p>Message description：Used for &quot;forwarding blocks&quot;</p></li> <li><p>Message type（cmd）</p> <p>GetTxGroup</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>?</td> <td>ArrayLength</td> <td>VarInt</td> <td>Hash list length</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>HashLength</td> <td>VarInt</td> <td>Hash array's length</td></tr> <tr><td>?</td> <td>Hash</td> <td>byte[]</td> <td>Hash</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p></li></ul> <ol><li>After receiving the message, the target node takes out the hashList, traverses the hashList, obtains Tx according to txHash, assembles TxGroupMessage, and sends it to the source node.</li></ol> <h4 id="_4-2-11-transaction-list-message-txgroupmessage"><a href="#_4-2-11-transaction-list-message-txgroupmessage" aria-hidden="true" class="header-anchor">#</a> 4.2.11 Transaction list message-TxGroupMessage</h4> <ul><li><p>Message description：Used for &quot;forwarding blocks&quot;</p></li> <li><p>Message type（cmd）</p> <p>TxGroup</p></li> <li><p>Message format（txData）</p></li></ul> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>32</td> <td>chainID</td> <td>uint32</td> <td>chain ID</td></tr> <tr><td>1</td> <td>digestAlgType</td> <td>byte</td> <td>digest algorithm identifier</td></tr> <tr><td>?</td> <td>requestHashLength</td> <td>VarInt</td> <td>requestHash array's length</td></tr> <tr><td>?</td> <td>requestHash</td> <td>byte[]</td> <td>requestHash</td></tr> <tr><td>?</td> <td>txCount</td> <td>VarInt</td> <td>count of transactions</td></tr> <tr><td>16</td> <td>type</td> <td>uint16</td> <td>transaction's type</td></tr> <tr><td>48</td> <td>time</td> <td>uint48</td> <td>transaction's timestamp</td></tr> <tr><td>?</td> <td>remarkLength</td> <td>VarInt</td> <td>remark array's length</td></tr> <tr><td>?</td> <td>remark</td> <td>byte[]</td> <td>remark bytes</td></tr> <tr><td>32</td> <td>fromCount</td> <td>Uint32</td> <td>count of froms</td></tr> <tr><td>32</td> <td>fromAssetsChainId</td> <td>Uint32</td> <td>chain id</td></tr> <tr><td>32</td> <td>fromAssetsId</td> <td>Uint32</td> <td>asset id</td></tr> <tr><td>?</td> <td>fromAddress</td> <td>VarChar</td> <td>from account address</td></tr> <tr><td>48</td> <td>amount</td> <td>Uint48</td> <td>Transfer amount</td></tr> <tr><td>32</td> <td>nonce</td> <td>Uint32</td> <td>Transaction sequence number, increment</td></tr> <tr><td>32</td> <td>toCount</td> <td>Uint32</td> <td>count of tos</td></tr> <tr><td>32</td> <td>toAssetsChainId</td> <td>Uint32</td> <td>chain id</td></tr> <tr><td>32</td> <td>toAssetsId</td> <td>Uint32</td> <td>asset id</td></tr> <tr><td>?</td> <td>toAddress</td> <td>VarChar</td> <td>to account address</td></tr> <tr><td>48</td> <td>amount</td> <td>Uint48</td> <td>Transfer amount</td></tr> <tr><td>32</td> <td>lockTime</td> <td>Uint32</td> <td>lock time</td></tr> <tr><td>?</td> <td>txData</td> <td>T</td> <td>data of special transaction</td></tr> <tr><td>?</td> <td>txSignLength</td> <td>VarInt</td> <td>transaction's sign array's length</td></tr> <tr><td>?</td> <td>txSign</td> <td>byte[]</td> <td>transaction's sign</td></tr></tbody></table> <ul><li><p>Message validation</p> <p>omit</p></li> <li><p>Message processing logic</p> <p>omit</p></li></ul> <h2 id="chapter-5-the-module-configuration"><a href="#chapter-5-the-module-configuration" aria-hidden="true" class="header-anchor">#</a> Chapter 5. The module configuration</h2> <div class="language- extra-class"><pre class="language-text"><code>{
    {
        &quot;name&quot;: &quot;serverIp&quot;,
        &quot;remark&quot;: &quot;service ip&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;127.0.0.1&quot;
    },
    {
        &quot;name&quot;: &quot;serverPort&quot;,
        &quot;remark&quot;: &quot;service port&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;&quot;
    },
    {
        &quot;name&quot;: &quot;blockSize&quot;,
        &quot;remark&quot;: &quot;block size&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;3m&quot;
    },
    {
        &quot;name&quot;: &quot;resetTime&quot;,
        &quot;remark&quot;: &quot;When the block height is not updated for a long time, the available nodes are reacquired&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;180&quot;
    },
    {
        &quot;name&quot;: &quot;forkCount&quot;,
        &quot;remark&quot;: &quot;When the fork chain is higher than the main chain, switch&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;3&quot;
    },
    {
        &quot;name&quot;: &quot;cacheSize&quot;,
        &quot;remark&quot;: &quot;forked chain cache size&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;50m&quot;
    },
    {
        &quot;name&quot;: &quot;heightRange&quot;,
        &quot;remark&quot;: &quot;Cache to the height range of the forked chain&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;1000&quot;
    },
    {
        &quot;name&quot;: &quot;maxRollback&quot;,
        &quot;remark&quot;: &quot;How many blocks are rolled back at most each time&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;20&quot;
    },
    {
        &quot;name&quot;: &quot;consistencyNodePercent&quot;,
        &quot;remark&quot;: &quot;The lowest percentage of consistent nodes available, below this number of unsynchronized blocks&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;80&quot;
    },
    {
        &quot;name&quot;: &quot;minNodeAmount&quot;,
        &quot;remark&quot;: &quot;The minimum number of available nodes, lower than this number of unsynchronized blocks&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;10&quot;
    },
    {
        &quot;name&quot;: &quot;downloadNumber&quot;,
        &quot;remark&quot;: &quot;How many blocks are downloaded from one node each time during synchronization&quot;,
        &quot;changable&quot;: &quot;true&quot;,
        &quot;default&quot;: &quot;20&quot;
    },
    {
        &quot;name&quot;: &quot;extendMaxSize&quot;,
        &quot;remark&quot;: &quot;block header extension field maximum value&quot;,
        &quot;changable&quot;: &quot;false&quot;,
        &quot;default&quot;: &quot;1024&quot;
    }
}
</code></pre></div><h2 id="chapter-6-java-s-design"><a href="#chapter-6-java-s-design" aria-hidden="true" class="header-anchor">#</a> Chapter 6. Java's design</h2> <ul><li>Block Object design</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>instruction</code></th></tr></thead> <tbody><tr><td>blockHeader</td> <td>BlockHeader</td> <td>block header</td></tr> <tr><td>transactions</td> <td>List<Transaction></Transaction></td> <td>transaction's list</td></tr></tbody></table></blockquote> <ul><li>SmallBlock Object design</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>instruction</code></th></tr></thead> <tbody><tr><td>blockHeader</td> <td>BlockHeader</td> <td>block header</td></tr> <tr><td>transactions</td> <td>List<String></String></td> <td>transaction's hash list</td></tr> <tr><td>subTxList</td> <td>List<Transaction></Transaction></td> <td>Transactions that other nodes must not have (such as consensus reward transactions, red and yellow card transactions, etc.</td></tr></tbody></table></blockquote> <ul><li>BlockHeader Object design</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>instruction</code></th></tr></thead> <tbody><tr><td>chainId</td> <td>long</td> <td>chain ID</td></tr> <tr><td>hash</td> <td>String</td> <td>block hash</td></tr> <tr><td>preHash</td> <td>String</td> <td>pre block hash</td></tr> <tr><td>merkleHash</td> <td>String</td> <td>block's MerkleHash</td></tr> <tr><td>height</td> <td>int</td> <td>block's height</td></tr> <tr><td>size</td> <td>short</td> <td>block's size</td></tr> <tr><td>time</td> <td>long</td> <td>block's packing timestamp</td></tr> <tr><td>txCount</td> <td>short</td> <td>count of transactions</td></tr> <tr><td>packingAddress</td> <td>String</td> <td>address of packing</td></tr> <tr><td>extend</td> <td>byte[]</td> <td>Extension field</td></tr> <tr><td>blockSignature</td> <td>BlockSignature</td> <td>Signature of block</td></tr></tbody></table></blockquote> <ul><li>BlockSignature Object design</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>instruction</code></th></tr></thead> <tbody><tr><td>signData</td> <td>String</td> <td>Signature of block</td></tr> <tr><td>publicKey</td> <td>byte[]</td> <td>public key</td></tr></tbody></table></blockquote> <h2 id="chapter-7-additional-content"><a href="#chapter-7-additional-content" aria-hidden="true" class="header-anchor">#</a> Chapter 7. additional content</h2></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/dev/docs/NULS2.0/alpha/blockModuleDesign.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/28/2019, 12:38:23 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.0877bdcb.js" defer></script><script src="/assets/js/27.d07d1fcb.js" defer></script>
  </body>
</html>
