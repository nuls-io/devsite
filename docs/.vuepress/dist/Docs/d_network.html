<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Network module design document | NULS</title>
    <meta name="description" content="Make Blockchain Easy">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.3751d6d5.css" as="style"><link rel="preload" href="/assets/js/app.a4a6b4ef.js" as="script"><link rel="preload" href="/assets/js/5.f8a6f45b.js" as="script"><link rel="prefetch" href="/assets/js/10.3ea2f924.js"><link rel="prefetch" href="/assets/js/100.b0d2e6e1.js"><link rel="prefetch" href="/assets/js/101.c29fd1db.js"><link rel="prefetch" href="/assets/js/102.965089aa.js"><link rel="prefetch" href="/assets/js/103.43d448e7.js"><link rel="prefetch" href="/assets/js/104.a36ae702.js"><link rel="prefetch" href="/assets/js/105.e5f3687e.js"><link rel="prefetch" href="/assets/js/106.6152cabe.js"><link rel="prefetch" href="/assets/js/107.c912b812.js"><link rel="prefetch" href="/assets/js/108.49eac8c6.js"><link rel="prefetch" href="/assets/js/109.991284de.js"><link rel="prefetch" href="/assets/js/11.7d5c1b1b.js"><link rel="prefetch" href="/assets/js/110.b73a6ba7.js"><link rel="prefetch" href="/assets/js/111.548dfc10.js"><link rel="prefetch" href="/assets/js/112.33bcfaca.js"><link rel="prefetch" href="/assets/js/113.f0d3dd58.js"><link rel="prefetch" href="/assets/js/114.54eb8651.js"><link rel="prefetch" href="/assets/js/12.f9774295.js"><link rel="prefetch" href="/assets/js/13.0f0d3c58.js"><link rel="prefetch" href="/assets/js/14.217ef102.js"><link rel="prefetch" href="/assets/js/15.de42a949.js"><link rel="prefetch" href="/assets/js/16.0245ef41.js"><link rel="prefetch" href="/assets/js/17.309c8aa9.js"><link rel="prefetch" href="/assets/js/18.fc983526.js"><link rel="prefetch" href="/assets/js/19.d78ff56b.js"><link rel="prefetch" href="/assets/js/2.9dd26b6d.js"><link rel="prefetch" href="/assets/js/20.5b11eead.js"><link rel="prefetch" href="/assets/js/21.e2d544ac.js"><link rel="prefetch" href="/assets/js/22.ceef42f1.js"><link rel="prefetch" href="/assets/js/23.616d3c50.js"><link rel="prefetch" href="/assets/js/24.de2bb2dd.js"><link rel="prefetch" href="/assets/js/25.36b3218d.js"><link rel="prefetch" href="/assets/js/26.9ac5ee86.js"><link rel="prefetch" href="/assets/js/27.b1ceb8ad.js"><link rel="prefetch" href="/assets/js/28.7cd871f9.js"><link rel="prefetch" href="/assets/js/29.6e965cbd.js"><link rel="prefetch" href="/assets/js/3.395c456b.js"><link rel="prefetch" href="/assets/js/30.eb23cb11.js"><link rel="prefetch" href="/assets/js/31.de4a5865.js"><link rel="prefetch" href="/assets/js/32.2a0ad569.js"><link rel="prefetch" href="/assets/js/33.21baaf4d.js"><link rel="prefetch" href="/assets/js/34.6ac9dc18.js"><link rel="prefetch" href="/assets/js/35.b382beac.js"><link rel="prefetch" href="/assets/js/36.c48ad34e.js"><link rel="prefetch" href="/assets/js/37.d4edbd76.js"><link rel="prefetch" href="/assets/js/38.0e79c874.js"><link rel="prefetch" href="/assets/js/39.e9998a32.js"><link rel="prefetch" href="/assets/js/4.ed61587d.js"><link rel="prefetch" href="/assets/js/40.0222e59f.js"><link rel="prefetch" href="/assets/js/41.31e68660.js"><link rel="prefetch" href="/assets/js/42.a22038be.js"><link rel="prefetch" href="/assets/js/43.3e9b2960.js"><link rel="prefetch" href="/assets/js/44.5c440bb1.js"><link rel="prefetch" href="/assets/js/45.a4986bde.js"><link rel="prefetch" href="/assets/js/46.233d107a.js"><link rel="prefetch" href="/assets/js/47.280686d1.js"><link rel="prefetch" href="/assets/js/48.5ba47782.js"><link rel="prefetch" href="/assets/js/49.31793a8c.js"><link rel="prefetch" href="/assets/js/50.57720b1f.js"><link rel="prefetch" href="/assets/js/51.eb045fb3.js"><link rel="prefetch" href="/assets/js/52.8601825a.js"><link rel="prefetch" href="/assets/js/53.48d2f9a7.js"><link rel="prefetch" href="/assets/js/54.155919db.js"><link rel="prefetch" href="/assets/js/55.d4e980a1.js"><link rel="prefetch" href="/assets/js/56.b222e3e0.js"><link rel="prefetch" href="/assets/js/57.0349f0b2.js"><link rel="prefetch" href="/assets/js/58.bc8d108f.js"><link rel="prefetch" href="/assets/js/59.8000bd88.js"><link rel="prefetch" href="/assets/js/6.5bdd1924.js"><link rel="prefetch" href="/assets/js/60.675211d5.js"><link rel="prefetch" href="/assets/js/61.aca9af94.js"><link rel="prefetch" href="/assets/js/62.e633bd6d.js"><link rel="prefetch" href="/assets/js/63.15a9ba5e.js"><link rel="prefetch" href="/assets/js/64.dd95ec59.js"><link rel="prefetch" href="/assets/js/65.238fe604.js"><link rel="prefetch" href="/assets/js/66.46910d10.js"><link rel="prefetch" href="/assets/js/67.84165c1f.js"><link rel="prefetch" href="/assets/js/68.a44d4a8f.js"><link rel="prefetch" href="/assets/js/69.bb67ac82.js"><link rel="prefetch" href="/assets/js/7.7d97e89c.js"><link rel="prefetch" href="/assets/js/70.e86144c1.js"><link rel="prefetch" href="/assets/js/71.e33eadba.js"><link rel="prefetch" href="/assets/js/72.3d129f8e.js"><link rel="prefetch" href="/assets/js/73.0676b7d4.js"><link rel="prefetch" href="/assets/js/74.04139eb3.js"><link rel="prefetch" href="/assets/js/75.d44eb65d.js"><link rel="prefetch" href="/assets/js/76.41aa5560.js"><link rel="prefetch" href="/assets/js/77.3e79a6ac.js"><link rel="prefetch" href="/assets/js/78.82fdc036.js"><link rel="prefetch" href="/assets/js/79.40c01994.js"><link rel="prefetch" href="/assets/js/8.8f417e91.js"><link rel="prefetch" href="/assets/js/80.115a54bb.js"><link rel="prefetch" href="/assets/js/81.1c715911.js"><link rel="prefetch" href="/assets/js/82.7aac4fa9.js"><link rel="prefetch" href="/assets/js/83.d6b4173d.js"><link rel="prefetch" href="/assets/js/84.26e59764.js"><link rel="prefetch" href="/assets/js/85.396c6d65.js"><link rel="prefetch" href="/assets/js/86.cb6d4a50.js"><link rel="prefetch" href="/assets/js/87.d629ff60.js"><link rel="prefetch" href="/assets/js/88.a416d06f.js"><link rel="prefetch" href="/assets/js/89.f8cd0168.js"><link rel="prefetch" href="/assets/js/9.3d3509ff.js"><link rel="prefetch" href="/assets/js/90.bc4c0ce8.js"><link rel="prefetch" href="/assets/js/91.6ce86fbf.js"><link rel="prefetch" href="/assets/js/92.e207a6c1.js"><link rel="prefetch" href="/assets/js/93.2150fe7c.js"><link rel="prefetch" href="/assets/js/94.c0d34093.js"><link rel="prefetch" href="/assets/js/95.78b9f936.js"><link rel="prefetch" href="/assets/js/96.7f2c10ee.js"><link rel="prefetch" href="/assets/js/97.e0a9b027.js"><link rel="prefetch" href="/assets/js/98.03166ee8.js"><link rel="prefetch" href="/assets/js/99.981a0879.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3751d6d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NULS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/d_network.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/d_network.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/d_network.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/d_network.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Module Design</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/d_network.html" class="active sidebar-link">Network module design document</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_network.html#overall-description" class="sidebar-link">Overall description</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_1-1-module-overview" class="sidebar-link">1.1 Module Overview</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_1-2-architecture" class="sidebar-link">1.2 Architecture</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#functional-design" class="sidebar-link">Functional design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_2-1-functional-architecture" class="sidebar-link">2.1 Functional Architecture</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_2-2-module-service" class="sidebar-link">2.2 Module Service</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_2-3-module-internal-function" class="sidebar-link">2.3 Module internal function</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#description-of-the-event" class="sidebar-link">Description of the event</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_3-1-published-events" class="sidebar-link">3.1 Published events</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_3-2-subscribe-to-events" class="sidebar-link">3.2 Subscribe to events</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#agreement" class="sidebar-link">Agreement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_4-1-network-communication-protocol" class="sidebar-link">4.1 Network Communication Protocol</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#_4-2-trading-agreement" class="sidebar-link">4.2 Trading Agreement</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#module-configuration" class="sidebar-link">Module configuration</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#java-specific-design" class="sidebar-link">Java-specific design</a></li><li class="sidebar-sub-header"><a href="/Docs/d_network.html#supplementary-content" class="sidebar-link">Supplementary content</a></li></ul></li><li><a href="/Docs/d_ledger.html" class="sidebar-link">Design document of ledger module</a></li><li><a href="/Docs/d_chain_manager.html" class="sidebar-link">Chain Management Module Design Document</a></li><li><a href="/Docs/d_account.html" class="sidebar-link">Account Module Design Document</a></li><li><a href="/Docs/d_smart_contract.html" class="sidebar-link">Smart contract module design</a></li><li><a href="/Docs/d_transaction.html" class="sidebar-link">Transaction management module Design document</a></li><li><a href="/Docs/d_cross_chain.html" class="sidebar-link">Overall description</a></li><li><a href="/Docs/d_consensus.html" class="sidebar-link">Consensus Module Design Document</a></li><li><a href="/Docs/d_public_service.html" class="sidebar-link">Public-Service Module Design Document</a></li><li><a href="/Docs/d_block.html" class="sidebar-link">Block Management Module Design Document</a></li><li><a href="/Docs/d_protocol_update.html" class="sidebar-link">Upgrade module design document</a></li><li><a href="/Docs/d_address.html" class="sidebar-link">NULS Protocol Address</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interface</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/i_rpc_protocol.html" class="sidebar-link">NULS Application Interface Services</a></li><li><a href="/Docs/i_public_service.html" class="sidebar-link">Public Service</a></li><li><a href="/Docs/i_nuls-api_JSONRPC.html" class="sidebar-link">API-JSONRPC</a></li><li><a href="/Docs/i_nuls-api_RESTFUL.html" class="sidebar-link">API-RESTFUL</a></li><li><a href="/Docs/i_account.html" class="sidebar-link">Account Module</a></li><li><a href="/Docs/i_chain-manager.html" class="sidebar-link">Why should I have the Chain Management module?</a></li><li><a href="/Docs/i_cross-chain.html" class="sidebar-link">Interface List</a></li><li><a href="/Docs/i_network.html" class="sidebar-link">Why should I have &quot;Network Module&quot;?</a></li><li><a href="/Docs/i_block.html" class="sidebar-link">Block Module</a></li><li><a href="/Docs/i_transaction.html" class="sidebar-link">Transaction module</a></li><li><a href="/Docs/i_consensus.html" class="sidebar-link">poc Consensus Module</a></li><li><a href="/Docs/i_smart-contract.html" class="sidebar-link">Smart contract module</a></li><li><a href="/Docs/i_ledger.html" class="sidebar-link">Ledger Module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>ChainBox</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/c_chain_box.html" class="sidebar-link">NULS ChainBox</a></li><li><a href="/Docs/c_module.html" class="sidebar-link">Develope Module</a></li><li><a href="/Docs/c_message_module.html" class="sidebar-link">Encrypted Message Module Demo</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/s_manual.html" class="sidebar-link">Development Manual</a></li><li><a href="/Docs/s_tools.html" class="sidebar-link">Development Tool</a></li><li><a href="/Docs/s_nrc20.html" class="sidebar-link">NRC-20</a></li><li><a href="/Docs/s_nrc721.html" class="sidebar-link">NRC-721</a></li><li><a href="/Docs/s_offline_assembly.html" class="sidebar-link">Smart contract offline assembly</a></li><li><a href="/Docs/s_advance.html" class="sidebar-link">Advanced Description</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="network-module-design-document"><a href="#network-module-design-document" aria-hidden="true" class="header-anchor">#</a> Network module design document</h1> <h2 id="overall-description"><a href="#overall-description" aria-hidden="true" class="header-anchor">#</a> Overall description</h2> <h3 id="_1-1-module-overview"><a href="#_1-1-module-overview" aria-hidden="true" class="header-anchor">#</a> 1.1 Module Overview</h3> <h4 id="_1-1-1-why-do-you-have-a-network-module"><a href="#_1-1-1-why-do-you-have-a-network-module" aria-hidden="true" class="header-anchor">#</a> 1.1.1 Why do you have a Network Module?</h4> <p>The network module guarantees the communication between the decentralized nodes and provides the lowest level of network communication, node discovery and other services for one of the NULS basic modules.The network foundation of the blockchain is Peer to Peer, or P2P.All participants in the P2P network can be either a service server or a resource user.Features of P2P networks: decentralization, scalability, robustness, cost-effectiveness, privacy protection, and load balancing.</p> <h4 id="_1-1-2-what-to-do-with-network-module"><a href="#_1-1-2-what-to-do-with-network-module" aria-hidden="true" class="header-anchor">#</a> 1.1.2 What to do with Network Module</h4> <p>The network module is the basic module of the entire system, which is used to manage the connection between nodes, nodes and connections, and the transmission and reception of data.Network modules do not involve complex business logic.</p> <ul><li><p>Received network messages, according to the instruction service mapping relationship in the kernel module, push the corresponding processing module of the message.</p></li> <li><p>The open interface is used to push the message calls encapsulated by other modules to the specified peer node and broadcast to the specified network group.</p></li></ul> <h4 id="_1-1-3-positioning-of-the-network-module-in-the-system"><a href="#_1-1-3-positioning-of-the-network-module-in-the-system" aria-hidden="true" class="header-anchor">#</a> 1.1.3 Positioning of the Network Module in the system</h4> <ul><li>The network module is the underlying application module. Any module that needs network communication must send and receive messages through the network module.</li> <li>The network module relies on the core module for governance of the service interface.</li> <li>The network module builds different networks by network id (magic parameter).</li> <li>When the nodes of the network module in the main network chain are configured for cross-chain networking, the chain management module is required to provide cross-chain configuration information.</li> <li>When a node in a parallel chain of a network module is configured for a cross-chain network, cross-chain configuration information is required for the cross-chain module.</li></ul> <h3 id="_1-2-architecture"><a href="#_1-2-architecture" aria-hidden="true" class="header-anchor">#</a> 1.2 Architecture</h3> <p><img src="/assets/img/network-context.8f5dc235.png" alt></p> <h2 id="functional-design"><a href="#functional-design" aria-hidden="true" class="header-anchor">#</a> Functional design</h2> <h3 id="_2-1-functional-architecture"><a href="#_2-1-functional-architecture" aria-hidden="true" class="header-anchor">#</a> 2.1 Functional Architecture</h3> <p>The network module has functions in the business: node management, node group management, p2p network connection management, and message transmission and management.</p> <p>The internal infrastructure functions include: state management of the module (including startup and shutdown management), and management of external interfaces.</p> <p>Thread task management, data storage management, etc.</p> <p><img src="/assets/img/network-functions.811c83fd.png" alt></p> <ul><li><p>Node management</p> <p>Manage all connectable, connected node information, status, and provide node operation interfaces</p> <ul><li>Node discovery</li> <li>Node storage</li></ul></li> <li><p>Node Group Management</p> <p>Manage different network nodes, divide nodes into different collections, and manage each collection separately.The magic parameters of the nodes connected in each set are the same and different from the magic parameters of other sets.</p> <p>Each NodeGroup is initialized according to the information registered in the chain or the network information configured by itself (magic parameters, number of nodes, etc.)</p> <p>Each time a NodeGroup is initialized, the network service listens for a MagicNumber.</p></li> <li><p>Connector Management Connection management</p> <ul><li>Initialize the connection
<ul><li>Intra-chain node: Initially connect through the seed node, request the peer address through the protocol or receive the shared peer address, and then cache.</li> <li>Cross-chain nodes: The primary network passively waits for the connection of parallel chain nodes.</li></ul></li> <li>Connection management: Need to perform node availability detection, heartbeat maintenance, and disconnect the seed node when there are redundant nodes available.</li> <li>Disconnect</li></ul></li> <li><p>Messaging management</p> <p>1&gt;Message receiving Message receiver</p> <p>Receiving the message sent by the network node, judging the message (determining cmd), and transparently transmitting the message to the corresponding module service according to the message cmd field.</p></li></ul> <p>2&gt; Message Sending Message sender</p> <p>a&gt; Broadcast messages to the network group (NodeGroup)</p> <p>b&gt; Specify the peer node to send messages</p> <ul><li><p>Module status management</p> <p>a&gt; start, close the logic processing</p></li></ul> <p>b&gt;Maintenance and management of the status of its own module: management module operation status, internal function status, etc.</p> <ul><li><p>Interface management</p> <p>a&gt;Register your own interface to the NUSTAR module</p> <p>b&gt; Synchronize module information and status to the NUSTAR module</p> <p>c&gt;Get the service list to the local module</p> <p>d&gt; open external interface call</p></li> <li><p>Thread task management</p> <p>a&gt;Manage heartbeat threads</p> <p>b&gt; management node discovery / elimination mechanism thread</p></li></ul> <h3 id="_2-2-module-service"><a href="#_2-2-module-service" aria-hidden="true" class="header-anchor">#</a> 2.2 Module Service</h3> <h4 id="_2-2-1-network-message-reception"><a href="#_2-2-1-network-message-reception" aria-hidden="true" class="header-anchor">#</a> 2.2.1 Network Message Reception</h4> <ul><li><p>Function Description:</p> <p>Receiving the message sent by the (external) network node, making a simple judgment on the message (determining the magic parameter), and sending the message to the module service of interest according to the command field contained in the message header.</p></li> <li><p>Process description</p> <p><img src="/assets/img/recMessage2.ccf47917.png" alt></p></li> <li><p>Message verification part:</p></li></ul> <p>Payload check</p> <p>magicNumber check</p> <ul><li><p>Interface parameter constraints provided by external modules</p> <ul><li><p>method : *** // Same CMD instruction in the message header, constraining 12 bytes</p></li> <li><p>params</p></li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    0: chainId //chain id
    1:nodeId //nodeId
    2: message // hexadecimal network sequence message body
    ......
</code></pre></div><ul><li>Dependent service</li></ul> <p>Parsing the command parameter in the message header, relying on the remote service interface data provided by the kernel module when calling the remote interface processing.</p> <h4 id="_2-2-2-network-message-sending"><a href="#_2-2-2-network-message-sending" aria-hidden="true" class="header-anchor">#</a> 2.2.2 Network Message Sending</h4> <p>Forwards messages encapsulated by other or own modules, including broadcast messages and designated nodes to send messages.</p> <h5 id="_2-2-2-1-broadcast-network-message"><a href="#_2-2-2-1-broadcast-network-message" aria-hidden="true" class="header-anchor">#</a> 2.2.2.1, Broadcast Network Message</h5> <p>Function Description:</p> <p>Forwarding messages encapsulated by other or own modules, the interface that provides forwarding calls to external modules has the following two cases:</p> <p>a&gt; Broadcast a message to a NodeGroup (specify a network).</p> <p>b&gt; Broadcast messages to the NodeGroup (specify a network) and exclude certain nodes.</p> <p>c&gt; Broadcast a message to the NodeGroup (specify a network) in a specified proportion and exclude certain nodes.</p> <ul><li><p>Process description</p> <p><img src="/assets/img/sendMsg1.02c2c1dd.png" alt></p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>method : nw_broadcast</p> <p>External modules can broadcast messages through this interface</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;chainId&quot;:1234，
   &quot;excludeNodes&quot;: &quot;10.13.25.36:5003,20.30.25.65:8009&quot;,
   &quot;messageBody&quot;:     &quot;03847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF3&quot;，
   &quot;command&quot;:&quot;block&quot;，
   &quot;isCross&quot;:&quot;false&quot;，
   &quot;percent&quot;:&quot;50&quot;，
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr> <tr><td>1</td> <td>excludeNodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Exclude nodes, comma split</td></tr> <tr><td>2</td> <td>messageBody</td> <td>true</td> <td>String</td> <td style="text-align:center">Object hexadecimal characters</td></tr> <tr><td>3</td> <td>command</td> <td>true</td> <td>String</td> <td style="text-align:center">Message Protocol Instructions</td></tr> <tr><td>4</td> <td>isCross</td> <td>true</td> <td>boolean</td> <td style="text-align:center">Whether it is a cross-chain</td></tr> <tr><td>5</td> <td>percent</td> <td>false</td> <td>int</td> <td style="text-align:center">Broadcast transmission ratio, do not fill, default 100</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{
        &quot;value&quot;:false
    }
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       &quot;value&quot;:true
    }
}
</code></pre></div></li></ul></li> <li><p>Dependent service</p> <p>no</p></li></ul> <h5 id="_2-2-2-2-the-specified-node-sends-a-network-message"><a href="#_2-2-2-2-the-specified-node-sends-a-network-message" aria-hidden="true" class="header-anchor">#</a> 2.2.2.2, the specified node sends a network message</h5> <p>Function Description:</p> <p>Forwarding messages encapsulated by other or own modules, you can specify that certain nodes (which can be 1 node) send messages.</p> <ul><li><p>Process description</p> <p><img src="/assets/img/sendMsg2.de353050.png" alt></p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>External modules can broadcast messages through this interface</p> <p>method : nw_sendPeersMsg</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>@Parameter(parameterName = &quot;chainId&quot;, requestType = @TypeDescriptor(value = int.class), parameterValidRange = &quot;[1-65535]&quot;, parameterDes = &quot;linked chain Id, value range [1-65535]&quot;),
@Parameter(parameterName = &quot;nodes&quot;, requestType = @TypeDescriptor(value = String.class), parameterDes = &quot;specify the send peer node Id, a comma-separated string&quot;),
@Parameter(parameterName = &quot;messageBody&quot;, requestType = @TypeDescriptor(value = String.class), parameterDes = &quot;message body Hex&quot;),
@Parameter(parameterName = &quot;command&quot;, requestType = @TypeDescriptor(value = String.class), parameterDes = &quot;message protocol directive&quot;)
</code></pre></div><ul><li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
&quot;chainId&quot;:  1234，
&quot;nodes&quot;:  &quot;10.13.25.36:5003,20.30.25.65:8009&quot;,
&quot;messageBody&quot;:&quot;03847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF3&quot;，
&quot;command&quot;:  &quot;block&quot;
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr> <tr><td>1</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Send node, comma split</td></tr> <tr><td>2</td> <td>messageBody</td> <td>true</td> <td>String</td> <td style="text-align:center">hexadecimal characters</td></tr> <tr><td></td> <td>command</td> <td>true</td> <td>String</td> <td style="text-align:center"></td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>no</p></li></ul> <h4 id="_2-2-3-creating-a-node-group"><a href="#_2-2-3-creating-a-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.3 Creating a Node Group</h4> <p>In addition to its own network, the main network chain also has n cross-chain networks, and its own network and cross-chain network use different magicNumber.</p> <p>In addition to its own network, the parallel chain can also register the cross-chain network on the main network, and its own network and the cross-chain network use the same magicNumber.</p> <p>Node groups are used to manage different network information.The network module isolates and maintains different networks through node groups.</p> <p>Node group type: 1&gt; own network 2&gt; cross-chain network (main network chain cross-chain network &amp; parallel chain cross-chain network)</p> <p>Create a node group for the network module:</p> <p>1&gt; The own configuration file is loaded to create its own network group.</p> <p>2&gt; Cross-chain network:</p> <p>As the main network link node, after the parallel chain registers with the chain management module, the system generates a transaction verification confirmation and then calls the network module to generate a cross-chain network group, and then stores the configuration, and the subsequent modules start automatic loading.</p> <p>As a parallel chain node, when started by the cross-chain protocol module, the cross-chain protocol module obtains cross-chain configuration information from the module configuration, and invokes the network module.</p> <p>The network module triggers a cross-chain connection.</p> <h5 id="_2-2-3-1-creating-a-node-group-from-your-own-network"><a href="#_2-2-3-1-creating-a-node-group-from-your-own-network" aria-hidden="true" class="header-anchor">#</a> 2.2.3.1 Creating a Node Group from Your Own Network</h5> <ul><li><p>Function Description:</p> <p>The own network corresponds to its own chainId, and a magic parameter, through the configuration initialization to create a node group</p></li></ul> <ul><li><p>Process description</p> <p>Create a node group by configuration file loading</p></li> <li><p>Interface definition</p></li></ul> <p>Created internally, no external interface.</p> <ul><li>Dependent service</li></ul> <p>No</p> <h5 id="_2-2-3-2-creating-a-cross-chain-node-group"><a href="#_2-2-3-2-creating-a-cross-chain-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.3.2 Creating a cross-chain node group</h5> <ul><li><p>Function Description:</p> <p>The cross-chain node group on the main network chain is triggered by the parallel chain registration in the main network chain.The parallel chain obtains cross-chain configuration information, and the cross-chain status of the own network group is updated by the cross-chain protocol.</p></li></ul> <ul><li><p>Process description</p> <p>1&gt; The main network chain is triggered by the chain management module to trigger the creation of a cross-link node group.</p> <p>2&gt; Parallel chains update the cross-chain status of their own network groups through the cross-chain protocol module.</p></li></ul> <p><img src="/assets/img/createNodeGroup.dcac4eab.png" alt></p> <ul><li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Receive a call to an external module to create a node group</p> <p>method : nw_createNodeGroup</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
      &quot;chainId&quot;:  1234,
      &quot;magicNumber&quot;: 232342,
      &quot;maxOut&quot;:  10,
      &quot;maxIn&quot;:  100,
      &quot;minAvailableCount&quot;:  20，
      &quot;seedIps&quot;:  &quot;10.20.30.10:8002,48.25.32.12:8003,52.23.25.32:9003&quot;,
      &quot;isCrossGroup&quot;:  0
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr> <tr><td>1</td> <td>magicNumber</td> <td>true</td> <td>long</td> <td style="text-align:center">Magic Parameters</td></tr> <tr><td>2</td> <td>maxOut</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum active connections</td></tr> <tr><td>3</td> <td>maxIn</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum Passive Connections</td></tr> <tr><td>4</td> <td>minAvailableCount</td> <td>true</td> <td>int</td> <td style="text-align:center">Minimum number of connections in the friend chain</td></tr> <tr><td>5</td> <td>seedIps</td> <td>true</td> <td>String</td> <td style="text-align:center">seed node, comma split</td></tr> <tr><td>6</td> <td>isMoonNode</td> <td>true</td> <td>boolean</td> <td style="text-align:center">Whether to create a cross-chain connection group: true cross-chain connection, false normal connection</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li></ul> <ul><li>Dependent service</li></ul> <p>Relies on remote service interface data provided by the kernel module.</p> <h4 id="_2-2-4-logging-out-the-node-group"><a href="#_2-2-4-logging-out-the-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.4 Logging out the node group</h4> <ul><li><p>Function Description:</p> <p>Receive calls from external modules, unregistering cross-chain node groups.</p> <p>As the main network link node, the chain management module performs deregistration, and the system generates a transaction verification confirmation and then calls it.</p></li> <li><p>Process description</p> <p><img src="/assets/img/deleteNodeGroup2.a41d2684.png" alt></p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Receive calls from external modules, delete node groups</p> <p>method : nw_delNodeGroup</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;: 1234
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>Relies on remote service interface data provided by the kernel module.</p></li></ul> <h4 id="_2-2-5-cross-chain-seed-node-provides"><a href="#_2-2-5-cross-chain-seed-node-provides" aria-hidden="true" class="header-anchor">#</a> 2.2.5 Cross-chain seed node provides</h4> <ul><li><p>Function Description:</p> <p>The seed node is a node used to provide peer connection information when the network is initialized.When performing chain registration, the chain management module needs to obtain information about the cross-chain seed nodes on the primary network chain for initializing the connection.</p></li> <li><p>Process description</p> <p>no</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Obtain satellite chain seed node</p> <p>method : nw_getSeeds</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;: 1234
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
      seedsIps:&quot;101.132.33.140:8003,116.62.135.185:8003,47.90.243.131:8003&quot; 
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>seedsIps</td> <td>String</td> <td>Seed Node Information Comma Separation</td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>Relies on remote service interface data provided by the kernel module.</p></li></ul> <h4 id="_2-2-6-adding-a-connection-node"><a href="#_2-2-6-adding-a-connection-node" aria-hidden="true" class="header-anchor">#</a> 2.2.6 Adding a connection node</h4> <ul><li><p>Function Description:</p> <p>Under the cmd command, add peer connection information to a network.</p></li> <li><p>Process description</p> <p>The added node triggers the network connection process.</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Add network peer node</p> <p>method : nw_addNodes</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;:455，
    &quot;isCross&quot;:0,
    &quot;nodes&quot;:&quot;10.20.23.02:5006,53.26.65.58:8003&quot;
       }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr> <tr><td>1</td> <td>isCross</td> <td>true</td> <td>int</td> <td style="text-align:center">Whether cross-chain: 0 non-cross-chain, 1 cross-chain</td></tr> <tr><td>2</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Node Group</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>No</p></li></ul> <h4 id="_2-2-7-deleting-connection-nodes"><a href="#_2-2-7-deleting-connection-nodes" aria-hidden="true" class="header-anchor">#</a> 2.2.7 Deleting Connection Nodes</h4> <ul><li><p>Function Description:</p> <p>Under the cmd command, delete the peers connection information under a certain network.</p></li> <li><p>Process description</p> <p>Deleting a node triggers the disconnection of the network node.</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Delete network peer node</p> <p>method : nw_delNodes</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;:234,
    &quot;nodes&quot;: &quot;10.20.23.02:5006,53.26.65.58:8003&quot;
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr> <tr><td>1</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Node Group</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>no</p></li></ul> <h4 id="_2-2-8-reconnecting-the-specified-network"><a href="#_2-2-8-reconnecting-the-specified-network" aria-hidden="true" class="header-anchor">#</a> 2.2.8 Reconnecting the specified network</h4> <ul><li><p>Function Description:</p> <p>Network reconnection of the specified nodeGroup under the cmd command</p></li> <li><p>Process description</p> <p>After receiving the command, disconnect all the peers under the specified nodeGroup and reconnect to the network.</p> <p>Refresh the peer connection address under nodegroup and restart the network connection.</p> <p>If the peer connection is owned by multiple network services, you only need to cancel the association. If only the service is used, you can disconnect.</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Refresh and connect to the network node</p> <p>method : nw_reconnect</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;:1234
    }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center"></td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>no</p></li></ul> <h4 id="_2-2-9-get-the-list-of-nodegroup"><a href="#_2-2-9-get-the-list-of-nodegroup" aria-hidden="true" class="header-anchor">#</a> 2.2.9 Get the list of nodeGroup</h4> <ul><li><p>Function Description:</p> <p>Get a list of all networks managed by the node.</p></li> <li><p>Process description</p> <p>no</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Get node group information</p> <p>method : nw_getGroups</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;startPage&quot;:1,
    &quot;pageSize&quot;:10
 }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>startPage</td> <td>true</td> <td>int</td> <td style="text-align:center">Start Pages</td></tr> <tr><td>1</td> <td>pageSize</td> <td>true</td> <td>int</td> <td style="text-align:center">Number of records per page</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
        list:[{
            chainId: 1212, //chain id
            magicNumber: 324234, / / magic parameters
            totalCount: 2323, // total number of connections
            inCount: 22, //passive connections
            outCount: 33, //active connections
            isActive: 1, / / 0 is not activated, 1 is activated
            isCrossChain: 1 //0 is not a cross-chain network, 1 cross-chain network
            },{}
            ]
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chain id</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>Magic Parameters</td></tr> <tr><td>totalCount</td> <td>int</td> <td>Total connections</td></tr> <tr><td>inCount</td> <td>int</td> <td>Passive Connections</td></tr> <tr><td>outCount</td> <td>int</td> <td>Active Connections</td></tr> <tr><td>isActive</td> <td>int</td> <td>0 is inactive, 1 is activated</td></tr> <tr><td>isCrossChain</td> <td>int</td> <td>0 is not a cross-chain network, 1 cross-chain network</td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p></li></ul> <p>No</p> <h4 id="_2-2-10-get-the-connection-information-under-the-specified-nodegroup"><a href="#_2-2-10-get-the-connection-information-under-the-specified-nodegroup" aria-hidden="true" class="header-anchor">#</a> 2.2.10 Get the connection information under the specified nodeGroup</h4> <ul><li><p>Function Description:</p> <p>Get information about all nodes under the specified network id</p></li> <li><p>Process description</p> <p>no</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Get node information</p> <p>method : nw_getNodes</p></li> <li><p>Request example</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;:125,
    &quot;state&quot;:1,
    &quot;isCross&quot;:1,
    &quot;startPage&quot;:1,
    &quot;pageSize&quot;:5
}
</code></pre></div><ul><li>Request parameter description</li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">network id</td></tr> <tr><td>1</td> <td>state</td> <td>true</td> <td>int</td> <td style="text-align:center">0 all links, 1 connected, 2 not connected</td></tr> <tr><td>2</td> <td>isCross</td> <td>true</td> <td>int</td> <td style="text-align:center">0 Normal Connection 1 Cross-Chain Connection</td></tr> <tr><td>3</td> <td>startPage</td> <td>true</td> <td>int</td> <td style="text-align:center">Start Pages</td></tr> <tr><td>4</td> <td>pageSize</td> <td>true</td> <td>int</td> <td style="text-align:center">Number of records per page</td></tr></tbody></table> <ul><li>Return to example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;minVersion&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}

</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;minVersion&quot;: 1.2,
 &quot;code&quot;:0,
 &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
 &quot;result&quot;:{
       list:[{
                chainId: 122, / / chain id
                nodeId:&quot;20.20.30.10:9902&quot;
                magicNumber: 134124, / / magic parameters
                blockHeight: 6000, //block height
                blockHash：&quot;0020ba3f3f637ef53d025d3a8972462c00e84d9
                     Ea1a960f207778150ffb9f2c173ff&quot;, //block hash value
                Ip: &quot;200.25.36.41&quot;, / / ip address
                port：54,//
                State: &quot;connected&quot;,
                isOut: &quot;1&quot;, //0 passive connection, 1 active connection
                Time: &quot;6449878789&quot;, // recent connection time
	     },{}
	     ]
    }
}

</code></pre></div><ul><li>Return field description</li></ul></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chain id</td></tr> <tr><td>nodeId</td> <td>String</td> <td>node id</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>Magic Parameters</td></tr> <tr><td>blockHeight</td> <td>long</td> <td>Latest block height</td></tr> <tr><td>blockHash</td> <td>String</td> <td>Latest block hash</td></tr> <tr><td>ip</td> <td>String</td> <td>ip address</td></tr> <tr><td>port</td> <td>int</td> <td>port number</td></tr> <tr><td>state</td> <td>int</td> <td>connection state 1 connection 0 not connected</td></tr> <tr><td>isOut</td> <td>int</td> <td>0 passive connection, 1 active connection</td></tr> <tr><td>time</td> <td>long</td> <td>Recent connection time</td></tr></tbody></table> <ul><li>Dependent service</li></ul> <p>no</p> <h4 id="_2-2-11-get-the-specified-chain-network-summary-information"><a href="#_2-2-11-get-the-specified-chain-network-summary-information" aria-hidden="true" class="header-anchor">#</a> 2.2.11 Get the specified chain network summary information</h4> <ul><li><p>Function Description:</p> <p>Get the network information of the specified chainId.</p></li> <li><p>Process description</p> <p>no</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Get chain network information</p> <p>method : nw_getGroupByChainId</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;chainId&quot;:142
 }
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">Chain Id</td></tr></tbody></table></li> <li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
            &quot;chainId&quot;: 1212, //chain id
            &quot;magicNumber&quot;: 324234, / / magic parameters
            &quot;totalCount&quot;: 2323, // total number of connections
            &quot;connectCount&quot;: 44, / / connected number
            &quot;disConnectCount&quot;: 32, / / unconnected quantity
            &quot;inCount&quot;: 22, //passive connections
            &quot;outCount&quot;: 33, //active connections
            &quot;connectCrossCount&quot;: 44, / / connected cross-chain number
            &quot;disConnectCrossCount&quot;: 32, / / unconnected quantity
            &quot;inCrossCount&quot;: 22, // cross-chain passive connections
            &quot;outCrossCount&quot;: 33, / / cross-chain active connections
            &quot;isActive&quot;: 1, / / 0 is not activated, 1 is activated
            &quot;isCrossActive&quot;: 1, //0 cross-chain network is not activated, 1 cross-chain activation
            &quot;isMoonNet&quot;: 0 //0 friend chain, 1 satellite chain
            }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chain id</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>Magic Parameters</td></tr> <tr><td>totalCount</td> <td>int</td> <td>Total connections</td></tr> <tr><td>connectCount</td> <td>int</td> <td>Connected Quantity</td></tr> <tr><td>disConnectCount</td> <td>int</td> <td>Unconnected Quantity</td></tr> <tr><td>inCount</td> <td>int</td> <td>Passive Connections</td></tr> <tr><td>outCount</td> <td>int</td> <td>Active Connections</td></tr> <tr><td>connectCrossCount</td> <td>int</td> <td>Cross-chain connected number</td></tr> <tr><td>disConnectCrossCount</td> <td>int</td> <td>Cross-chain unconnected quantity</td></tr> <tr><td>inCrossCount</td> <td>int</td> <td>Cross-chain passive connections</td></tr> <tr><td>outCrossCount</td> <td>int</td> <td>Cross-chain active connections</td></tr> <tr><td>isActive</td> <td>int</td> <td>0 is inactive, 1 is activated</td></tr> <tr><td>isCrossActive</td> <td>int</td> <td>0 cross-chain network not activated, 1 cross-chain activation</td></tr> <tr><td>isMoonNet</td> <td>int</td> <td>0Friend Chain, 1 Satellite Chain</td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p></li></ul> <p>No</p> <h4 id="_2-2-12-updating-the-information-of-the-peer-connection-node-height-hash"><a href="#_2-2-12-updating-the-information-of-the-peer-connection-node-height-hash" aria-hidden="true" class="header-anchor">#</a> 2.2.12 Updating the information of the peer connection node (height &amp; Hash)</h4> <ul><li><p>Function Description:</p> <p>The network connection has the height and hash value of the peer node when the handshake connection is made, and the height and hash value of the subsequent peer connection node are called and updated by the external module (block management module).</p></li> <li><p>Process description</p> <p>1&gt; Wait for the block management interface to be initialized when the node starts, and then call the block management interface to get the latest block height and hash value.</p> <p>2&gt; When the handshake is performed, the node related information is put into the Verion protocol message and sent to the peer.</p> <p>3&gt; After the connection is established, the block management module will call the interface to update the latest block height and hash value.</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>The block management module calls to update the height of the node and the hash value.</p> <p>method : nw_updateNodeInfo</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_reconnect&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1598,
        &quot;10.20.30.20:8856&quot;,
        10,
        &quot;0020ba3f3f637ef53d025d3a8972462c00e84d9ea1a960f207778150ffb9f2c173ff&quot;
    ]
}
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">network id</td></tr> <tr><td>1</td> <td>nodeId</td> <td>true</td> <td>String</td> <td style="text-align:center">Network Node id</td></tr> <tr><td>2</td> <td>blockHeight</td> <td>true</td> <td>long</td> <td style="text-align:center">Start Pages</td></tr> <tr><td>3</td> <td>blockHash</td> <td>true</td> <td>String</td> <td style="text-align:center">Block Latest Hash</td></tr></tbody></table> <ul><li>Return to example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}

</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
 &quot;code&quot;:0,
 &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
 &quot;result&quot;:{
   
    }
}

</code></pre></div><ul><li>Return field description</li></ul></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table> <ul><li>Dependent service</li></ul> <p>No</p> <h4 id="_2-2-13-registering-network-protocol-processor"><a href="#_2-2-13-registering-network-protocol-processor" aria-hidden="true" class="header-anchor">#</a> 2.2.13 Registering Network Protocol Processor</h4> <ul><li><p>Function Description:</p> <p>After receiving the message sent by the peer end, the network module needs to call the corresponding module according to the cmd in the message protocol header.</p> <p>The mapping relationship between cmd and module requires each module to submit registration at startup.</p></li> <li><p>Process description</p> <p>slightly</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Registering a message invocation command between remote nodes</p> <p>method : nw_protocolRegister</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;role&quot;: &quot;bl&quot;,
  &quot;protocolCmds&quot;: [
   &quot;getBlockRequest&quot;,
    &quot;downLoadBlock&quot;
  ]
}

</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>role</td> <td>true</td> <td>String</td> <td style="text-align:center">Module Role</td></tr> <tr><td>1</td> <td>protocolCmds</td> <td>true</td> <td>array</td> <td style="text-align:center">Protocol Instruction Array</td></tr> <tr><td></td> <td></td> <td></td> <td></td> <td style="text-align:center"></td></tr></tbody></table> <ul><li>Return to example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
  
}


</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
   
}

</code></pre></div><ul><li>Return field description</li></ul></li> <li><p>Dependent service</p></li></ul> <p>No</p> <h4 id="_2-2-14-network-time-acquisition"><a href="#_2-2-14-network-time-acquisition" aria-hidden="true" class="header-anchor">#</a> 2.2.14 Network time acquisition</h4> <ul><li><p>Function Description:</p> <p>Get network time for local time offset synchronization.</p></li></ul> <ul><li><p>Process description</p> <p>The network module obtains the time of several servers on the network and performs offset calculation adjustment.If the network time acquisition fails, the time-acquisition protocol is sent to the 10 peer nodes to obtain the peer node time for the deviation calculation. If it is not available, the local time is directly returned.</p> <p>Description: Deviation correction is performed periodically.</p></li></ul> <ul><li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Get network time</p> <p>method : nw_currentTimeMillis</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>Rpc unified format
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td> <td></td> <td style="text-align:center"></td></tr></tbody></table> <ul><li>Return to example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>Rpc unified format

</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;currentTimeMillis&quot;:11544545466 
}


</code></pre></div><ul><li>Return field description</li></ul></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>currentTimeMillis</td> <td>long</td> <td>1970-01-01 The difference so far, in milliseconds</td></tr></tbody></table> <ul><li>Dependent service</li></ul> <p>No</p> <h3 id="_2-3-module-internal-function"><a href="#_2-3-module-internal-function" aria-hidden="true" class="header-anchor">#</a> 2.3 Module internal function</h3> <h4 id="_2-3-1-module-startup"><a href="#_2-3-1-module-startup" aria-hidden="true" class="header-anchor">#</a> 2.3.1 Module startup</h4> <ul><li><p>Function Description:</p> <p>When the module is started, the configuration information is initialized, the registration service is initialized, and the initialization of each internal function management database information is performed.</p></li> <li><p>Process description</p> <pre><code>  ![](./image/network-module/start.png)
</code></pre></li></ul> <p>1&gt; Local configuration data loading, database node group and node information data loading.</p> <p>2&gt; The state of the listening block management module enters the initialization completion, and the interface can be called, and then the block height and the hash value of the latest local node are acquired.</p> <p>3&gt; Initialization is complete, enter the peer node connection.</p> <p>4&gt; After the network connection module is stable, it can be sent out as an event.</p> <p>The network module initiates the connection stability determination condition: no new handshake connection occurs in x seconds, and there is no height increase in x seconds.x=10</p> <ul><li><p>Dependent service</p> <p>Dependent on core module, block management module</p></li></ul> <h4 id="_2-3-2-module-is-off"><a href="#_2-3-2-module-is-off" aria-hidden="true" class="header-anchor">#</a> 2.3.2 Module is off</h4> <ul><li><p>Function Description:</p> <p>When the module is closed, the connection is closed, the thread management is closed, the resources are released, and the status is notified to the core interface.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/shutdown.9b647f72.png" alt></p> <ul><li><p>Dependent service</p> <p>no</p></li></ul> <h4 id="_2-3-3-peer-node-discovery"><a href="#_2-3-3-peer-node-discovery" aria-hidden="true" class="header-anchor">#</a> 2.3.3 peer node discovery</h4> <ul><li><p>Function Description:</p> <p>After the network module is started, the peer node is managed.</p> <p>The ways for node acquisition are:</p> <p>1&gt; Connect to the seed node and request address acquisition.</p> <p>2&gt; Receive the broadcasted node message.</p> <p>2&gt; The connection of the cross-chain network, for example, as a connection between a node on the main network chain and a parallel chain, or a connection between a node on the parallel chain and the main network chain.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/discoverPeer.3e4de810.png" alt></p> <ul><li>Dependent service</li></ul> <p>No</p> <h4 id="_2-3-4-network-connection"><a href="#_2-3-4-network-connection" aria-hidden="true" class="header-anchor">#</a> 2.3.4 Network Connection</h4> <ul><li><p>Function Description:</p> <p>A node acts as the client and actively connects to the known peer node. It is also the server and waits for the peer node to connect.</p> <p>A connection can work normally, and it needs to pass the handshake protocol, that is, send each version protocol message. The specific definition of the protocol is as follows.</p> <p>&quot;Protocol - Network Communication Protocol Part&quot;.</p></li> <li><p>Process description</p></li></ul> <p>After the TCP connection is complete with the server, the client needs to handshake through the service version protocol. Only the connection with successful handshake can forward the service.The state in the connection cannot be transitioned to connected after X minutes, and the connection is actively disconnected.</p> <p>The version protocol is sent in the process (see the version structure of the protocol):</p> <p>1&gt; The protocol carries the information of the node, including: version information of the protocol, the highest block height of the port, the block hash value,</p> <p>The external network ip, port, and cross-chain service port of the other node, as well as the external network ip, port, and cross-chain service port of the node.</p> <p>2&gt; The service connection can be established only through the version protocol, otherwise it will be disconnected after waiting for X=1 minutes.</p> <p><img src="/assets/img/connection.6ef3c5f5.png" alt></p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-5-heartbeat-detection"><a href="#_2-3-5-heartbeat-detection" aria-hidden="true" class="header-anchor">#</a> 2.3.5 Heartbeat Detection</h4> <ul><li><p>Function Description:</p> <p>Check if the connection is still connected.The keep-alive is maintained by the ping-pong message of the client and the server.Refer to the &quot;Protocol - Network Communication Protocol&quot; section for the definition of the ping-pong protocol involved.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/pingpong.19416293.png" alt></p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-6-connection-quantity-verification"><a href="#_2-3-6-connection-quantity-verification" aria-hidden="true" class="header-anchor">#</a> 2.3.6 Connection Quantity Verification</h4> <ul><li><p>Function Description:</p> <p>When a node connection is established, the number of connections is made, and if the maximum is reached, the connection is actively disconnected.</p> <p>Process description</p> <pre><code>![](./image/network-module/connet-validate.png)
</code></pre></li> <li><p>Dependent service</p></li></ul> <h4 id="_2-3-7-external-ip-storage-of-nodes"><a href="#_2-3-7-external-ip-storage-of-nodes" aria-hidden="true" class="header-anchor">#</a> 2.3.7 External ip storage of nodes</h4> <ul><li>Function Description:</li></ul> <p>A node may have multiple network cards, or it may be in a local area network. Therefore, when establishing a connection, it does not know its own external network ip address.</p> <p>The node needs to know its own external network IP address to broadcast its own address for the external network peers to connect.In our design, the external network of the node is carried by the version protocol message.</p> <ul><li><p>Process description</p> <p>When the client receives the version message, it can know its own IP address information.</p></li></ul> <p><img src="/assets/img/saveNodeIp.3650e4e2.png" alt></p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-8-node-s-external-network-connection-detection"><a href="#_2-3-8-node-s-external-network-connection-detection" aria-hidden="true" class="header-anchor">#</a> 2.3.8 Node's external network connection detection</h4> <ul><li>Function Description:</li></ul> <p>When a node establishes a connection, it can broadcast its own external network IP+port to other nodes.However, if a node is in a local area network, the IP address of its external network cannot be directly connected.Therefore, in order to detect whether the external IP address of the node is available, you can connect to your own server to determine whether the IP address can be used for broadcast. If the connection is successful, the external IP address of the node cannot be broadcast to other nodes.</p> <ul><li><p>Process description</p> <p>Self-connection may succeed or fail. If it is successful, the external network ip is reachable, and it can be broadcasted to other nodes in the network when the connection is established. If it is unreachable, the connection cannot be established without processing.</p></li></ul> <p><img src="/assets/img/connectSelf.201d795a.png" alt></p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-9-broadcasting-of-the-peer-node"><a href="#_2-3-9-broadcasting-of-the-peer-node" aria-hidden="true" class="header-anchor">#</a> 2.3.9 Broadcasting of the peer node</h4> <ul><li><p>Function Description:</p> <p>Broadcast its own node to other nodes in the network. In the design, we will promote the broadcast of its external network ip after the network is stabilized.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/connectSelf-recieve.7af46eff.png" alt></p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-10-request-reply-getaddr-protocol-message"><a href="#_2-3-10-request-reply-getaddr-protocol-message" aria-hidden="true" class="header-anchor">#</a> 2.3.10 Request/Reply getaddr Protocol Message</h4> <ul><li><p>Function Description:</p> <p>Request an address protocol message for more network connections</p></li> <li><p>Process description</p> <p>Request getaddr:</p></li></ul> <p>1&gt; After the network is stable, broadcast to the peer connection node to request a list of connectable addresses.</p> <p>Reply getaddr</p> <p>1&gt;peer cross-chain connection, the main network chain replies to the address list of the main network nodeGroup (IP+cross-chain port), and the parallel chain replies with its own chain address list (IP+cross-chain port)</p> <p>2&gt;peer own network connection, the node will reply to the address list (IP+ own chain port)</p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-11-send-receive-address-logic"><a href="#_2-3-11-send-receive-address-logic" aria-hidden="true" class="header-anchor">#</a> 2.3.11 Send/Receive Address Logic</h4> <ul><li><p>Function Description:</p> <p>Receiver protocol message processing logic for receiving network transmission</p></li> <li><p>Process description</p> <p>Send addr:</p></li></ul> <p>1&gt; When a new node is accessed, an addr message is broadcast to other peers of the same nodegroup.</p> <p>2&gt; When the getaddr message is requested, the addr message will be replied.</p> <p>Receive addr:</p> <p>1&gt; Determine whether the address is already owned locally. If you do not forward it, get the new addr.</p> <p>2&gt; The received node can be forwarded only after it has been authenticated by the connection.</p> <ul><li>Dependent service</li></ul> <h4 id="_2-3-12-cross-chain-server-port-delivery"><a href="#_2-3-12-cross-chain-server-port-delivery" aria-hidden="true" class="header-anchor">#</a> 2.3.12 Cross-chain server port delivery</h4> <ul><li><p>Function Description:</p> <p>A node can have two roles, one is to maintain its own internal chain network.The other is to maintain a cross-chain network as a cross-chain role.</p> <p>Therefore, in the server definition, we distinguish the port listeners of the two networks so that they are relatively independent.The own chain defines a serverPort1, and the cross-chain part defines a serverPort2.</p></li> <li><p>Process description</p> <p>As shown in the figure below, our main network chain network and the parallel chain network generate a cross-chain connection. When there is a node 2 in the main network chain connected to node 1, the connection is established through the internal service Port1, and node 1 can be the node 2 The node A sent to the friend chain and the node B are connected, and the information sent to the friend chain at this time should be serverPort2, so the serverPort2 needs to be transferred in the internal interaction of the main network chain.We define this part of the data in the version protocol for delivery.</p> <pre><code>![](./image/network-module/crossPortDeliver.png)
</code></pre></li></ul> <ul><li>Dependent service</li></ul> <h2 id="description-of-the-event"><a href="#description-of-the-event" aria-hidden="true" class="header-anchor">#</a> Description of the event</h2> <h3 id="_3-1-published-events"><a href="#_3-1-published-events" aria-hidden="true" class="header-anchor">#</a> 3.1 Published events</h3> <p>No</p> <h3 id="_3-2-subscribe-to-events"><a href="#_3-2-subscribe-to-events" aria-hidden="true" class="header-anchor">#</a> 3.2 Subscribe to events</h3> <p>No</p> <h2 id="agreement"><a href="#agreement" aria-hidden="true" class="header-anchor">#</a> Agreement</h2> <h3 id="_4-1-network-communication-protocol"><a href="#_4-1-network-communication-protocol" aria-hidden="true" class="header-anchor">#</a> 4.1 Network Communication Protocol</h3> <h4 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> version</h4> <p>Used to establish a connection (handshake)</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>version</td> <td>uint32</td> <td>Protocol version identifier used by the node</td></tr> <tr><td>20</td> <td>addr_you</td> <td>byte[20]</td> <td>The other party's network address [IP+PORT1+PORT2] PORT2 is a cross-chain server port such as: [10.32.12.25 8003 9003] 16byte+2byte+2byte</td></tr> <tr><td>20</td> <td>addr_me</td> <td>byte[20]</td> <td>The network address of this node [IP+PORT1+PORT2] PORT2 is a cross-chain server port such as: [20.32.12.25 7003 6003] 16byte+2byte+2byte</td></tr> <tr><td>4</td> <td>block_height</td> <td>uint32</td> <td>Node Height</td></tr> <tr><td>?</td> <td>block_hash</td> <td>varInt</td> <td>Block hash</td></tr> <tr><td>??</td> <td>extend</td> <td>VarByte</td> <td>Extended field, no more than 10 bytes?</td></tr></tbody></table> <h4 id="verack"><a href="#verack" aria-hidden="true" class="header-anchor">#</a> verack</h4> <p>Used to answer version</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>1</td> <td>ack_code</td> <td>uint8</td> <td>Return code, 1 for normal, 2 for connection is full</td></tr></tbody></table> <h4 id="ping"><a href="#ping" aria-hidden="true" class="header-anchor">#</a> ping</h4> <p>Used to maintain the connection. After receiving a message for a certain node for a period of time, the message is sent. If the pong message is received, the node remains connected. Otherwise, the connection is closed and the node is deleted.</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>randomCode</td> <td>uint32</td> <td>Random Numbers</td></tr></tbody></table> <h4 id="pong"><a href="#pong" aria-hidden="true" class="header-anchor">#</a> pong</h4> <p>Used to respond to ping</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>randomCode</td> <td>uint32</td> <td>Random Numbers</td></tr></tbody></table> <h4 id="getaddr"><a href="#getaddr" aria-hidden="true" class="header-anchor">#</a> getaddr</h4> <p>Used to request connection information for available nodes in the network.</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>2</td> <td>chainId</td> <td>uint16</td> <td>Chain id</td></tr> <tr><td>1</td> <td>isCrossAddress</td> <td>uint8</td> <td>Whether to request a cross-chain address</td></tr></tbody></table> <h4 id="addr"><a href="#addr" aria-hidden="true" class="header-anchor">#</a> addr</h4> <p>It is used to answer getaddr, or announce its existence to the network. After receiving the message, the node determines whether the node is known. If it is an unknown node, it saves it and propagates the address to the network after it passes the verification.</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>??</td> <td>addr_list</td> <td>network address</td> <td>18 bytes per node (16 bytes IP + 2 bytes port)</td></tr></tbody></table> <h4 id="bye"><a href="#bye" aria-hidden="true" class="header-anchor">#</a> bye</h4> <p>Used for peer-to-peer connection to actively disconnect, denial of service peer message service</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>1</td> <td>byeCode</td> <td>uint8</td> <td>Reserved Fields</td></tr></tbody></table> <h4 id="gettime"><a href="#gettime" aria-hidden="true" class="header-anchor">#</a> getTime</h4> <p>Used to get time from the peer node</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>messageId</td> <td>uint32</td> <td>Request id</td></tr></tbody></table> <h4 id="responsetime"><a href="#responsetime" aria-hidden="true" class="header-anchor">#</a> responseTime</h4> <p>Reply to peer node time</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>messageId</td> <td>uint32</td> <td>Request id</td></tr> <tr><td>4</td> <td>time</td> <td>uint32</td> <td>Time Value</td></tr></tbody></table> <h3 id="_4-2-trading-agreement"><a href="#_4-2-trading-agreement" aria-hidden="true" class="header-anchor">#</a> 4.2 Trading Agreement</h3> <p>No</p> <h2 id="module-configuration"><a href="#module-configuration" aria-hidden="true" class="header-anchor">#</a> Module configuration</h2> <div class="language- extra-class"><pre class="language-text"><code>[network]
port=18001
crossPort=18002
#魔法参
packetMagic=20190807
#籽点
selfSeedIps=39.98.226.51:18001,47.244.186.65:18001,47.254.234.223:18001,47.74.86.85:18001
#Main-network cross-chain seed connection node for initial connection of parallel chain
moonSeedIps=39.98.226.51:18002,47.244.186.65:18002,47.254.234.223:18002,47.74.86.85:18002
#Maximum number of network connections
maxInCount=100
#Maximum number of outgoing connections
maxOutCount=20
</code></pre></div><h2 id="java-specific-design"><a href="#java-specific-design" aria-hidden="true" class="header-anchor">#</a> Java-specific design</h2> <p>[^Description]: Core object class definition, storage data structure, ...</p> <h2 id="supplementary-content"><a href="#supplementary-content" aria-hidden="true" class="header-anchor">#</a> Supplementary content</h2> <p>[^Description]: Required content not covered above</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/master/docs/Docs/d_network.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/9/2019, 7:49:52 PM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Docs/d_ledger.html">
          Design document of ledger module
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.a4a6b4ef.js" defer></script><script src="/assets/js/5.f8a6f45b.js" defer></script>
  </body>
</html>
