<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Smart contract offline assembly |  </title>
    <meta name="description" content="Making It Easier To Innovate">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.601feec8.css" as="style"><link rel="preload" href="/assets/js/app.2df9194a.js" as="script"><link rel="preload" href="/assets/js/68.2ecfeb2d.js" as="script"><link rel="prefetch" href="/assets/js/10.0c5e14a0.js"><link rel="prefetch" href="/assets/js/100.9bc70f99.js"><link rel="prefetch" href="/assets/js/101.e70e6488.js"><link rel="prefetch" href="/assets/js/102.36d0eeb6.js"><link rel="prefetch" href="/assets/js/103.c48f6d10.js"><link rel="prefetch" href="/assets/js/104.36753511.js"><link rel="prefetch" href="/assets/js/105.d147a0e1.js"><link rel="prefetch" href="/assets/js/106.f182ac7d.js"><link rel="prefetch" href="/assets/js/107.1969c1c9.js"><link rel="prefetch" href="/assets/js/108.c4161ad1.js"><link rel="prefetch" href="/assets/js/109.d2fc6225.js"><link rel="prefetch" href="/assets/js/11.7172d40b.js"><link rel="prefetch" href="/assets/js/110.fc717fd0.js"><link rel="prefetch" href="/assets/js/111.e520750d.js"><link rel="prefetch" href="/assets/js/112.33215634.js"><link rel="prefetch" href="/assets/js/113.9487a4e1.js"><link rel="prefetch" href="/assets/js/114.4af66897.js"><link rel="prefetch" href="/assets/js/115.ed788b3b.js"><link rel="prefetch" href="/assets/js/116.a3aa3f28.js"><link rel="prefetch" href="/assets/js/117.fbb038f5.js"><link rel="prefetch" href="/assets/js/118.410c8a90.js"><link rel="prefetch" href="/assets/js/119.e980ed78.js"><link rel="prefetch" href="/assets/js/12.b157bf5f.js"><link rel="prefetch" href="/assets/js/120.8c80d17f.js"><link rel="prefetch" href="/assets/js/121.119f8321.js"><link rel="prefetch" href="/assets/js/122.2d6bb1e9.js"><link rel="prefetch" href="/assets/js/123.b04b0728.js"><link rel="prefetch" href="/assets/js/124.c6799b6b.js"><link rel="prefetch" href="/assets/js/125.4bed92f5.js"><link rel="prefetch" href="/assets/js/126.1124084b.js"><link rel="prefetch" href="/assets/js/127.3ef53bc0.js"><link rel="prefetch" href="/assets/js/128.ec5465b4.js"><link rel="prefetch" href="/assets/js/129.fa88d4f1.js"><link rel="prefetch" href="/assets/js/13.ded8ed02.js"><link rel="prefetch" href="/assets/js/130.a59920b5.js"><link rel="prefetch" href="/assets/js/131.6f6a30ae.js"><link rel="prefetch" href="/assets/js/132.dd3264be.js"><link rel="prefetch" href="/assets/js/133.9cf69d7d.js"><link rel="prefetch" href="/assets/js/134.044ab96a.js"><link rel="prefetch" href="/assets/js/135.0039ff10.js"><link rel="prefetch" href="/assets/js/136.e2e2a54e.js"><link rel="prefetch" href="/assets/js/137.a805007d.js"><link rel="prefetch" href="/assets/js/138.f1c7f601.js"><link rel="prefetch" href="/assets/js/139.2663676f.js"><link rel="prefetch" href="/assets/js/14.518e22ea.js"><link rel="prefetch" href="/assets/js/140.71976055.js"><link rel="prefetch" href="/assets/js/141.5a61780a.js"><link rel="prefetch" href="/assets/js/142.16220828.js"><link rel="prefetch" href="/assets/js/143.ff3fcc2d.js"><link rel="prefetch" href="/assets/js/144.c59d3810.js"><link rel="prefetch" href="/assets/js/145.84df8247.js"><link rel="prefetch" href="/assets/js/146.db747b14.js"><link rel="prefetch" href="/assets/js/147.e90628dd.js"><link rel="prefetch" href="/assets/js/148.c43ff8fd.js"><link rel="prefetch" href="/assets/js/149.b937fefc.js"><link rel="prefetch" href="/assets/js/15.4b3dc8bd.js"><link rel="prefetch" href="/assets/js/150.99281254.js"><link rel="prefetch" href="/assets/js/151.c38d135d.js"><link rel="prefetch" href="/assets/js/152.754bf6a4.js"><link rel="prefetch" href="/assets/js/16.13d0211e.js"><link rel="prefetch" href="/assets/js/17.f6e10861.js"><link rel="prefetch" href="/assets/js/18.cb2593a2.js"><link rel="prefetch" href="/assets/js/19.4edbd542.js"><link rel="prefetch" href="/assets/js/2.3da0e489.js"><link rel="prefetch" href="/assets/js/20.88ddbd1c.js"><link rel="prefetch" href="/assets/js/21.faa96d43.js"><link rel="prefetch" href="/assets/js/22.38f942c3.js"><link rel="prefetch" href="/assets/js/23.3f297858.js"><link rel="prefetch" href="/assets/js/24.f60196ef.js"><link rel="prefetch" href="/assets/js/25.36c9da09.js"><link rel="prefetch" href="/assets/js/26.2019d528.js"><link rel="prefetch" href="/assets/js/27.ebe9591a.js"><link rel="prefetch" href="/assets/js/28.8a71b3ce.js"><link rel="prefetch" href="/assets/js/29.761f1315.js"><link rel="prefetch" href="/assets/js/3.3b28a50c.js"><link rel="prefetch" href="/assets/js/30.0d78fd34.js"><link rel="prefetch" href="/assets/js/31.455baee2.js"><link rel="prefetch" href="/assets/js/32.ee627427.js"><link rel="prefetch" href="/assets/js/33.ce1f9222.js"><link rel="prefetch" href="/assets/js/34.da477209.js"><link rel="prefetch" href="/assets/js/35.61d6313b.js"><link rel="prefetch" href="/assets/js/36.45ef79c2.js"><link rel="prefetch" href="/assets/js/37.8d584f1f.js"><link rel="prefetch" href="/assets/js/38.5daa3c2b.js"><link rel="prefetch" href="/assets/js/39.3fee31fb.js"><link rel="prefetch" href="/assets/js/4.9bf7c824.js"><link rel="prefetch" href="/assets/js/40.64ebbb72.js"><link rel="prefetch" href="/assets/js/41.0caac018.js"><link rel="prefetch" href="/assets/js/42.e9a0686e.js"><link rel="prefetch" href="/assets/js/43.46a6c6ec.js"><link rel="prefetch" href="/assets/js/44.71db9aeb.js"><link rel="prefetch" href="/assets/js/45.8420eebd.js"><link rel="prefetch" href="/assets/js/46.3ffccd37.js"><link rel="prefetch" href="/assets/js/47.0dc8e60f.js"><link rel="prefetch" href="/assets/js/48.4a25340b.js"><link rel="prefetch" href="/assets/js/49.81251dda.js"><link rel="prefetch" href="/assets/js/5.f8fa80eb.js"><link rel="prefetch" href="/assets/js/50.7a68e1b2.js"><link rel="prefetch" href="/assets/js/51.810ace8e.js"><link rel="prefetch" href="/assets/js/52.3fb11e5b.js"><link rel="prefetch" href="/assets/js/53.51e1b163.js"><link rel="prefetch" href="/assets/js/54.a193919b.js"><link rel="prefetch" href="/assets/js/55.ed77a75a.js"><link rel="prefetch" href="/assets/js/56.cf8d783d.js"><link rel="prefetch" href="/assets/js/57.0c17175b.js"><link rel="prefetch" href="/assets/js/58.3ddb5f2e.js"><link rel="prefetch" href="/assets/js/59.68a213bb.js"><link rel="prefetch" href="/assets/js/6.1c8f1000.js"><link rel="prefetch" href="/assets/js/60.a0636ebc.js"><link rel="prefetch" href="/assets/js/61.fc72f2e7.js"><link rel="prefetch" href="/assets/js/62.4fa897e2.js"><link rel="prefetch" href="/assets/js/63.2d20b2a2.js"><link rel="prefetch" href="/assets/js/64.d5daa534.js"><link rel="prefetch" href="/assets/js/65.594e30f7.js"><link rel="prefetch" href="/assets/js/66.a868f08c.js"><link rel="prefetch" href="/assets/js/67.611d69ab.js"><link rel="prefetch" href="/assets/js/69.299a4679.js"><link rel="prefetch" href="/assets/js/7.6ddd6e53.js"><link rel="prefetch" href="/assets/js/70.db68d2a2.js"><link rel="prefetch" href="/assets/js/71.ce42dcd6.js"><link rel="prefetch" href="/assets/js/72.38ac2674.js"><link rel="prefetch" href="/assets/js/73.bd7f9811.js"><link rel="prefetch" href="/assets/js/74.0afd81ce.js"><link rel="prefetch" href="/assets/js/75.e3619d1c.js"><link rel="prefetch" href="/assets/js/76.2d0d598d.js"><link rel="prefetch" href="/assets/js/77.92f479e8.js"><link rel="prefetch" href="/assets/js/78.95fc9d7c.js"><link rel="prefetch" href="/assets/js/79.bfd42746.js"><link rel="prefetch" href="/assets/js/8.57bc7818.js"><link rel="prefetch" href="/assets/js/80.79249f41.js"><link rel="prefetch" href="/assets/js/81.94e759cb.js"><link rel="prefetch" href="/assets/js/82.0808b875.js"><link rel="prefetch" href="/assets/js/83.84b2875f.js"><link rel="prefetch" href="/assets/js/84.bfc04846.js"><link rel="prefetch" href="/assets/js/85.b8453670.js"><link rel="prefetch" href="/assets/js/86.53298a14.js"><link rel="prefetch" href="/assets/js/87.332e1ec8.js"><link rel="prefetch" href="/assets/js/88.eec1ee38.js"><link rel="prefetch" href="/assets/js/89.9de51cb3.js"><link rel="prefetch" href="/assets/js/9.9b98df55.js"><link rel="prefetch" href="/assets/js/90.93579a5d.js"><link rel="prefetch" href="/assets/js/91.9494f211.js"><link rel="prefetch" href="/assets/js/92.f3f4a19f.js"><link rel="prefetch" href="/assets/js/93.fb09d292.js"><link rel="prefetch" href="/assets/js/94.396b8118.js"><link rel="prefetch" href="/assets/js/95.df06706e.js"><link rel="prefetch" href="/assets/js/96.46d03f61.js"><link rel="prefetch" href="/assets/js/97.1aaa0edd.js"><link rel="prefetch" href="/assets/js/98.56c53e9d.js"><link rel="prefetch" href="/assets/js/99.09ea7286.js">
    <link rel="stylesheet" href="/assets/css/0.styles.601feec8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> </span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/s_offline_assembly.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/s_offline_assembly.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/s_offline_assembly.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/s_offline_assembly.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Module Design</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/d_network.html" class="sidebar-link">Network module design document</a></li><li><a href="/Docs/d_ledger.html" class="sidebar-link">Design document of ledger module</a></li><li><a href="/Docs/d_chain_manager.html" class="sidebar-link">Chain Management Module Design Document</a></li><li><a href="/Docs/d_account.html" class="sidebar-link">Account Module Design Document</a></li><li><a href="/Docs/d_smart_contract.html" class="sidebar-link">Smart contract module design</a></li><li><a href="/Docs/d_transaction.html" class="sidebar-link">Transaction management module Design document</a></li><li><a href="/Docs/d_cross_chain.html" class="sidebar-link">Overall description</a></li><li><a href="/Docs/d_consensus.html" class="sidebar-link">Consensus Module Design Document</a></li><li><a href="/Docs/d_public_service.html" class="sidebar-link">Public-Service Module Design Document</a></li><li><a href="/Docs/d_block.html" class="sidebar-link">Block Management Module Design Document</a></li><li><a href="/Docs/d_protocol_update.html" class="sidebar-link">Upgrade module design document</a></li><li><a href="/Docs/d_address.html" class="sidebar-link">NULS Protocol Address</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interface</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/i_rpc_protocol.html" class="sidebar-link">NULS Application Interface Services</a></li><li><a href="/Docs/i_public_service.html" class="sidebar-link">Public Service</a></li><li><a href="/Docs/i_nuls-api_JSONRPC.html" class="sidebar-link">API-JSONRPC</a></li><li><a href="/Docs/i_nuls-api_RESTFUL.html" class="sidebar-link">API-RESTFUL</a></li><li><a href="/Docs/i_account.html" class="sidebar-link">Account Module</a></li><li><a href="/Docs/i_chain-manager.html" class="sidebar-link">Why should I have the Chain Management module?</a></li><li><a href="/Docs/i_cross-chain.html" class="sidebar-link">Interface List</a></li><li><a href="/Docs/i_network.html" class="sidebar-link">Why should I have &quot;Network Module&quot;?</a></li><li><a href="/Docs/i_block.html" class="sidebar-link">Block Module</a></li><li><a href="/Docs/i_transaction.html" class="sidebar-link">Transaction module</a></li><li><a href="/Docs/i_consensus.html" class="sidebar-link">poc Consensus Module</a></li><li><a href="/Docs/i_smart-contract.html" class="sidebar-link">Smart contract module</a></li><li><a href="/Docs/i_ledger.html" class="sidebar-link">Ledger Module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>ChainBox</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/c_chain_box.html" class="sidebar-link">NULS ChainBox</a></li><li><a href="/Docs/c_module.html" class="sidebar-link">Develope Module</a></li><li><a href="/Docs/c_message_module.html" class="sidebar-link">Encrypted Message Module Demo</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/s_manual.html" class="sidebar-link">Development Manual</a></li><li><a href="/Docs/s_tools.html" class="sidebar-link">Development Tool</a></li><li><a href="/Docs/s_nrc20.html" class="sidebar-link">NRC-20</a></li><li><a href="/Docs/s_nrc721.html" class="sidebar-link">NRC-721</a></li><li><a href="/Docs/s_offline_assembly.html" aria-current="page" class="active sidebar-link">Smart contract offline assembly</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-java-sdk" class="sidebar-link">1. Java SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-1-add-mavan-dependence" class="sidebar-link">1.1 Add Mavan Dependence</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-2-sdk-initial" class="sidebar-link">1.2 SDK initial</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-3-create-contract-transaction" class="sidebar-link">1.3 Create contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-4-call-contract-transaction" class="sidebar-link">1.4 Call contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_1-5-delete-contract-transaction" class="sidebar-link">1.5 Delete contract transaction</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_2-java-offline-assembly-contract-transaction-code-detailed-explanation" class="sidebar-link">2. Java - Offline assembly contract transaction code detailed explanation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_2-1-create-contract-transaction" class="sidebar-link">2.1 Create contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_2-2-call-contract-transaction" class="sidebar-link">2.2 Call contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_2-3-delete-contract-transaction" class="sidebar-link">2.3 Delete contract transaction</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_3-javascript-sdk" class="sidebar-link">3. JavaScript SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_3-1-create-contract-transaction" class="sidebar-link">3.1 Create contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_3-2-call-contract-transaction" class="sidebar-link">3.2 Call contract transaction</a></li><li class="sidebar-sub-header"><a href="/Docs/s_offline_assembly.html#_3-3-delete-contract-transaction" class="sidebar-link">3.3 Delete contract transaction</a></li></ul></li></ul></li><li><a href="/Docs/s_advance.html" class="sidebar-link">Advanced Description</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="smart-contract-offline-assembly"><a href="#smart-contract-offline-assembly" class="header-anchor">#</a> Smart contract offline assembly</h1> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><p>Users: Create a transaction without using the node API, ie: The user whose private key is saved locally</p></li> <li><p>The difference between offline and online</p> <ul><li>Offline: The private key is saved locally</li> <li>Online: The private key is saved on the node</li></ul></li></ul> <p><strong>Smart Contracts There are three types of transactions to be assembled, namely <code>Create Contract</code>, <code>Call Contract</code>, <code>Delete Contract</code>. The following will introduce the offline assembly methods of these three transactions using <code>Java</code> language and <code>JavaScript</code> language respectively.</strong></p> <blockquote><p><strong><code>nrc20 contract code</code></strong> is used as an example in the documentation</p></blockquote> <h2 id="_1-java-sdk"><a href="#_1-java-sdk" class="header-anchor">#</a> 1. Java SDK</h2> <h3 id="_1-1-add-mavan-dependence"><a href="#_1-1-add-mavan-dependence" class="header-anchor">#</a> 1.1 Add Mavan Dependence</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- JDK11 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.nuls.v2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sdk4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- JDK8 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.nuls.v2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sdk4j-jdk8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_1-2-sdk-initial"><a href="#_1-2-sdk-initial" class="header-anchor">#</a> 1.2 SDK initial</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// test net SDK initial</span>
<span class="token class-name">NulsSDKBootStrap</span><span class="token punctuation">.</span><span class="token function">initTest</span><span class="token punctuation">(</span><span class="token string">&quot;http://beta.api.nuls.io/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// main net SDK initial</span>
<span class="token class-name">NulsSDKBootStrap</span><span class="token punctuation">.</span><span class="token function">initMain</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.nuls.io/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-3-create-contract-transaction"><a href="#_1-3-create-contract-transaction" class="header-anchor">#</a> 1.3 Create contract transaction</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">String</span> alias <span class="token operator">=</span> <span class="token string">&quot;nrc20_token&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractCode <span class="token operator">=</span> <span class="token string">&quot;504b03040a0000080000....&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;air&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AIR&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Verify the legality of creating the contract, you can skip verification</span>
    <span class="token class-name">ContractValidateCreateForm</span> vForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateCreateForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setContractCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>MAX_GASLIMIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>CONTRACT_MINIMUM_PRICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractCreate</span><span class="token punctuation">(</span>vForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>vResult<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> vMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> vMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> vMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Estimate the GAS required to create the contract, you can skip estimate, write a reasonable value offline</span>
    <span class="token class-name">ImputedGasContractCreateForm</span> iForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImputedGasContractCreateForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setContractCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> iResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">imputedContractCreateGas</span><span class="token punctuation">(</span>iForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>iResult<span class="token punctuation">)</span><span class="token punctuation">,</span> iResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> iResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Get the constructor of the code, generate an array of parameter types, if you know the type, write the type array yourself, you can not call this interface</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContractConstructorInfoDto</span><span class="token punctuation">&gt;</span></span> constructorR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>constructorR<span class="token punctuation">)</span><span class="token punctuation">,</span> constructorR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ContractConstructorInfoDto</span> dto <span class="token operator">=</span> constructorR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsType <span class="token operator">=</span> dto<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">argsType2Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (not skipable, must be called) - Get account balance information</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Assembling an offline transaction that create a contract</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOfflineR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">createContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> contractCode<span class="token punctuation">,</span> gasLimit<span class="token punctuation">,</span> args<span class="token punctuation">,</span> argsType<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOfflineR<span class="token punctuation">)</span><span class="token punctuation">,</span> txOfflineR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> txOfflineR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;contractAddress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Signature transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface - Broadcast transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcastTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcastTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s, contractAddress: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> contractAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-4-call-contract-transaction"><a href="#_1-4-call-contract-transaction" class="header-anchor">#</a> 1.4 Call contract transaction</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>main_chain_id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> value <span class="token operator">=</span> <span class="token class-name">BigInteger</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaN3xDUFWonWsfsuG4kJKy2WajtjZbuB&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodDesc <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;tNULSeBaMnrs6JKrCy6TQdzYJZkMZJDng7QAsD&quot;</span><span class="token punctuation">,</span> <span class="token number">3800</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_call_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Verify the legality of calling the contract, you can skip verification</span>
    <span class="token class-name">ContractValidateCallForm</span> validateCallForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateCallForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>MAX_GASLIMIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>CONTRACT_MINIMUM_PRICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractCall</span><span class="token punctuation">(</span>validateCallForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>vResult<span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Estimate the GAS required to call the contract, you can skip estimate, write a reasonable value offline</span>
    <span class="token class-name">ImputedGasContractCallForm</span> iForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImputedGasContractCallForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> iResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">imputedContractCallGas</span><span class="token punctuation">(</span>iForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>iResult<span class="token punctuation">)</span><span class="token punctuation">,</span> iResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> iResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> assetChainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_chain_id<span class="token punctuation">;</span>
    <span class="token keyword">int</span> assetId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_asset_id<span class="token punctuation">;</span>
    <span class="token comment">// online interface (skipable) - Generate an array of parameter types. If the type is known, write the type array yourself, you can not call this interface.</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ContractMethodForm</span> cFrom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractMethodForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Result</span> cResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getContractMethodArgsTypes</span><span class="token punctuation">(</span>cFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>cResult<span class="token punctuation">)</span><span class="token punctuation">,</span> cResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> cResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        argsType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
        argsType <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>argsType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// online interface (not skipable, must be called) - Get account balance information</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Assembling an offline transaction that call a contract</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOfflineR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">callContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> value<span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> gasLimit<span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> methodDesc<span class="token punctuation">,</span> args<span class="token punctuation">,</span> argsType<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOfflineR<span class="token punctuation">)</span><span class="token punctuation">,</span> txOfflineR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> txMap <span class="token operator">=</span> txOfflineR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Signature transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface - Broadcast transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcastTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcastTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-5-delete-contract-transaction"><a href="#_1-5-delete-contract-transaction" class="header-anchor">#</a> 1.5 Delete contract transaction</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>main_chain_id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaN2YfwVSBCwf35CgD5HtKa5gYGmLgCK&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_delete_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (skipable) - Verify the legality of deleting the contract, you can skip verification</span>
    <span class="token class-name">ContractValidateDeleteForm</span> dForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateDeleteForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractDelete</span><span class="token punctuation">(</span>dForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>vResult<span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface (not skipable, must be called) - Get account balance information</span>
    <span class="token keyword">int</span> assetChainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_chain_id<span class="token punctuation">;</span>
    <span class="token keyword">int</span> assetId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_asset_id<span class="token punctuation">;</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Assembling an offline transaction that delete a contract</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOffline <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">deleteContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOffline<span class="token punctuation">)</span><span class="token punctuation">,</span> txOffline<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> txMap <span class="token operator">=</span> txOffline<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// offline interface - Signature transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// online interface - Broadcast transaction</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcastTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcastTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hash inconsistent&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_2-java-offline-assembly-contract-transaction-code-detailed-explanation"><a href="#_2-java-offline-assembly-contract-transaction-code-detailed-explanation" class="header-anchor">#</a> 2. Java - Offline assembly contract transaction code detailed explanation</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The id of the main chain, 2 in the example</span>
<span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// The asset id of the main chain, 1 used in the example</span>
<span class="token keyword">int</span> assetsId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-1-create-contract-transaction"><a href="#_2-1-create-contract-transaction" class="header-anchor">#</a> 2.1 Create contract transaction</h3> <p>The transaction for assembling the release contract needs to interact with the apiModule four times.</p> <ul><li>Get the constructor</li> <li>Verify the legality of the execution of the release contract</li> <li>Estimated gas required for the release of the contract</li> <li>Get the balance and nonce of the transaction creator</li></ul> <p><strong>Initial data: <code>transaction creator address</code>, <code>contract code bytecode Hex string</code>, <code>contract alias</code>, <code>transaction comment</code></strong></p> <h4 id="_2-1-1-calling-the-interface-to-get-the-contract-code-constructor"><a href="#_2-1-1-calling-the-interface-to-get-the-contract-code-constructor" class="header-anchor">#</a> 2.1.1) Calling the interface to get the contract code constructor</h4> <ul><li><p>Interface: getContractConstructor</p></li> <li><p>Parameters: chainId, contractCode</p> <p>chainId : int //chain ID</p> <p>contractCode: String // file byte stream conversion Hex encoded string</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractConstructor&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;constructor&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(String name, String symbol, BigInteger initialAmount, int decimals) return void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BigInteger&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;initialAmount&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;decimals&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span>
               <span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token property">&quot;returnArg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;payable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;isNrc20&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-2-assemble-parameter-data-according-to-constructor-parameters-if-there-is-no-parameter-function-skip-this-step"><a href="#_2-1-2-assemble-parameter-data-according-to-constructor-parameters-if-there-is-no-parameter-function-skip-this-step" class="header-anchor">#</a> 2.1.2) Assemble parameter data according to constructor parameters(<strong>if there is no parameter function, skip this step</strong>)</h4> <ul><li><p>Assemble the argument types of the constructor into a string array</p> <blockquote><p>Get this type of data from the <code>getContractConstructor</code> interface</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Map</span> constructor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;args&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    argTypes<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// In this example argTypes contains four elements {&quot;String&quot;, &quot;String&quot;, &quot;BigInteger&quot;, &quot;int&quot;}</span>
</code></pre></div></li> <li><p>Add a parameter to the array using a one-dimensional Object array, in order</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;nulsIsEverything&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NULS&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>Convert a one-dimensional array of parameters to a two-dimensional array (this step is due to the two-dimensional array accepted by the contract method parameters on the chain)</p> <blockquote><p>Copy this method <code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code> to the offline transaction assembly tool (eg. SDK)</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> <span class="token class-name">ContractUtil</span><span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_2-1-3-calling-the-interface-to-verify-the-legality-of-the-release-contract"><a href="#_2-1-3-calling-the-interface-to-verify-the-legality-of-the-release-contract" class="header-anchor">#</a> 2.1.3) Calling the interface to verify the legality of the release contract</h4> <ul><li><p>Interface: validateContractCreate</p></li> <li><p>Parameters: chainId, sender, gasLimit, price, contractCode, args</p> <p>chainId : int //chain ID</p> <p>Sender: String // caller address</p> <p>gasLimit: long // gas limit</p> <p>Price: long // unit price</p> <p>contractCode: String // file byte stream conversion Hex encoded string</p> <p>Args: Object[] // constructor argument</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit and price use default values: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCreate&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code> is <code>true</code>, indicating that the validation passed, otherwise, <code>success</code> is <code>false</code>, <code>msg</code> is the error message</p></blockquote> <h4 id="_2-1-4-calling-the-interface-to-estimate-the-gas-required-for-the-release-contract"><a href="#_2-1-4-calling-the-interface-to-estimate-the-gas-required-for-the-release-contract" class="header-anchor">#</a> 2.1.4) Calling the interface to estimate the gas required for the release contract</h4> <ul><li><p>Interface: imputedContractCreateGas</p></li> <li><p>Parameters: chainId, sender, contractCode, args</p> <p>chainId : int //chain ID</p> <p>Sender: String // caller address</p> <p>contractCode: String // file byte stream conversion Hex encoded string</p> <p>Args: Object[] // constructor argument</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCreateGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">22363</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>**Required data: **</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-1-5-randomly-generate-a-smart-contract-address"><a href="#_2-1-5-randomly-generate-a-smart-contract-address" class="header-anchor">#</a> 2.1.5) Randomly generate a smart contract address</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Address</span> contract <span class="token operator">=</span> <span class="token class-name">AccountTool</span><span class="token punctuation">.</span><span class="token function">createContractAddress</span><span class="token punctuation">(</span>chainId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contractAddressBytes <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">getAddressBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// String contractAddress = contract.toString();</span>
</code></pre></div><h4 id="_2-1-6-through-the-data-obtained-in-the-above-5-steps-assemble-the-transaction-txdata"><a href="#_2-1-6-through-the-data-obtained-in-the-above-5-steps-assemble-the-transaction-txdata" class="header-anchor">#</a> 2.1.6) Through the data obtained in the above 5 steps, assemble the transaction txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The address of the transaction creator</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit is obtained from the interface in step 4</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">22363</span><span class="token punctuation">;</span>
<span class="token comment">// default gas unit price, system minimum unit price</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token class-name">CreateContractData</span> createContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-7-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator"><a href="#_2-1-7-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator" class="header-anchor">#</a> 2.1.7) Call the interface to get the nonce value of the transaction creator</h4> <ul><li><p>Interface: getAccountBalance</p></li> <li><p>Parameters: chainId, assetChainId, assetId, address</p> <p>chainId: int //chain id</p> <p>assetChainId: int //chain id corresponding to the asset</p> <p>assetId : int // asset id</p> <p>Address : String //Account address</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>**Required data: **</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-1-8-by-the-data-obtained-in-the-above-7-steps-assemble-the-transaction-object-of-the-release-contract"><a href="#_2-1-8-by-the-data-obtained-in-the-above-7-steps-assemble-the-transaction-object-of-the-release-contract" class="header-anchor">#</a> 2.1.8) By the data obtained in the above 7 steps, assemble the transaction object of the release contract</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CreateContractTransaction</span> <span class="token function">newCreateTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">CreateContractData</span> createContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">CreateContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Calculate CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> createContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">CoinData</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">ContractData</span> contractData<span class="token punctuation">,</span> <span class="token keyword">int</span> txSize<span class="token punctuation">,</span> <span class="token keyword">int</span> txDataSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> gasUsed <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getGasLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> imputedValue <span class="token operator">=</span> <span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">LongUtils</span><span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>gasUsed<span class="token punctuation">,</span> contractData<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// total cost</span>
    <span class="token class-name">BigInteger</span> value <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> totalValue <span class="token operator">=</span> imputedValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CoinFrom</span> coinFrom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinFrom</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> totalValue<span class="token punctuation">,</span> <span class="token class-name">RPCUtil</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    coinData<span class="token punctuation">.</span><span class="token function">addFrom</span><span class="token punctuation">(</span>coinFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CoinTo</span> coinTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinTo</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getContractAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        coinData<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>coinTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">BigInteger</span> fee <span class="token operator">=</span> <span class="token class-name">TransactionFeeCalculator</span><span class="token punctuation">.</span><span class="token function">getNormalUnsignedTxFee</span><span class="token punctuation">(</span>txSize <span class="token operator">+</span> txDataSize <span class="token operator">+</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    totalValue <span class="token operator">=</span> totalValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>senderBalance<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Insufficient balance</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Insufficient balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    coinFrom<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coinData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calcSize</span><span class="token punctuation">(</span><span class="token class-name">NulsData</span> nulsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nulsData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> nulsData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// When calculating tx.size(), when coinData and txData are empty, 1 length is calculated. If nulsData is not empty at this time, the length is deducted.</span>
    <span class="token keyword">return</span> <span class="token class-name">VarInt</span><span class="token punctuation">.</span><span class="token function">sizeOf</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">+</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-1-9-signature-transaction-broadcast-transaction-omitted"><a href="#_2-1-9-signature-transaction-broadcast-transaction-omitted" class="header-anchor">#</a> 2.1.9) Signature transaction, broadcast transaction (omitted)</h4> <hr> <h3 id="_2-2-call-contract-transaction"><a href="#_2-2-call-contract-transaction" class="header-anchor">#</a> 2.2 Call contract transaction</h3> <p>The transaction that assembles the call contract needs to interact with apiModule three times or three times.</p> <ul><li>Get details of the contract method (skip this step if you have cached all the details of the contract)</li> <li>Verify the legality of the execution of the calling contract</li> <li>Estimated gas required to call the contract</li> <li>Get the balance and nonce of the transaction creator</li></ul> <p><strong>Initial data: <code>Transaction creator address</code>, <code>contract address</code>, <code>The amount of the main network asset transferred by the caller to the contract address</code>, <code>call method name</code>, <code>call method description</code>, <code>call method parameters</code>, <code>Transaction notes</code></strong></p> <h4 id="_2-2-1-call-the-interface-to-get-the-list-of-parameter-types-of-the-contract-method-if-you-cache-the-details-of-all-the-methods-of-the-contract-you-can-extract-the-parameter-type-list-of-the-method-from-the-cached-method-skip-this-step"><a href="#_2-2-1-call-the-interface-to-get-the-list-of-parameter-types-of-the-contract-method-if-you-cache-the-details-of-all-the-methods-of-the-contract-you-can-extract-the-parameter-type-list-of-the-method-from-the-cached-method-skip-this-step" class="header-anchor">#</a> 2.2.1) Call the interface to get the list of parameter types of the contract method(<strong>If you cache the details of all the methods of the contract, you can extract the parameter type list of the method from the cached method, skip this step</strong>)</h4> <blockquote><p>The role of this step is to get an array of parameter types of the method. For specific filtering data, please see <code>1.2.2</code></p></blockquote> <ul><li><p>Interface: getContractMethodArgsTypes</p></li> <li><p>Parameters: chainId, contractAddress, methodName, methodDesc</p> <p>chainId : int //chain ID</p> <p>contractAddress: String //Contract address</p> <p>methodName: String // contract method</p> <p>methodDesc: String // The contract method description (not required). If the method in the contract is not overloaded, this parameter can be empty.</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractMethodArgsTypes&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(Address to, BigInteger value) return boolean&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;Address&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;BigInteger&quot;</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-2-assemble-parameter-data-according-to-function-parameters-if-there-is-no-parameter-function-skip-this-step"><a href="#_2-2-2-assemble-parameter-data-according-to-function-parameters-if-there-is-no-parameter-function-skip-this-step" class="header-anchor">#</a> 2.2.2) Assemble parameter data according to function parameters** (if there is no parameter function, skip this step)**</h4> <ul><li><p>Assemble the parameter types of the function into a string array</p> <blockquote><p>Get this type of data from the <code>1.2.1</code> interface or get it from the cached method details</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
argTypes <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// In this case argTypes contains two elements {&quot;Address&quot;, &quot;BigInteger&quot;}</span>
</code></pre></div></li> <li><p>Add a parameter to the array using a one-dimensional Object array, in order</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;tNULSeBaMnrs6JKrCy6TQdzYJZkMZJDng7QAsD&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>Convert a one-dimensional array of parameters to a two-dimensional array (this step is due to the two-dimensional array accepted by the contract method parameters on the chain)</p> <blockquote><p>Copy this method <code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code> to the offline transaction assembly tool (eg. SDK)</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> <span class="token class-name">ContractUtil</span><span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_2-2-3-calling-the-interface-to-verify-the-legality-of-the-calling-contract"><a href="#_2-2-3-calling-the-interface-to-verify-the-legality-of-the-calling-contract" class="header-anchor">#</a> 2.2.3) Calling the interface to verify the legality of the calling contract</h4> <ul><li><p>Interface: validateContractCall</p></li> <li><p>Parameters: chainId, sender, value, gasLimit, price, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //chain ID</p> <p>Sender: String // caller address</p> <p>Value: BigInteger // The amount of the main network asset that the caller transferred to the contract address. If there is no such service, fill BigInteger.ZERO</p> <p>gasLimit: long // gas limit</p> <p>Price: long // unit price</p> <p>contractAddress: String // contract address</p> <p>methodName: String // contract method</p> <p>methodDesc: String // The contract method description. If the method in the contract is not overloaded, this parameter can be empty.</p> <p>Args: Object[] // constructor argument</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit and price use default values: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCall&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code> is <code>true</code>, indicating that the validation passed, otherwise, <code>success</code> is <code>false</code>, <code>msg</code> is the error message</p></blockquote> <h4 id="_2-2-4-calling-the-interface-to-estimate-the-gas-required-to-call-the-contract"><a href="#_2-2-4-calling-the-interface-to-estimate-the-gas-required-to-call-the-contract" class="header-anchor">#</a> 2.2.4) Calling the interface to estimate the gas required to call the contract</h4> <ul><li><p>Interface: imputedContractCallGas</p></li> <li><p>Parameters: chainId, sender, value, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //chain ID</p> <p>Sender: String // caller address</p> <p>Value: BigInteger // The amount of the main network asset that the caller transferred to the contract address. If there is no such service, fill BigInteger.ZERO</p> <p>contractAddress: String // contract address</p> <p>methodName: String // contract method</p> <p>methodDesc: String // The contract method description. If the method in the contract is not overloaded, this parameter can be empty.</p> <p>Args: Object[] // method parameters</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCallGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>

</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">10333</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-5-the-data-obtained-by-the-above-4-steps-assembly-transaction-txdata"><a href="#_2-2-5-the-data-obtained-by-the-above-4-steps-assembly-transaction-txdata" class="header-anchor">#</a> 2.2.5) The data obtained by the above 4 steps, assembly transaction txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The address of the transaction creator</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit is obtained from the interface in step 4</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">10333</span><span class="token punctuation">;</span>
<span class="token comment">// default gas unit price, system minimum unit price</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token comment">// value - the amount of the main chain asset that the transaction creator transferred to the contract address. If there is no such business, fill in BigInteger.ZERO</span>
<span class="token comment">// methodName - the transaction creator chooses the contract method to call</span>
<span class="token comment">// methodDesc - obtained by contractInfo, this parameter can be empty if there is no overload in the method within the contract</span>
<span class="token class-name">CallContractData</span> callContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-6-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator"><a href="#_2-2-6-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator" class="header-anchor">#</a> 2.2.6) Call the interface to get the nonce value of the transaction creator</h4> <ul><li><p>Interface: getAccountBalance</p></li> <li><p>Parameters: chainId, assetChainId, assetId, address</p> <p>chainId: int //chain id</p> <p>assetChainId: int //chain id corresponding to the asset</p> <p>assetId : int // asset id</p> <p>Address : String //Account address</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>**Required data: **</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-2-7-by-the-data-obtained-in-the-above-6-steps-assemble-the-transaction-object-of-the-release-contract"><a href="#_2-2-7-by-the-data-obtained-in-the-above-6-steps-assemble-the-transaction-object-of-the-release-contract" class="header-anchor">#</a> 2.2.7) By the data obtained in the above 6 steps, assemble the transaction object of the release contract</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CallContractTransaction</span> <span class="token function">newCallTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">CallContractData</span> callContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">CallContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Calculate CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> callContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-8-signature-transaction-broadcast-transaction-omitted"><a href="#_2-2-8-signature-transaction-broadcast-transaction-omitted" class="header-anchor">#</a> 2.2.8) Signature transaction, broadcast transaction (omitted)</h4> <hr> <h3 id="_2-3-delete-contract-transaction"><a href="#_2-3-delete-contract-transaction" class="header-anchor">#</a> 2.3 Delete contract transaction</h3> <p>The deal to assemble and delete the contract needs to interact with the apiModule twice.</p> <ul><li>Verify the legality of the execution of the calling contract</li> <li>Get the balance and nonce of the transaction creator</li></ul> <p><strong>Initial data: <code>Transaction creator address</code>, <code>contract address</code></strong></p> <h4 id="_2-3-1-calling-the-interface-to-verify-the-legality-of-the-deleted-contract"><a href="#_2-3-1-calling-the-interface-to-verify-the-legality-of-the-deleted-contract" class="header-anchor">#</a> 2.3.1) Calling the interface to verify the legality of the deleted contract</h4> <ul><li><p>Interface: validateContractDelete</p></li> <li><p>Parameters: chainId, sender, contractAddress</p> <p>chainId : int //chain ID</p> <p>Sender: String // caller address</p> <p>contractAddress: String // contract address</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractDelete&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code> is <code>true</code>, indicating that the validation passed, otherwise, <code>success</code> is <code>false</code>, <code>msg</code> is the error message</p></blockquote> <h4 id="_2-3-2-assembly-transaction-txdata"><a href="#_2-3-2-assembly-transaction-txdata" class="header-anchor">#</a> 2.3.2) Assembly transaction txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The address of the transaction creator</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DeleteContractData</span> deleteContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="_2-3-3-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator"><a href="#_2-3-3-call-the-interface-to-get-the-nonce-value-of-the-transaction-creator" class="header-anchor">#</a> 2.3.3) Call the interface to get the nonce value of the transaction creator</h4> <ul><li><p>Interface: getAccountBalance</p></li> <li><p>Parameters: chainId, assetChainId, assetId, address</p> <p>chainId: int //chain id</p> <p>assetChainId: int //chain id corresponding to the asset</p> <p>assetId : int // asset id</p> <p>Address : String //Account address</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>**Required data: **</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-4-by-the-data-obtained-in-the-above-3-steps-assemble-the-transaction-object-of-the-release-contract"><a href="#_2-3-4-by-the-data-obtained-in-the-above-3-steps-assemble-the-transaction-object-of-the-release-contract" class="header-anchor">#</a> 2.3.4) By the data obtained in the above 3 steps, assemble the transaction object of the release contract</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DeleteContractTransaction</span> <span class="token function">newDeleteTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">DeleteContractData</span> deleteContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeleteContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Calculate CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> deleteContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-3-5-signature-transaction-broadcast-transaction-omitted"><a href="#_2-3-5-signature-transaction-broadcast-transaction-omitted" class="header-anchor">#</a> 2.3.5) Signature transaction, broadcast transaction (omitted)</h4> <h2 id="_3-javascript-sdk"><a href="#_3-javascript-sdk" class="header-anchor">#</a> 3. JavaScript SDK</h2> <blockquote><p>In this language, we have developed js-sdk, which has implemented offline assembly smart contract trading.</p></blockquote> <p><strong>GitHub address:</strong> <a href="https://github.com/nuls-io/nuls-v2-js-sdk" target="_blank" rel="noopener noreferrer">NULS-v2-JS-SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_3-1-create-contract-transaction"><a href="#_3-1-create-contract-transaction" class="header-anchor">#</a> 3.1 Create contract transaction</h3> <p>Please refer to <code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCreateTest.js</code></p> <p><em><strong>core code snippet:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createContract</span><span class="token punctuation">(</span><span class="token parameter">pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> createAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> contractCreate<span class="token punctuation">,</span> remark</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1、通过接口获取合约的参数 args</span>
    <span class="token keyword">let</span> hex <span class="token operator">=</span> contractCreate<span class="token punctuation">.</span>contractCode<span class="token punctuation">;</span>
    <span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getContractConstructor</span><span class="token punctuation">(</span>hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>constructor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2、给每个参数复制 获取contractCreateTxData</span>
    <span class="token keyword">let</span> newArgs <span class="token operator">=</span> contractCreate<span class="token punctuation">.</span>args<span class="token punctuation">;</span>
    <span class="token keyword">const</span> contractCreateTxData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeCreateData</span><span class="token punctuation">(</span>contractCreate<span class="token punctuation">.</span>chainId<span class="token punctuation">,</span> createAddress<span class="token punctuation">,</span> contractCreate<span class="token punctuation">.</span>alias<span class="token punctuation">,</span> hex<span class="token punctuation">,</span> newArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3、序列化</span>

    <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>createAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> amount <span class="token operator">=</span> contractCreateTxData<span class="token punctuation">.</span>gasLimit <span class="token operator">*</span> contractCreateTxData<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
      fromAddress<span class="token operator">:</span> createAddress<span class="token punctuation">,</span>
      assetsChainId<span class="token operator">:</span> assetsChainId<span class="token punctuation">,</span>
      assetsId<span class="token operator">:</span> assetsId<span class="token punctuation">,</span>
      amount<span class="token operator">:</span> amount<span class="token punctuation">,</span>
      fee<span class="token operator">:</span> <span class="token number">100000</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> contractCreateTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> txhex<span class="token punctuation">;</span>
    <span class="token comment">//获取手续费</span>
    <span class="token keyword">let</span> newFee <span class="token operator">=</span> <span class="token function">countFee</span><span class="token punctuation">(</span>tAssemble<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//手续费大于0.001的时候重新组装交易及签名</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>transferInfo<span class="token punctuation">.</span>fee <span class="token operator">!==</span> newFee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      transferInfo<span class="token punctuation">.</span>fee <span class="token operator">=</span> newFee<span class="token punctuation">;</span>
      inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> contractCreateTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4、验证交易</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//5、广播交易</span>
      <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成, 合约地址: &quot;</span> <span class="token operator">+</span> contractCreateTxData<span class="token punctuation">.</span>contractAddress<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-2-call-contract-transaction"><a href="#_3-2-call-contract-transaction" class="header-anchor">#</a> 3.2 Call contract transaction</h3> <p>Please refer to <code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCallTest.js</code></p> <p><em><strong>core code snippet:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">callContract</span><span class="token punctuation">(</span><span class="token parameter">pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> fromAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> contractCall<span class="token punctuation">,</span> remark</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>fromAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> contractAddress <span class="token operator">=</span> contractCall<span class="token punctuation">.</span>contractAddress<span class="token punctuation">;</span>
   <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> contractCallTxData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeCallData</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>chainId<span class="token punctuation">,</span> fromAddress<span class="token punctuation">,</span> value<span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> contractCall<span class="token punctuation">.</span>methodName<span class="token punctuation">,</span> contractCall<span class="token punctuation">.</span>methodDesc<span class="token punctuation">,</span> contractCall<span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> gasLimit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span>contractCallTxData<span class="token punctuation">.</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> gasFee <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">.</span><span class="token function">times</span><span class="token punctuation">(</span>contractCallTxData<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> amount <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>newValue<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>gasFee<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
     fromAddress<span class="token operator">:</span> fromAddress<span class="token punctuation">,</span>
     assetsChainId<span class="token operator">:</span> assetsChainId<span class="token punctuation">,</span>
     assetsId<span class="token operator">:</span> assetsId<span class="token punctuation">,</span>
     amount<span class="token operator">:</span> amount<span class="token punctuation">,</span>
     fee<span class="token operator">:</span> <span class="token number">100000</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     transferInfo<span class="token punctuation">.</span>toAddress <span class="token operator">=</span> contractAddress<span class="token punctuation">;</span>
     transferInfo<span class="token punctuation">.</span>value <span class="token operator">=</span> contractCall<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> contractCallTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> txhex<span class="token punctuation">;</span>
   <span class="token comment">//获取手续费</span>
   <span class="token keyword">let</span> newFee <span class="token operator">=</span> <span class="token function">countFee</span><span class="token punctuation">(</span>tAssemble<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//手续费大于0.001的时候重新组装交易及签名</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>transferInfo<span class="token punctuation">.</span>fee <span class="token operator">!==</span> newFee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     transferInfo<span class="token punctuation">.</span>fee <span class="token operator">=</span> newFee<span class="token punctuation">;</span>
     inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> contractCallTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
     txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成&quot;</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败\n&quot;</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-3-delete-contract-transaction"><a href="#_3-3-delete-contract-transaction" class="header-anchor">#</a> 3.3 Delete contract transaction</h3> <p>Please refer to <code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractDeleteTest.js</code></p> <p><em><strong>core code snippet:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">deleteContract</span><span class="token punctuation">(</span><span class="token parameter">pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> fromAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> contractDelete<span class="token punctuation">,</span> remark</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>fromAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> amount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
       fromAddress<span class="token operator">:</span> fromAddress<span class="token punctuation">,</span>
       assetsChainId<span class="token operator">:</span> assetsChainId<span class="token punctuation">,</span>
       assetsId<span class="token operator">:</span> assetsId<span class="token punctuation">,</span>
       amount<span class="token operator">:</span> amount<span class="token punctuation">,</span>
       fee<span class="token operator">:</span> <span class="token number">100000</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> contractDeleteTxData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeDeleteData</span><span class="token punctuation">(</span>contractDelete<span class="token punctuation">.</span>chainId<span class="token punctuation">,</span> contractDelete<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> contractDelete<span class="token punctuation">.</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">let</span> deleteValidateResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateContractDelete</span><span class="token punctuation">(</span>assetsChainId<span class="token punctuation">,</span> contractDeleteTxData<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> contractDeleteTxData<span class="token punctuation">.</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deleteValidateResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证删除合约失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> contractDeleteTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成&quot;</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败&quot;</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/master/docs/Docs/s_offline_assembly.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/26/2021, 2:35:53 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Docs/s_nrc721.html" class="prev">
          NRC-721
        </a></span> <span class="next"><a href="/Docs/s_advance.html">
          Advanced Description
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2df9194a.js" defer></script><script src="/assets/js/68.2ecfeb2d.js" defer></script>
  </body>
</html>
