<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrade module design document |  </title>
    <meta name="description" content="Making It Easier To Innovate">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.601feec8.css" as="style"><link rel="preload" href="/assets/js/app.2df9194a.js" as="script"><link rel="preload" href="/assets/js/49.81251dda.js" as="script"><link rel="prefetch" href="/assets/js/10.0c5e14a0.js"><link rel="prefetch" href="/assets/js/100.9bc70f99.js"><link rel="prefetch" href="/assets/js/101.e70e6488.js"><link rel="prefetch" href="/assets/js/102.36d0eeb6.js"><link rel="prefetch" href="/assets/js/103.c48f6d10.js"><link rel="prefetch" href="/assets/js/104.36753511.js"><link rel="prefetch" href="/assets/js/105.d147a0e1.js"><link rel="prefetch" href="/assets/js/106.f182ac7d.js"><link rel="prefetch" href="/assets/js/107.1969c1c9.js"><link rel="prefetch" href="/assets/js/108.c4161ad1.js"><link rel="prefetch" href="/assets/js/109.d2fc6225.js"><link rel="prefetch" href="/assets/js/11.7172d40b.js"><link rel="prefetch" href="/assets/js/110.fc717fd0.js"><link rel="prefetch" href="/assets/js/111.e520750d.js"><link rel="prefetch" href="/assets/js/112.33215634.js"><link rel="prefetch" href="/assets/js/113.9487a4e1.js"><link rel="prefetch" href="/assets/js/114.4af66897.js"><link rel="prefetch" href="/assets/js/115.ed788b3b.js"><link rel="prefetch" href="/assets/js/116.a3aa3f28.js"><link rel="prefetch" href="/assets/js/117.fbb038f5.js"><link rel="prefetch" href="/assets/js/118.410c8a90.js"><link rel="prefetch" href="/assets/js/119.e980ed78.js"><link rel="prefetch" href="/assets/js/12.b157bf5f.js"><link rel="prefetch" href="/assets/js/120.8c80d17f.js"><link rel="prefetch" href="/assets/js/121.119f8321.js"><link rel="prefetch" href="/assets/js/122.2d6bb1e9.js"><link rel="prefetch" href="/assets/js/123.b04b0728.js"><link rel="prefetch" href="/assets/js/124.c6799b6b.js"><link rel="prefetch" href="/assets/js/125.4bed92f5.js"><link rel="prefetch" href="/assets/js/126.1124084b.js"><link rel="prefetch" href="/assets/js/127.3ef53bc0.js"><link rel="prefetch" href="/assets/js/128.ec5465b4.js"><link rel="prefetch" href="/assets/js/129.fa88d4f1.js"><link rel="prefetch" href="/assets/js/13.ded8ed02.js"><link rel="prefetch" href="/assets/js/130.a59920b5.js"><link rel="prefetch" href="/assets/js/131.6f6a30ae.js"><link rel="prefetch" href="/assets/js/132.dd3264be.js"><link rel="prefetch" href="/assets/js/133.9cf69d7d.js"><link rel="prefetch" href="/assets/js/134.044ab96a.js"><link rel="prefetch" href="/assets/js/135.0039ff10.js"><link rel="prefetch" href="/assets/js/136.e2e2a54e.js"><link rel="prefetch" href="/assets/js/137.a805007d.js"><link rel="prefetch" href="/assets/js/138.f1c7f601.js"><link rel="prefetch" href="/assets/js/139.2663676f.js"><link rel="prefetch" href="/assets/js/14.518e22ea.js"><link rel="prefetch" href="/assets/js/140.71976055.js"><link rel="prefetch" href="/assets/js/141.5a61780a.js"><link rel="prefetch" href="/assets/js/142.16220828.js"><link rel="prefetch" href="/assets/js/143.ff3fcc2d.js"><link rel="prefetch" href="/assets/js/144.c59d3810.js"><link rel="prefetch" href="/assets/js/145.84df8247.js"><link rel="prefetch" href="/assets/js/146.db747b14.js"><link rel="prefetch" href="/assets/js/147.e90628dd.js"><link rel="prefetch" href="/assets/js/148.c43ff8fd.js"><link rel="prefetch" href="/assets/js/149.b937fefc.js"><link rel="prefetch" href="/assets/js/15.4b3dc8bd.js"><link rel="prefetch" href="/assets/js/150.99281254.js"><link rel="prefetch" href="/assets/js/151.c38d135d.js"><link rel="prefetch" href="/assets/js/152.754bf6a4.js"><link rel="prefetch" href="/assets/js/16.13d0211e.js"><link rel="prefetch" href="/assets/js/17.f6e10861.js"><link rel="prefetch" href="/assets/js/18.cb2593a2.js"><link rel="prefetch" href="/assets/js/19.4edbd542.js"><link rel="prefetch" href="/assets/js/2.3da0e489.js"><link rel="prefetch" href="/assets/js/20.88ddbd1c.js"><link rel="prefetch" href="/assets/js/21.faa96d43.js"><link rel="prefetch" href="/assets/js/22.38f942c3.js"><link rel="prefetch" href="/assets/js/23.3f297858.js"><link rel="prefetch" href="/assets/js/24.f60196ef.js"><link rel="prefetch" href="/assets/js/25.36c9da09.js"><link rel="prefetch" href="/assets/js/26.2019d528.js"><link rel="prefetch" href="/assets/js/27.ebe9591a.js"><link rel="prefetch" href="/assets/js/28.8a71b3ce.js"><link rel="prefetch" href="/assets/js/29.761f1315.js"><link rel="prefetch" href="/assets/js/3.3b28a50c.js"><link rel="prefetch" href="/assets/js/30.0d78fd34.js"><link rel="prefetch" href="/assets/js/31.455baee2.js"><link rel="prefetch" href="/assets/js/32.ee627427.js"><link rel="prefetch" href="/assets/js/33.ce1f9222.js"><link rel="prefetch" href="/assets/js/34.da477209.js"><link rel="prefetch" href="/assets/js/35.61d6313b.js"><link rel="prefetch" href="/assets/js/36.45ef79c2.js"><link rel="prefetch" href="/assets/js/37.8d584f1f.js"><link rel="prefetch" href="/assets/js/38.5daa3c2b.js"><link rel="prefetch" href="/assets/js/39.3fee31fb.js"><link rel="prefetch" href="/assets/js/4.9bf7c824.js"><link rel="prefetch" href="/assets/js/40.64ebbb72.js"><link rel="prefetch" href="/assets/js/41.0caac018.js"><link rel="prefetch" href="/assets/js/42.e9a0686e.js"><link rel="prefetch" href="/assets/js/43.46a6c6ec.js"><link rel="prefetch" href="/assets/js/44.71db9aeb.js"><link rel="prefetch" href="/assets/js/45.8420eebd.js"><link rel="prefetch" href="/assets/js/46.3ffccd37.js"><link rel="prefetch" href="/assets/js/47.0dc8e60f.js"><link rel="prefetch" href="/assets/js/48.4a25340b.js"><link rel="prefetch" href="/assets/js/5.f8fa80eb.js"><link rel="prefetch" href="/assets/js/50.7a68e1b2.js"><link rel="prefetch" href="/assets/js/51.810ace8e.js"><link rel="prefetch" href="/assets/js/52.3fb11e5b.js"><link rel="prefetch" href="/assets/js/53.51e1b163.js"><link rel="prefetch" href="/assets/js/54.a193919b.js"><link rel="prefetch" href="/assets/js/55.ed77a75a.js"><link rel="prefetch" href="/assets/js/56.cf8d783d.js"><link rel="prefetch" href="/assets/js/57.0c17175b.js"><link rel="prefetch" href="/assets/js/58.3ddb5f2e.js"><link rel="prefetch" href="/assets/js/59.68a213bb.js"><link rel="prefetch" href="/assets/js/6.1c8f1000.js"><link rel="prefetch" href="/assets/js/60.a0636ebc.js"><link rel="prefetch" href="/assets/js/61.fc72f2e7.js"><link rel="prefetch" href="/assets/js/62.4fa897e2.js"><link rel="prefetch" href="/assets/js/63.2d20b2a2.js"><link rel="prefetch" href="/assets/js/64.d5daa534.js"><link rel="prefetch" href="/assets/js/65.594e30f7.js"><link rel="prefetch" href="/assets/js/66.a868f08c.js"><link rel="prefetch" href="/assets/js/67.611d69ab.js"><link rel="prefetch" href="/assets/js/68.2ecfeb2d.js"><link rel="prefetch" href="/assets/js/69.299a4679.js"><link rel="prefetch" href="/assets/js/7.6ddd6e53.js"><link rel="prefetch" href="/assets/js/70.db68d2a2.js"><link rel="prefetch" href="/assets/js/71.ce42dcd6.js"><link rel="prefetch" href="/assets/js/72.38ac2674.js"><link rel="prefetch" href="/assets/js/73.bd7f9811.js"><link rel="prefetch" href="/assets/js/74.0afd81ce.js"><link rel="prefetch" href="/assets/js/75.e3619d1c.js"><link rel="prefetch" href="/assets/js/76.2d0d598d.js"><link rel="prefetch" href="/assets/js/77.92f479e8.js"><link rel="prefetch" href="/assets/js/78.95fc9d7c.js"><link rel="prefetch" href="/assets/js/79.bfd42746.js"><link rel="prefetch" href="/assets/js/8.57bc7818.js"><link rel="prefetch" href="/assets/js/80.79249f41.js"><link rel="prefetch" href="/assets/js/81.94e759cb.js"><link rel="prefetch" href="/assets/js/82.0808b875.js"><link rel="prefetch" href="/assets/js/83.84b2875f.js"><link rel="prefetch" href="/assets/js/84.bfc04846.js"><link rel="prefetch" href="/assets/js/85.b8453670.js"><link rel="prefetch" href="/assets/js/86.53298a14.js"><link rel="prefetch" href="/assets/js/87.332e1ec8.js"><link rel="prefetch" href="/assets/js/88.eec1ee38.js"><link rel="prefetch" href="/assets/js/89.9de51cb3.js"><link rel="prefetch" href="/assets/js/9.9b98df55.js"><link rel="prefetch" href="/assets/js/90.93579a5d.js"><link rel="prefetch" href="/assets/js/91.9494f211.js"><link rel="prefetch" href="/assets/js/92.f3f4a19f.js"><link rel="prefetch" href="/assets/js/93.fb09d292.js"><link rel="prefetch" href="/assets/js/94.396b8118.js"><link rel="prefetch" href="/assets/js/95.df06706e.js"><link rel="prefetch" href="/assets/js/96.46d03f61.js"><link rel="prefetch" href="/assets/js/97.1aaa0edd.js"><link rel="prefetch" href="/assets/js/98.56c53e9d.js"><link rel="prefetch" href="/assets/js/99.09ea7286.js">
    <link rel="stylesheet" href="/assets/css/0.styles.601feec8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> </span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/d_protocol_update.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/d_protocol_update.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/d_protocol_update.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/d_protocol_update.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Module Design</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/d_network.html" class="sidebar-link">Network module design document</a></li><li><a href="/Docs/d_ledger.html" class="sidebar-link">Design document of ledger module</a></li><li><a href="/Docs/d_chain_manager.html" class="sidebar-link">Chain Management Module Design Document</a></li><li><a href="/Docs/d_account.html" class="sidebar-link">Account Module Design Document</a></li><li><a href="/Docs/d_smart_contract.html" class="sidebar-link">Smart contract module design</a></li><li><a href="/Docs/d_transaction.html" class="sidebar-link">Transaction management module Design document</a></li><li><a href="/Docs/d_cross_chain.html" class="sidebar-link">Overall description</a></li><li><a href="/Docs/d_consensus.html" class="sidebar-link">Consensus Module Design Document</a></li><li><a href="/Docs/d_public_service.html" class="sidebar-link">Public-Service Module Design Document</a></li><li><a href="/Docs/d_block.html" class="sidebar-link">Block Management Module Design Document</a></li><li><a href="/Docs/d_protocol_update.html" aria-current="page" class="active sidebar-link">Upgrade module design document</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#i-overall-description" class="sidebar-link">I. Overall description</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_1-1-module-overview" class="sidebar-link">1.1 Module Overview</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_1-2-architecture" class="sidebar-link">1.2 Architecture</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#ii-functional-design" class="sidebar-link">II, functional design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_2-1-functional-architecture" class="sidebar-link">2.1 Functional Architecture</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_2-2-module-service" class="sidebar-link">2.2 Module Service</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_2-3-module-internal-function" class="sidebar-link">2.3 Module internal function</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#iii-description-of-the-event" class="sidebar-link">III. Description of the event</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_3-1-published-events" class="sidebar-link">3.1 Published events</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_3-2-subscribe-to-events" class="sidebar-link">3.2 Subscribe to events</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#iv-agreement" class="sidebar-link">IV. Agreement</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_4-1-network-communication-protocol" class="sidebar-link">4.1 Network Communication Protocol</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#_4-2-message-protocol" class="sidebar-link">4.2 Message Protocol</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#五-module-configuration" class="sidebar-link">五, module configuration</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#six-java-specific-design" class="sidebar-link">Six, Java-specific design</a></li><li class="sidebar-sub-header"><a href="/Docs/d_protocol_update.html#vii-supplementary-content" class="sidebar-link">VII, supplementary content</a></li></ul></li><li><a href="/Docs/d_address.html" class="sidebar-link">NULS Protocol Address</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interface</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/i_rpc_protocol.html" class="sidebar-link">NULS Application Interface Services</a></li><li><a href="/Docs/i_public_service.html" class="sidebar-link">Public Service</a></li><li><a href="/Docs/i_nuls-api_JSONRPC.html" class="sidebar-link">API-JSONRPC</a></li><li><a href="/Docs/i_nuls-api_RESTFUL.html" class="sidebar-link">API-RESTFUL</a></li><li><a href="/Docs/i_account.html" class="sidebar-link">Account Module</a></li><li><a href="/Docs/i_chain-manager.html" class="sidebar-link">Why should I have the Chain Management module?</a></li><li><a href="/Docs/i_cross-chain.html" class="sidebar-link">Interface List</a></li><li><a href="/Docs/i_network.html" class="sidebar-link">Why should I have &quot;Network Module&quot;?</a></li><li><a href="/Docs/i_block.html" class="sidebar-link">Block Module</a></li><li><a href="/Docs/i_transaction.html" class="sidebar-link">Transaction module</a></li><li><a href="/Docs/i_consensus.html" class="sidebar-link">poc Consensus Module</a></li><li><a href="/Docs/i_smart-contract.html" class="sidebar-link">Smart contract module</a></li><li><a href="/Docs/i_ledger.html" class="sidebar-link">Ledger Module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>ChainBox</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/c_chain_box.html" class="sidebar-link">NULS ChainBox</a></li><li><a href="/Docs/c_module.html" class="sidebar-link">Develope Module</a></li><li><a href="/Docs/c_message_module.html" class="sidebar-link">Encrypted Message Module Demo</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/s_manual.html" class="sidebar-link">Development Manual</a></li><li><a href="/Docs/s_tools.html" class="sidebar-link">Development Tool</a></li><li><a href="/Docs/s_nrc20.html" class="sidebar-link">NRC-20</a></li><li><a href="/Docs/s_nrc721.html" class="sidebar-link">NRC-721</a></li><li><a href="/Docs/s_offline_assembly.html" class="sidebar-link">Smart contract offline assembly</a></li><li><a href="/Docs/s_advance.html" class="sidebar-link">Advanced Description</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="upgrade-module-design-document"><a href="#upgrade-module-design-document" class="header-anchor">#</a> Upgrade module design document</h1> <h2 id="i-overall-description"><a href="#i-overall-description" class="header-anchor">#</a> I. Overall description</h2> <h3 id="_1-1-module-overview"><a href="#_1-1-module-overview" class="header-anchor">#</a> 1.1 Module Overview</h3> <h4 id="_1-1-1-why-should-i-have-the-protocol-upgrade-module"><a href="#_1-1-1-why-should-i-have-the-protocol-upgrade-module" class="header-anchor">#</a> 1.1.1 Why should I have the &quot;Protocol Upgrade&quot; module?</h4> <pre><code>Different protocol versions support different transaction types and message types. In order to manage the version of the blockchain network, it is necessary to provide complete version management functions.
</code></pre> <h4 id="_1-1-2-what-to-do-in-the-agreement-upgrade"><a href="#_1-1-2-what-to-do-in-the-agreement-upgrade" class="header-anchor">#</a> 1.1.2 What to do in the &quot;Agreement Upgrade&quot;</h4> <ul><li>Parse the version information in the block header for dynamic statistics, upgrade, and rollback</li> <li>Provide transaction support types, message types, and version information query services for other modules</li></ul> <h4 id="_1-1-3-positioning-of-the-protocol-upgrade-in-the-system"><a href="#_1-1-3-positioning-of-the-protocol-upgrade-in-the-system" class="header-anchor">#</a> 1.1.3 Positioning of the &quot;Protocol Upgrade&quot; in the system</h4> <p>Protocol upgrade is one of the underlying modules. The following sub-functions discuss module dependencies.</p> <p>rely</p> <ul><li>Block Management Module - Initialize Local Protocol Version Information</li></ul> <p>Be dependent</p> <ul><li>All modules that care about message processing and transaction processing</li></ul> <h3 id="_1-2-architecture"><a href="#_1-2-architecture" class="header-anchor">#</a> 1.2 Architecture</h3> <pre><code>Supplementary picture
</code></pre> <h2 id="ii-functional-design"><a href="#ii-functional-design" class="header-anchor">#</a> II, functional design</h2> <h3 id="_2-1-functional-architecture"><a href="#_2-1-functional-architecture" class="header-anchor">#</a> 2.1 Functional Architecture</h3> <pre><code>Supplementary picture
</code></pre> <h3 id="_2-2-module-service"><a href="#_2-2-module-service" class="header-anchor">#</a> 2.2 Module Service</h3> <h4 id="_2-2-1-obtaining-the-current-main-network-version-information"><a href="#_2-2-1-obtaining-the-current-main-network-version-information" class="header-anchor">#</a> 2.2.1 Obtaining the current main network version information</h4> <ul><li><p>Interface Description</p> <p>According to the chain id query db to get the main network version information</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;currentMainnetVersion&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">Chain ID</td></tr></tbody></table> <ul><li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 1,
    &quot;msg&quot;: &quot;error message&quot;,
    &quot;result&quot;: {}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;versionInfo&quot;: {
            &quot;major&quot;: &quot;1&quot;,
            &quot;minor&quot;: &quot;1&quot;,
            &quot;percent&quot;: &quot;80&quot;, / / fixed value
            &quot;slice&quot;: &quot;100&quot;, / / fixed value
            &quot;waitCount&quot;: &quot;240&quot;//fixed value
        }
    }
}
</code></pre></div></li> <li><p>Return field description</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>Integer</td> <td>Chain ID</td></tr> <tr><td>Major</td> <td>Integer</td> <td>Major version number</td></tr> <tr><td>minor</td> <td>Integer</td> <td>Minor version number</td></tr> <tr><td>percent</td> <td>Integer</td> <td>Effective Ratio</td></tr> <tr><td>slice</td> <td>Integer</td> <td>Minimum statistical fragment length</td></tr> <tr><td>waitCount</td> <td>Integer</td> <td>Continuous Confirmation Times</td></tr></tbody></table> <h4 id="_2-2-2-obtaining-current-local-version-information"><a href="#_2-2-2-obtaining-current-local-version-information" class="header-anchor">#</a> 2.2.2 Obtaining Current Local Version Information</h4> <ul><li><p>Interface Description</p> <p>According to the chain id query db to get local version information</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;currentLocalVersion&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;]
}
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">Chain ID</td></tr></tbody></table> <ul><li><p>Return example</p> <p>Failed</p> <pre><code>```
{
    &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
```
</code></pre> <p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;versionInfo&quot;: {
            &quot;major&quot;: &quot;1&quot;,
            &quot;minor&quot;: &quot;1&quot;,
            &quot;percent&quot;: &quot;80&quot;,
            &quot;slice&quot;: &quot;100&quot;,
            &quot;waitCount&quot;: &quot;240&quot;
        }
    }
}
</code></pre></div></li> <li><p>Return field description</p> <p>Reference 2.2.1</p> <h4 id="_2-2-3-get-version-statistics-based-on-block-height"><a href="#_2-2-3-get-version-statistics-based-on-block-height" class="header-anchor">#</a> 2.2.3 Get version statistics based on block height</h4> <ul><li><p>Interface Description</p> <p>According to the chain id query db to get local version information</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;cmd&quot;: &quot;statisticsInfo&quot;,
  &quot;minVersion&quot;:&quot;1.1&quot;,
  &quot;params&quot;: [&quot;888&quot;, &quot;888&quot;]
}
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>Long</td> <td style="text-align:center">Chain ID</td></tr> <tr><td>1</td> <td>height</td> <td>true</td> <td>Long</td> <td style="text-align:center">Block Height</td></tr></tbody></table> <ul><li><p>Return to example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>  {
      &quot;version&quot;: 1.2,
      &quot;code&quot;:1,
      &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
      &quot;result&quot;:{}
  }
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;version&quot;: 1.2,
    &quot;code&quot;: 0,
    &quot;result&quot;: {
        &quot;chainId&quot;: &quot;888&quot;,
        &quot;statisticsInfo&quot;: {
            &quot;major&quot;: &quot;1&quot;,
            &quot;minor&quot;: &quot;1&quot;,
            &quot;percent&quot;: &quot;80&quot;,
            &quot;slice&quot;: &quot;100&quot;,
            &quot;count&quot;: &quot;240&quot;
        }
    }
}
</code></pre></div></li> <li><p>Return field description</p> <p>Reference 2.2.1</p></li></ul></li></ul> <h3 id="_2-3-module-internal-function"><a href="#_2-3-module-internal-function" class="header-anchor">#</a> 2.3 Module internal function</h3> <h4 id="_2-3-1-module-startup"><a href="#_2-3-1-module-startup" class="header-anchor">#</a> 2.3.1 Module startup</h4> <ul><li><p>Function Description:</p> <p>Startup protocol upgrade module</p></li> <li><p>Process description</p> <p>Supplementary picture</p> <p>1.rpc service initialization</p> <ol start="2"><li><p>Initialize the general database</p></li> <li><p>Load configuration information</p></li> <li><p>Initialize each chain database</p></li> <li><p>Wait for the dependency module to be ready</p></li></ol></li> <li><p>Dependent service</p> <p>Tool module, kernel module</p></li></ul> <h4 id="_2-3-2-version-upgrade"><a href="#_2-3-2-version-upgrade" class="header-anchor">#</a> 2.3.2 Version Upgrade</h4> <ul><li><p>Function Description:</p> <p>Each time a block is saved or a block is rolled back, the version number in the block header is read, and the version ratio information is dynamically counted to determine whether to perform protocol upgrade.The major version number does not allow cross-version upgrades, and the minor version number allows cross-version upgrades</p></li> <li><p>Process description</p> <p>Each 100 blocks is a statistical interval, and the distribution ratio of the version number in the head of the block is counted and saved to the database (key=height, value=version information, consecutive confirmation times, etc.)</p> <ul><li><p>When the version ratio is greater than a certain threshold (must be greater than 50%), the version number in the statistical interval can be determined. When the maximum version number in consecutive 260 statistical intervals remains continuous, the main network performs protocol upgrade.</p></li> <li><p>If no version number is greater than the threshold, the current effective version number is used as the version number of the current interval.</p></li> <li><p>If there is a statistical interval version number fluctuation in the middle, restart statistics</p></li></ul> <p>Simulate several scenarios:</p> <p>waitCount (continuous confirmation times)</p> <ol><li><h5 id="normal-upgrade-no-fluctuations-in-midway-statistics"><a href="#normal-upgrade-no-fluctuations-in-midway-statistics" class="header-anchor">#</a> Normal upgrade (no fluctuations in midway statistics)</h5> <p>The starting block height is 1000, the protocol version number = 1.0</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>。</p> <p>。</p> <p>。</p> <p>Block statistics in the height range of 27001-27100, accounting for 80% of the block protocol version number = 1.1, waitCount=260</p> <p>The new agreement will take effect from Block 27101</p></li> <li><h5 id="normal-upgrade-there-is-fluctuation-in-the-middle-of-the-statistics"><a href="#normal-upgrade-there-is-fluctuation-in-the-middle-of-the-statistics" class="header-anchor">#</a> Normal upgrade (there is fluctuation in the middle of the statistics)</h5> <p>The starting block height is 1000, the protocol version number = 1.0</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>Block statistics in the height range of 1201-1300, accounting for 80% of the block protocol version number = 1.0, waitCount=0</p> <p>Block statistics in the height range of 1301-1400, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>。</p> <p>。</p> <p>。</p> <p>Block statistics in the height range of 27301-27400, accounting for 80% of the block protocol version number = 1.1, waitCount=260</p> <p>The new agreement will take effect from the 27401 block</p></li> <li><h5 id="abnormal-upgrade-first-rollback-no-fluctuations-in-the-middle-of-the-statistics"><a href="#abnormal-upgrade-first-rollback-no-fluctuations-in-the-middle-of-the-statistics" class="header-anchor">#</a> Abnormal upgrade (first rollback, no fluctuations in the middle of the statistics)</h5> <p>Main chain</p> <p>The starting block height is 1000, the protocol version number = 1.0</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>。</p> <p>。</p> <p>。</p> <p>Block statistics in the height range of 27001-27100, accounting for 80% of the block protocol version number = 1.1, waitCount=260</p> <p>The new agreement will take effect from Block 27101</p> <p>Bifurcation chain</p> <p>The starting block height is 1000, the protocol version number is 1.0, and the fork height is 1211.</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>Block statistics in the height range of 1201-1300, accounting for 80% of the block protocol version number = 1.0, waitCount=0</p> <p>Block statistics in the height range of 1301-1400, accounting for 80% of the block protocol version number = 1.0, waitCount=0</p> <p>Bifurcation chain switching first step</p> <p>Roll back to the fork point</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>Block statistics in the height range of 1201-1211, the number of blocks is less than 100, not counting</p> <p>Add a new block</p> <p>Block statistics in the height range of 1001-1100, accounting for 80% of the block protocol version number = 1.1, waitCount=1</p> <p>Block statistics in the height range of 1101-1200, accounting for 80% of the block protocol version number = 1.1, waitCount=2</p> <p>Block statistics in the height range of 1201-1300, accounting for 80% of the block protocol version number = 1.1, waitCount=3</p> <p>。</p> <p>。</p> <p>。</p> <p>Block statistics in the height range of 27001-27100, accounting for 80% of the block protocol version number = 1.1, waitCount=260</p> <p>The new agreement will take effect from Block 27101</p></li> <li><h5 id="abnormal-upgrade-first-rollback-fluctuations-in-the-middle-of-the-statistics"><a href="#abnormal-upgrade-first-rollback-fluctuations-in-the-middle-of-the-statistics" class="header-anchor">#</a> Abnormal upgrade (first rollback, fluctuations in the middle of the statistics)</h5> <p>Similar to the third case</p></li></ol></li> <li><p>Dependent service</p> <p>Database tool for tool modules</p></li></ul> <h4 id="_2-3-3-delayed-upgrade"><a href="#_2-3-3-delayed-upgrade" class="header-anchor">#</a> 2.3.3 Delayed upgrade</h4> <ul><li><p>Function Description:</p> <p>In order to deal with the bug that the new protocol was found during the upgrade process.</p></li> <li><p>Process description</p> <p>Assume that the current version number is 1.0, and the version number to be upgraded is 1.1, but a bug was found during the 1.1 version upgrade.</p> <p>The protocol upgrade process is reset by lowering the proportion of the new protocol 1.1, so that the main network version is kept in the old version 1.0, and after the new protocol 1.1 bug is fixed, the upgrade process is restarted.</p></li> <li><p>Dependent service</p> <p>Database tool for tool modules</p></li></ul> <h4 id="_2-3-4-version-information-push"><a href="#_2-3-4-version-information-push" class="header-anchor">#</a> 2.3.4 Version Information Push</h4> <ul><li><p>Function Description:</p> <p>When the last block of each statistical interval is received, the protocol version information currently validated by each module is actively notified, mainly to notify the transaction management module of the valid transaction type and a valid transaction validator, and notify the network module of valid message types and messages. processor.</p></li> <li><p>Process description</p></li> <li><p>Dependent service</p> <p>Database tool for tool modules</p></li></ul> <h2 id="iii-description-of-the-event"><a href="#iii-description-of-the-event" class="header-anchor">#</a> III. Description of the event</h2> <h3 id="_3-1-published-events"><a href="#_3-1-published-events" class="header-anchor">#</a> 3.1 Published events</h3> <h4 id="_3-1-1-protocol-upgrade"><a href="#_3-1-1-protocol-upgrade" class="header-anchor">#</a> 3.1.1 Protocol Upgrade</h4> <p>Description: The protocol version is upgraded and the event is released.</p> <p>event_topic : &quot;versionUpadte&quot;,</p> <div class="language- extra-class"><pre class="language-text"><code>data:{
    chainId
    major
    minor
    height
}
</code></pre></div><h3 id="_3-2-subscribe-to-events"><a href="#_3-2-subscribe-to-events" class="header-anchor">#</a> 3.2 Subscribe to events</h3> <pre><code>slightly
</code></pre> <h2 id="iv-agreement"><a href="#iv-agreement" class="header-anchor">#</a> IV. Agreement</h2> <h3 id="_4-1-network-communication-protocol"><a href="#_4-1-network-communication-protocol" class="header-anchor">#</a> 4.1 Network Communication Protocol</h3> <pre><code>slightly
</code></pre> <h3 id="_4-2-message-protocol"><a href="#_4-2-message-protocol" class="header-anchor">#</a> 4.2 Message Protocol</h3> <pre><code>slightly
</code></pre> <h2 id="五-module-configuration"><a href="#五-module-configuration" class="header-anchor">#</a> 五, module configuration</h2> <div class="language- extra-class"><pre class="language-text"><code>[
  {
    &quot;name&quot;: &quot;supportTxTypes&quot;,
    &quot;remark&quot;: &quot;Supported transaction types&quot;,
    &quot;readOnly&quot;: &quot;true&quot;,
    &quot;value&quot;: &quot;1,2,3,4,5&quot;
  },
  {
    &quot;name&quot;: &quot;supportMessageTypes&quot;,
    &quot;remark&quot;: &quot;Supported message types&quot;,
    &quot;readOnly&quot;: &quot;true&quot;,
    &quot;value&quot;: &quot;1,2,3,4,5&quot;
  }
]
</code></pre></div><h2 id="six-java-specific-design"><a href="#six-java-specific-design" class="header-anchor">#</a> Six, Java-specific design</h2> <ul><li>BlockHeader object added field</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>description</code></th></tr></thead> <tbody><tr><td>blockMajor</td> <td>byte</td> <td>Block major version number</td></tr> <tr><td>blockMinor</td> <td>byte</td> <td>Block minor version number</td></tr> <tr><td>mainnetMajor</td> <td>byte</td> <td>main network version number</td></tr> <tr><td>mainnetMinor</td> <td>byte</td> <td>main network version number</td></tr></tbody></table></blockquote> <ul><li>BlockChainVersion object design</li></ul> <blockquote><table><thead><tr><th><code>field name</code></th> <th><code>field type</code></th> <th><code>description</code></th></tr></thead> <tbody><tr><td>major</td> <td>byte</td> <td>major version number</td></tr> <tr><td>minor</td> <td>byte</td> <td>minor version number</td></tr></tbody></table></blockquote> <h2 id="vii-supplementary-content"><a href="#vii-supplementary-content" class="header-anchor">#</a> VII, supplementary content</h2> <ol><li>Is the message of different protocol versions processed by the network module or by the registration module of each message?</li> <li>Is the transaction of different protocol versions handled by the transaction module or by the registration module of each transaction?</li> <li>Is the message type, transaction type, transaction processor supported by the protocol initialized by the configuration file, or is it registered by each module?</li> <li>Is the version allowed to roll back? It is not allowed to roll back from version 1.1 to 1.0-------------------</li> <li>Does not support pow</li></ol></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/master/docs/Docs/d_protocol_update.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/5/2019, 4:50:57 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Docs/d_block.html" class="prev">
          Block Management Module Design Document
        </a></span> <span class="next"><a href="/Docs/d_address.html">
          NULS Protocol Address
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2df9194a.js" defer></script><script src="/assets/js/49.81251dda.js" defer></script>
  </body>
</html>
