<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Encrypted Message Module Demo |  </title>
    <meta name="description" content="Making It Easier To Innovate">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.601feec8.css" as="style"><link rel="preload" href="/assets/js/app.2df9194a.js" as="script"><link rel="preload" href="/assets/js/46.3ffccd37.js" as="script"><link rel="prefetch" href="/assets/js/10.0c5e14a0.js"><link rel="prefetch" href="/assets/js/100.9bc70f99.js"><link rel="prefetch" href="/assets/js/101.e70e6488.js"><link rel="prefetch" href="/assets/js/102.36d0eeb6.js"><link rel="prefetch" href="/assets/js/103.c48f6d10.js"><link rel="prefetch" href="/assets/js/104.36753511.js"><link rel="prefetch" href="/assets/js/105.d147a0e1.js"><link rel="prefetch" href="/assets/js/106.f182ac7d.js"><link rel="prefetch" href="/assets/js/107.1969c1c9.js"><link rel="prefetch" href="/assets/js/108.c4161ad1.js"><link rel="prefetch" href="/assets/js/109.d2fc6225.js"><link rel="prefetch" href="/assets/js/11.7172d40b.js"><link rel="prefetch" href="/assets/js/110.fc717fd0.js"><link rel="prefetch" href="/assets/js/111.e520750d.js"><link rel="prefetch" href="/assets/js/112.33215634.js"><link rel="prefetch" href="/assets/js/113.9487a4e1.js"><link rel="prefetch" href="/assets/js/114.4af66897.js"><link rel="prefetch" href="/assets/js/115.ed788b3b.js"><link rel="prefetch" href="/assets/js/116.a3aa3f28.js"><link rel="prefetch" href="/assets/js/117.fbb038f5.js"><link rel="prefetch" href="/assets/js/118.410c8a90.js"><link rel="prefetch" href="/assets/js/119.e980ed78.js"><link rel="prefetch" href="/assets/js/12.b157bf5f.js"><link rel="prefetch" href="/assets/js/120.8c80d17f.js"><link rel="prefetch" href="/assets/js/121.119f8321.js"><link rel="prefetch" href="/assets/js/122.2d6bb1e9.js"><link rel="prefetch" href="/assets/js/123.b04b0728.js"><link rel="prefetch" href="/assets/js/124.c6799b6b.js"><link rel="prefetch" href="/assets/js/125.4bed92f5.js"><link rel="prefetch" href="/assets/js/126.1124084b.js"><link rel="prefetch" href="/assets/js/127.3ef53bc0.js"><link rel="prefetch" href="/assets/js/128.ec5465b4.js"><link rel="prefetch" href="/assets/js/129.fa88d4f1.js"><link rel="prefetch" href="/assets/js/13.ded8ed02.js"><link rel="prefetch" href="/assets/js/130.a59920b5.js"><link rel="prefetch" href="/assets/js/131.6f6a30ae.js"><link rel="prefetch" href="/assets/js/132.dd3264be.js"><link rel="prefetch" href="/assets/js/133.9cf69d7d.js"><link rel="prefetch" href="/assets/js/134.044ab96a.js"><link rel="prefetch" href="/assets/js/135.0039ff10.js"><link rel="prefetch" href="/assets/js/136.e2e2a54e.js"><link rel="prefetch" href="/assets/js/137.a805007d.js"><link rel="prefetch" href="/assets/js/138.f1c7f601.js"><link rel="prefetch" href="/assets/js/139.2663676f.js"><link rel="prefetch" href="/assets/js/14.518e22ea.js"><link rel="prefetch" href="/assets/js/140.71976055.js"><link rel="prefetch" href="/assets/js/141.5a61780a.js"><link rel="prefetch" href="/assets/js/142.16220828.js"><link rel="prefetch" href="/assets/js/143.ff3fcc2d.js"><link rel="prefetch" href="/assets/js/144.c59d3810.js"><link rel="prefetch" href="/assets/js/145.84df8247.js"><link rel="prefetch" href="/assets/js/146.db747b14.js"><link rel="prefetch" href="/assets/js/147.e90628dd.js"><link rel="prefetch" href="/assets/js/148.c43ff8fd.js"><link rel="prefetch" href="/assets/js/149.b937fefc.js"><link rel="prefetch" href="/assets/js/15.4b3dc8bd.js"><link rel="prefetch" href="/assets/js/150.99281254.js"><link rel="prefetch" href="/assets/js/151.c38d135d.js"><link rel="prefetch" href="/assets/js/152.754bf6a4.js"><link rel="prefetch" href="/assets/js/16.13d0211e.js"><link rel="prefetch" href="/assets/js/17.f6e10861.js"><link rel="prefetch" href="/assets/js/18.cb2593a2.js"><link rel="prefetch" href="/assets/js/19.4edbd542.js"><link rel="prefetch" href="/assets/js/2.3da0e489.js"><link rel="prefetch" href="/assets/js/20.88ddbd1c.js"><link rel="prefetch" href="/assets/js/21.faa96d43.js"><link rel="prefetch" href="/assets/js/22.38f942c3.js"><link rel="prefetch" href="/assets/js/23.3f297858.js"><link rel="prefetch" href="/assets/js/24.f60196ef.js"><link rel="prefetch" href="/assets/js/25.36c9da09.js"><link rel="prefetch" href="/assets/js/26.2019d528.js"><link rel="prefetch" href="/assets/js/27.ebe9591a.js"><link rel="prefetch" href="/assets/js/28.8a71b3ce.js"><link rel="prefetch" href="/assets/js/29.761f1315.js"><link rel="prefetch" href="/assets/js/3.3b28a50c.js"><link rel="prefetch" href="/assets/js/30.0d78fd34.js"><link rel="prefetch" href="/assets/js/31.455baee2.js"><link rel="prefetch" href="/assets/js/32.ee627427.js"><link rel="prefetch" href="/assets/js/33.ce1f9222.js"><link rel="prefetch" href="/assets/js/34.da477209.js"><link rel="prefetch" href="/assets/js/35.61d6313b.js"><link rel="prefetch" href="/assets/js/36.45ef79c2.js"><link rel="prefetch" href="/assets/js/37.8d584f1f.js"><link rel="prefetch" href="/assets/js/38.5daa3c2b.js"><link rel="prefetch" href="/assets/js/39.3fee31fb.js"><link rel="prefetch" href="/assets/js/4.9bf7c824.js"><link rel="prefetch" href="/assets/js/40.64ebbb72.js"><link rel="prefetch" href="/assets/js/41.0caac018.js"><link rel="prefetch" href="/assets/js/42.e9a0686e.js"><link rel="prefetch" href="/assets/js/43.46a6c6ec.js"><link rel="prefetch" href="/assets/js/44.71db9aeb.js"><link rel="prefetch" href="/assets/js/45.8420eebd.js"><link rel="prefetch" href="/assets/js/47.0dc8e60f.js"><link rel="prefetch" href="/assets/js/48.4a25340b.js"><link rel="prefetch" href="/assets/js/49.81251dda.js"><link rel="prefetch" href="/assets/js/5.f8fa80eb.js"><link rel="prefetch" href="/assets/js/50.7a68e1b2.js"><link rel="prefetch" href="/assets/js/51.810ace8e.js"><link rel="prefetch" href="/assets/js/52.3fb11e5b.js"><link rel="prefetch" href="/assets/js/53.51e1b163.js"><link rel="prefetch" href="/assets/js/54.a193919b.js"><link rel="prefetch" href="/assets/js/55.ed77a75a.js"><link rel="prefetch" href="/assets/js/56.cf8d783d.js"><link rel="prefetch" href="/assets/js/57.0c17175b.js"><link rel="prefetch" href="/assets/js/58.3ddb5f2e.js"><link rel="prefetch" href="/assets/js/59.68a213bb.js"><link rel="prefetch" href="/assets/js/6.1c8f1000.js"><link rel="prefetch" href="/assets/js/60.a0636ebc.js"><link rel="prefetch" href="/assets/js/61.fc72f2e7.js"><link rel="prefetch" href="/assets/js/62.4fa897e2.js"><link rel="prefetch" href="/assets/js/63.2d20b2a2.js"><link rel="prefetch" href="/assets/js/64.d5daa534.js"><link rel="prefetch" href="/assets/js/65.594e30f7.js"><link rel="prefetch" href="/assets/js/66.a868f08c.js"><link rel="prefetch" href="/assets/js/67.611d69ab.js"><link rel="prefetch" href="/assets/js/68.2ecfeb2d.js"><link rel="prefetch" href="/assets/js/69.299a4679.js"><link rel="prefetch" href="/assets/js/7.6ddd6e53.js"><link rel="prefetch" href="/assets/js/70.db68d2a2.js"><link rel="prefetch" href="/assets/js/71.ce42dcd6.js"><link rel="prefetch" href="/assets/js/72.38ac2674.js"><link rel="prefetch" href="/assets/js/73.bd7f9811.js"><link rel="prefetch" href="/assets/js/74.0afd81ce.js"><link rel="prefetch" href="/assets/js/75.e3619d1c.js"><link rel="prefetch" href="/assets/js/76.2d0d598d.js"><link rel="prefetch" href="/assets/js/77.92f479e8.js"><link rel="prefetch" href="/assets/js/78.95fc9d7c.js"><link rel="prefetch" href="/assets/js/79.bfd42746.js"><link rel="prefetch" href="/assets/js/8.57bc7818.js"><link rel="prefetch" href="/assets/js/80.79249f41.js"><link rel="prefetch" href="/assets/js/81.94e759cb.js"><link rel="prefetch" href="/assets/js/82.0808b875.js"><link rel="prefetch" href="/assets/js/83.84b2875f.js"><link rel="prefetch" href="/assets/js/84.bfc04846.js"><link rel="prefetch" href="/assets/js/85.b8453670.js"><link rel="prefetch" href="/assets/js/86.53298a14.js"><link rel="prefetch" href="/assets/js/87.332e1ec8.js"><link rel="prefetch" href="/assets/js/88.eec1ee38.js"><link rel="prefetch" href="/assets/js/89.9de51cb3.js"><link rel="prefetch" href="/assets/js/9.9b98df55.js"><link rel="prefetch" href="/assets/js/90.93579a5d.js"><link rel="prefetch" href="/assets/js/91.9494f211.js"><link rel="prefetch" href="/assets/js/92.f3f4a19f.js"><link rel="prefetch" href="/assets/js/93.fb09d292.js"><link rel="prefetch" href="/assets/js/94.396b8118.js"><link rel="prefetch" href="/assets/js/95.df06706e.js"><link rel="prefetch" href="/assets/js/96.46d03f61.js"><link rel="prefetch" href="/assets/js/97.1aaa0edd.js"><link rel="prefetch" href="/assets/js/98.56c53e9d.js"><link rel="prefetch" href="/assets/js/99.09ea7286.js">
    <link rel="stylesheet" href="/assets/css/0.styles.601feec8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> </span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/c_message_module.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/c_message_module.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">Develop</a></div><div class="nav-item"><a href="/ENULS/" class="nav-link">ENULS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Docs/c_message_module.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/c_message_module.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Module Design</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/d_network.html" class="sidebar-link">Network module design document</a></li><li><a href="/Docs/d_ledger.html" class="sidebar-link">Design document of ledger module</a></li><li><a href="/Docs/d_chain_manager.html" class="sidebar-link">Chain Management Module Design Document</a></li><li><a href="/Docs/d_account.html" class="sidebar-link">Account Module Design Document</a></li><li><a href="/Docs/d_smart_contract.html" class="sidebar-link">Smart contract module design</a></li><li><a href="/Docs/d_transaction.html" class="sidebar-link">Transaction management module Design document</a></li><li><a href="/Docs/d_cross_chain.html" class="sidebar-link">Overall description</a></li><li><a href="/Docs/d_consensus.html" class="sidebar-link">Consensus Module Design Document</a></li><li><a href="/Docs/d_public_service.html" class="sidebar-link">Public-Service Module Design Document</a></li><li><a href="/Docs/d_block.html" class="sidebar-link">Block Management Module Design Document</a></li><li><a href="/Docs/d_protocol_update.html" class="sidebar-link">Upgrade module design document</a></li><li><a href="/Docs/d_address.html" class="sidebar-link">NULS Protocol Address</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interface</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/i_rpc_protocol.html" class="sidebar-link">NULS Application Interface Services</a></li><li><a href="/Docs/i_public_service.html" class="sidebar-link">Public Service</a></li><li><a href="/Docs/i_nuls-api_JSONRPC.html" class="sidebar-link">API-JSONRPC</a></li><li><a href="/Docs/i_nuls-api_RESTFUL.html" class="sidebar-link">API-RESTFUL</a></li><li><a href="/Docs/i_account.html" class="sidebar-link">Account Module</a></li><li><a href="/Docs/i_chain-manager.html" class="sidebar-link">Why should I have the Chain Management module?</a></li><li><a href="/Docs/i_cross-chain.html" class="sidebar-link">Interface List</a></li><li><a href="/Docs/i_network.html" class="sidebar-link">Why should I have &quot;Network Module&quot;?</a></li><li><a href="/Docs/i_block.html" class="sidebar-link">Block Module</a></li><li><a href="/Docs/i_transaction.html" class="sidebar-link">Transaction module</a></li><li><a href="/Docs/i_consensus.html" class="sidebar-link">poc Consensus Module</a></li><li><a href="/Docs/i_smart-contract.html" class="sidebar-link">Smart contract module</a></li><li><a href="/Docs/i_ledger.html" class="sidebar-link">Ledger Module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>ChainBox</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/c_chain_box.html" class="sidebar-link">NULS ChainBox</a></li><li><a href="/Docs/c_module.html" class="sidebar-link">Develope Module</a></li><li><a href="/Docs/c_message_module.html" aria-current="page" class="active sidebar-link">Encrypted Message Module Demo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#functional-design" class="sidebar-link">Functional design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#core-functions" class="sidebar-link">Core functions</a></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#secondary-functions" class="sidebar-link">Secondary functions</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#general-design" class="sidebar-link">General design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#binding-messagebox-address" class="sidebar-link">Binding messagebox address</a></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#sending-message" class="sidebar-link">Sending message</a></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#reading-message" class="sidebar-link">Reading message</a></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#charging-fees" class="sidebar-link">Charging fees</a></li></ul></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#detailed-design" class="sidebar-link">Detailed design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#package-structure-of-source-code" class="sidebar-link">Package structure of source code</a></li><li class="sidebar-sub-header"><a href="/Docs/c_message_module.html#user-interface-list" class="sidebar-link">User interface list</a></li></ul></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Docs/s_manual.html" class="sidebar-link">Development Manual</a></li><li><a href="/Docs/s_tools.html" class="sidebar-link">Development Tool</a></li><li><a href="/Docs/s_nrc20.html" class="sidebar-link">NRC-20</a></li><li><a href="/Docs/s_nrc721.html" class="sidebar-link">NRC-721</a></li><li><a href="/Docs/s_offline_assembly.html" class="sidebar-link">Smart contract offline assembly</a></li><li><a href="/Docs/s_advance.html" class="sidebar-link">Advanced Description</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="encrypted-message-module-demo"><a href="#encrypted-message-module-demo" class="header-anchor">#</a> Encrypted Message Module Demo</h1> <h2 id="functional-design"><a href="#functional-design" class="header-anchor">#</a> Functional design</h2> <p>The core business of the module is to directly send and receive text messages between two addresses and the encrypted message content will be stored on the chain and in the node file system.</p> <h3 id="core-functions"><a href="#core-functions" class="header-anchor">#</a> Core functions</h3> <ol><li>Bind the address to a unique messagebox address on the entire blockchain.</li> <li>Send message to the specified messagebox address.</li> <li>Receive message.</li> <li>View the message details.</li></ol> <h3 id="secondary-functions"><a href="#secondary-functions" class="header-anchor">#</a> Secondary functions</h3> <ol><li>View the Inbox and Outbox messageing lists.</li> <li>Pay additional fees for binding messagebox address and sending messages</li></ol> <h2 id="general-design"><a href="#general-design" class="header-anchor">#</a> General design</h2> <h3 id="binding-messagebox-address"><a href="#binding-messagebox-address" class="header-anchor">#</a> Binding messagebox address</h3> <p>Create the transaction type of applying for messagebox address (type_200) and business data (txData) includes the application address, messagebox address, address public key. When verifying the transaction, it is necessary to verify whether the messagebox address has been occupied, whether the application address has been bound to a messagebox, and whether the account balance of the application address is sufficient to pay the application fee and transaction fee. When the transaction is confirmed, the node will establish links between the application address, messagebox address and public key, and store them in the file system.</p> <p>There are two functions for binding the messagebox address.</p> <ol><li>Provide a format that is more easy to memorize and write for human beings than account addresses.</li> <li>Acquire the public key of the account address through transaction of the account, and asymmetrically encrypt the message content with the public key when sending the message.</li></ol> <h3 id="sending-message"><a href="#sending-message" class="header-anchor">#</a> Sending message</h3> <p>Create the transaction type of sending message (type_201) and business data (txData) includes sender address (not messagebox address), recipient address (not messagebox address), sending time, encrypted message title, encrypted message content, sender's reading permission <code>key</code> and recipient's reading permission <code>key</code>.</p> <h4 id="assembling-transaction"><a href="#assembling-transaction" class="header-anchor">#</a> Assembling transaction</h4> <p>The parameters of the message to be sent are sender's account address, account password, recipient's messagebox address, message title and message content. The processing steps are as follows:</p> <ol><li>Query the recipient's messagebox information through the recipient's messagebox address, and obtain the recipient's account address and public key.</li> <li>Generate a pair of keys (KEY) for the encrypted message, encrypt the title and content of message with public key, and encrypt KEY's private key with public keys of recipient and sender to obtain their reading permission <code>keys</code> respectively. When viewing the message content, they need to decrypt the reading permission <code>key</code> with their own private keys, and then decrypt the message title and content  with the reading permission <code>key</code>. In this way, data can be stored publicly, but only the sender and the recipient can view the content.</li></ol> <h4 id="verifying-transaction"><a href="#verifying-transaction" class="header-anchor">#</a> Verifying transaction</h4> <ol><li>Verify the messagebox address bound to the sender’s account address</li> <li>Verify the validity of the recipient’s messagebox address</li> <li>Verify that the specified amount of assets is transferred to the fee account.</li></ol> <h4 id="storing-message-data"><a href="#storing-message-data" class="header-anchor">#</a> Storing message data</h4> <p>Because it is a demo module, data is not stored in the database but in the file system to avoid unnecessary complexity. message storage mainly involves in the relationship between message, recipient, and sender, as well as message content.</p> <ol><li>Create two folders, <code>sender</code> and <code>recipient</code>, to store the relationship between the account address and the transaction hash related to the message. A file is created in the folder with the address as the file name, and each line in the file stores a transaction hash of message related to the account address. <code>Sender</code> folder stores the relationship between the sender and the message transaction hash, and <code>recipient</code> folder stores the relationship between the recipient and the message transaction hash.</li> <li>Create <code>message-data</code> folder to store messages and use message transaction hash as the file name to create a storage file. which stores hexadecimal string of the byte array of the message content.</li></ol> <h3 id="reading-message"><a href="#reading-message" class="header-anchor">#</a> Reading message</h3> <h4 id="decrypt-message-information"><a href="#decrypt-message-information" class="header-anchor">#</a> <span id="Decrypt message information">Decrypt message information</span></h4> <p>The message content is stored after encryption, so decryption is required for reading. The decryption failure throws an exception. The decryption process is as follows:</p> <ol><li>Get the message content by message hash.</li> <li>Deserialize the message content. First convert the hexadecimal string to a byte array, and then parse the byte array following the below rules orderly.</li></ol> <blockquote><ol><li>Store the recipient’s account address in variable-length type</li> <li>Store the sender’s account address in variable-length type</li> <li>Store the recipient’s reading permission <code>key</code> in variable-length type</li> <li>Store the sender’s reading permission <code>key</code> in variable-length type</li> <li>Store the message title in variable-length type</li> <li>Store the message content in variable-length type</li> <li>Store 64-bit integer timestamp with 4 bytes (milliseconds from January 1, 1970 to the current time)</li></ol></blockquote> <ol><li>Determine whether the current account is the recipient or the sender by the address, and decrypt the corresponding reading permission <code>key</code> by the private key.</li> <li>Decrypt the message title and content with the decrypted reading permission <code>key</code>.</li></ol> <h4 id="reading-the-inbox-or-outbox-messageing-list"><a href="#reading-the-inbox-or-outbox-messageing-list" class="header-anchor">#</a> Reading the Inbox or Outbox messageing list</h4> <p>Find the file with the same name as the account address in the <code>sender</code> and <code>recipient</code> folders, read the hash by line, and then use the hash to get the message details through [Decrypt message information](#Decrypt message information), and finally assemble the list.</p> <h3 id="charging-fees"><a href="#charging-fees" class="header-anchor">#</a> Charging fees</h3> <p>The fee payment is achieved by verifying that the CoinData of the transaction of binding messagebox and sending message contains the specified amount of assets transferred to the specified black hole address (fee address).</p> <h2 id="detailed-design"><a href="#detailed-design" class="header-anchor">#</a> Detailed design</h2> <h3 id="package-structure-of-source-code"><a href="#package-structure-of-source-code" class="header-anchor">#</a> Package structure of source code</h3> <div class="language- extra-class"><pre class="language-text"><code>.
└── io
    └── nuls
        ├── Config.java
        ├── Constant.java
        ├── MyModule.java
        ├── NulsModuleBootstrap.java
        ├── Utils.java
        ├──controller
        │ ├── CreatemessageAddressController.java
        │ ├── GetmessageController.java
        │ ├── SendmessageController.java
        │ ├── core
        │ │ ├── BaseController.java
        │ │ ├── NulsResourceConfig.java
        │ │ ├── Result.java
        │ │ └── WebServerManager.java
        │ └── vo
        │ ├── CreatemessageAddressReq.java
        │ ├── GetmessageListReq.java
        │ ├── messageAddressData.java
        │ ├── messageContentData.java
        │ ├── SendmessageReq.java
        │ └── ViewmessageReq.java
        ├── rpc
        │ ├── AccountTools.java
        │ ├── CallRpc.java
        │ ├── LegderTools.java
        │ ├── TransactionTools.java
        │ └── vo
        │ ├── Account.java
        │ ├── AccountBalance.java
        │ └── TxRegisterDetail.java
        ├── service
        │ ├── messageAddressService.java
        │ ├── SendmessageService.java
        │ └── dto
        │ ├── messageAddress.java
        │ └── messageContent.java
        └── txhander
            ├── messageAddressProcessor.java
            ├── SendmessageProcessor.java
            ├── TransactionDispatcher.java
            └── TransactionProcessor.java
</code></pre></div><h4 id="config-java"><a href="#config-java" class="header-anchor">#</a> Config.java</h4> <p>A configuration file, it reads the external NULS2.0 general configuration into the class through the configuration file system of the nuls-core. In this module, we need chainId (chain ID), assetId (asset ID), and dataPath (data storage path). These three items belong to the global general configuration and can be read directly. In addition, two business configuration items, messageAddressFee (fee of binding messagebox) and sendmessageFee (fee od sending message), are defined and need to be configured in module.ncf.</p> <h4 id="constant-java"><a href="#constant-java" class="header-anchor">#</a> Constant.java</h4> <p>A class defining constants, it defines the transaction type pf binding messagebox (200), transaction type pf sending message (201), and the black hole address for fee collection.</p> <h4 id="mymodule-java"><a href="#mymodule-java" class="header-anchor">#</a> MyModule.java</h4> <p>A bootstrap class, it declares that the current module depends on three modules, namely,  account, ledger, and transaction. The nuls-core-rpc package will automatically establish a websocket long connection with these 3 modules.
Complete the module initialization:</p> <ol><li>Create a folder to store data.</li> <li>Register the transaction type to the transaction module.</li> <li>Initialize the Restful WebServer service (the user interface is provided using the HTTP protocol).</li></ol> <h4 id="controller-package"><a href="#controller-package" class="header-anchor">#</a> controller package</h4> <p><code>controller</code> package provides user interface</p> <h5 id="createmessageaddresscontroller-java"><a href="#createmessageaddresscontroller-java" class="header-anchor">#</a> CreatemessageAddressController.java</h5> <p>The interface for binding account to messagebox address</p> <h5 id="getmessagecontroller-java"><a href="#getmessagecontroller-java" class="header-anchor">#</a> GetmessageController.java</h5> <p>The interface for obtaining messagebox information.</p> <h5 id="sendmessagecontroller-java"><a href="#sendmessagecontroller-java" class="header-anchor">#</a> SendmessageController.java</h5> <p>The interface for sending message</p> <h5 id="core-and-vo-package"><a href="#core-and-vo-package" class="header-anchor">#</a> core and vo package</h5> <p>Related to HTTP interface framework and interface protocol.</p> <h4 id="rpc-package"><a href="#rpc-package" class="header-anchor">#</a> rpc package</h4> <p>Utility class for accessing the RPC interface of other modules.</p> <h4 id="service-package"><a href="#service-package" class="header-anchor">#</a> service package</h4> <p>Related to data storage logic</p> <h5 id="messageaddressservice-java"><a href="#messageaddressservice-java" class="header-anchor">#</a> messageAddressService.java</h5> <p>Service for storing the information of messagebox address bound to the account</p> <h5 id="sendmessageservice-java"><a href="#sendmessageservice-java" class="header-anchor">#</a> SendmessageService.java</h5> <p>Service for sending message and querying emessage information.</p> <h4 id="dto-package"><a href="#dto-package" class="header-anchor">#</a> dto package</h4> <p>Defining data storage objects</p> <h4 id="txhander-package"><a href="#txhander-package" class="header-anchor">#</a> txhander package</h4> <p>Package of transaction callback functions</p> <h5 id="transactiondispatcher-java"><a href="#transactiondispatcher-java" class="header-anchor">#</a> TransactionDispatcher.java</h5> <p>Defining the RPC interface of the callback function, dispatching transactions to the specific handling class based on the transaction type.</p> <h5 id="messageaddressprocessor-java"><a href="#messageaddressprocessor-java" class="header-anchor">#</a> messageAddressProcessor.java</h5> <p>Defining callback functions that handle the transaction of binding messagebox address (type_200).</p> <h5 id="sendmessageprocessor-java"><a href="#sendmessageprocessor-java" class="header-anchor">#</a> SendmessageProcessor.java</h5> <p>Defining callback functions that handle the transaction of sending message (type_201).</p> <h3 id="user-interface-list"><a href="#user-interface-list" class="header-anchor">#</a> User interface list</h3> <p>The user interface is provided using HTTP protocol. The <code>Content type</code> of Request and Response is <code>application/json</code>, and the port is <code>9999</code>.</p> <h4 id="universal-protocol-of-return"><a href="#universal-protocol-of-return" class="header-anchor">#</a> Universal protocol of return</h4> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;success&quot;: true, // success status
    &quot;data&quot;: null, //returned data
    &quot;msg&quot;: null // the reason for the failure
}
</code></pre></div><h4 id="binding-messagebox-address-2"><a href="#binding-messagebox-address-2" class="header-anchor">#</a> Binding messagebox address</h4> <h5 id="access-path-message-createmessageaddress"><a href="#access-path-message-createmessageaddress" class="header-anchor">#</a> Access path: /message/createmessageAddress</h5> <h5 id="request-mode-post"><a href="#request-mode-post" class="header-anchor">#</a> Request mode: POST</h5> <h5 id="parameter-list"><a href="#parameter-list" class="header-anchor">#</a> parameter list</h5> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>address</td> <td>string</td> <td>apply for an account address</td></tr> <tr><td>messageAddress</td> <td>string</td> <td>apply for a bound messagebox address</td></tr> <tr><td>password</td> <td>string</td> <td>account password</td></tr></tbody></table> <h5 id="return-in-string-format"><a href="#return-in-string-format" class="header-anchor">#</a> Return in string format</h5> <p>txHash of the transaction.</p> <h4 id="querying-the-messagebox-address-bound-to-the-specified-account-address"><a href="#querying-the-messagebox-address-bound-to-the-specified-account-address" class="header-anchor">#</a> Querying the messagebox address bound to the specified account address</h4> <h5 id="access-path-message-getmessageaddress-address"><a href="#access-path-message-getmessageaddress-address" class="header-anchor">#</a> Access path: /message/getmessageAddress/{address}</h5> <h5 id="request-mode-get"><a href="#request-mode-get" class="header-anchor">#</a> Request mode: GET</h5> <h5 id="parameter-list-2"><a href="#parameter-list-2" class="header-anchor">#</a> parameter list</h5> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>address</td> <td>string</td> <td>account address</td></tr></tbody></table> <h5 id="return-in-string-format-2"><a href="#return-in-string-format-2" class="header-anchor">#</a> Return in string format</h5> <p>emessage address</p> <h4 id="sending-message-2"><a href="#sending-message-2" class="header-anchor">#</a> sending message</h4> <h5 id="access-path-message-sendmessage"><a href="#access-path-message-sendmessage" class="header-anchor">#</a> Access path: /message/sendmessage</h5> <h5 id="request-mode-post-2"><a href="#request-mode-post-2" class="header-anchor">#</a> Request mode: POST</h5> <h5 id="parameter-list-3"><a href="#parameter-list-3" class="header-anchor">#</a> parameter list</h5> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>messageAddress</td> <td>string</td> <td>recipient’s messagebox address</td></tr> <tr><td>senderAddress</td> <td>string</td> <td>sender’s account address</td></tr> <tr><td>password</td> <td>string</td> <td>sender’s account password</td></tr> <tr><td>title</td> <td>string</td> <td>message title</td></tr> <tr><td>content</td> <td>string</td> <td>message content</td></tr></tbody></table> <h5 id="return-in-string-format-3"><a href="#return-in-string-format-3" class="header-anchor">#</a> Return in string format</h5> <p>txHash of the transaction</p> <h4 id="getting-the-specified-message-details"><a href="#getting-the-specified-message-details" class="header-anchor">#</a> Getting the specified message details</h4> <h5 id="access-path-message-viewmessage"><a href="#access-path-message-viewmessage" class="header-anchor">#</a> Access path: /message/viewmessage</h5> <h5 id="request-mode-post-3"><a href="#request-mode-post-3" class="header-anchor">#</a> Request mode: POST</h5> <h5 id="parameter-list-4"><a href="#parameter-list-4" class="header-anchor">#</a> parameter list</h5> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>address</td> <td>string</td> <td>account address</td></tr> <tr><td>password</td> <td>string</td> <td>account password</td></tr> <tr><td>hash</td> <td>string</td> <td>hash of the message transaction</td></tr></tbody></table> <h5 id="return-as-an-object"><a href="#return-as-an-object" class="header-anchor">#</a> Return as an object</h5> <table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>hash</td> <td>hash of the message transaction</td></tr> <tr><td>sendermessageAddress</td> <td>sender’s messagebox address</td></tr> <tr><td>recipientmessageAddress</td> <td>recipient’s messagebox address</td></tr> <tr><td>title</td> <td>message title</td></tr> <tr><td>content</td> <td>message content</td></tr> <tr><td>sender</td> <td>sender’s account address</td></tr> <tr><td>date</td> <td>date of sending message</td></tr></tbody></table> <h4 id="getting-inbox-and-box-messageing-lists"><a href="#getting-inbox-and-box-messageing-lists" class="header-anchor">#</a> Getting Inbox and Box messageing lists</h4> <h5 id="access-path-message-getsendlist-message-getreceivelist"><a href="#access-path-message-getsendlist-message-getreceivelist" class="header-anchor">#</a> Access path: /message/getSendList, /message/getReceiveList</h5> <h5 id="request-mode-post-4"><a href="#request-mode-post-4" class="header-anchor">#</a> Request mode: POST</h5> <h5 id="parameter-list-5"><a href="#parameter-list-5" class="header-anchor">#</a> parameter list</h5> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>address</td> <td>string</td> <td>account address</td></tr> <tr><td>password</td> <td>string</td> <td>account password</td></tr></tbody></table> <h5 id="return-as-a-list"><a href="#return-as-a-list" class="header-anchor">#</a> Return as a list</h5> <table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>hash</td> <td>hash of the message transaction</td></tr> <tr><td>sendermessageAddress</td> <td>sender’s messagebox address</td></tr> <tr><td>recipientmessageAddress</td> <td>recipient’s messagebox address</td></tr> <tr><td>title</td> <td>message title</td></tr> <tr><td>content</td> <td>message content</td></tr> <tr><td>sender</td> <td>sender’s account address</td></tr> <tr><td>date</td> <td>date of sending message</td></tr></tbody></table></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/master/docs/Docs/c_message_module.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/10/2019, 3:13:46 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Docs/c_module.html" class="prev">
          Develope Module
        </a></span> <span class="next"><a href="/Docs/s_manual.html">
          Development Manual
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2df9194a.js" defer></script><script src="/assets/js/46.3ffccd37.js" defer></script>
  </body>
</html>
