(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{628:function(t,s,a){t.exports=a.p+"assets/img/event-bus-module.18c5a6f0.png"},629:function(t,s,a){t.exports=a.p+"assets/img/event-bus-content.23c1f972.png"},630:function(t,s,a){t.exports=a.p+"assets/img/event-bus-model.a7412672.png"},631:function(t,s,a){t.exports=a.p+"assets/img/event-bus-function.8044546e.png"},632:function(t,s,a){t.exports=a.p+"assets/img/event-bus-seq-flow.2de08cda.png"},633:function(t,s,a){t.exports=a.p+"assets/img/event-bus-main-flow.c97c465a.png"},839:function(t,s,a){"use strict";a.r(s);var r=[function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("div",{staticClass:"content"},[r("h1",{attrs:{id:"事件总线模块设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事件总线模块设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 事件总线模块设计")]),t._v(" "),r("h1",{attrs:{id:"事件总线模块设计文档"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事件总线模块设计文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 事件总线模块设计文档")]),t._v(" "),r("p",[t._v("[TOC]")]),t._v(" "),r("h2",{attrs:{id:"一、总体描述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#一、总体描述","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、总体描述")]),t._v(" "),r("h3",{attrs:{id:"_1-1-模块概述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-模块概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1 模块概述")]),t._v(" "),r("h4",{attrs:{id:"_1-1-1-为什么要有《事件总线》模块"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-为什么要有《事件总线》模块","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1.1 为什么要有《事件总线》模块")]),t._v(" "),r("blockquote",[r("p",[t._v("事件总线模块是专门用来接收及通知处理模块事件的功能性模块，管理着所有模块事件。")])]),t._v(" "),r("h4",{attrs:{id:"_1-1-2-《事件总线》要做什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-《事件总线》要做什么","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1.2 《事件总线》要做什么")]),t._v(" "),r("blockquote",[r("p",[t._v("提供事件的订阅、接收、发送等功能，是模块间的事件中转站")])]),t._v(" "),r("h4",{attrs:{id:"_1-1-3-《事件总线》在系统中的定位"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-《事件总线》在系统中的定位","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.1.3 《事件总线》在系统中的定位")]),t._v(" "),r("blockquote",[r("p",[t._v("事件模块是一个边缘系统，提供主要一些异步的消息发送，也就说，即使没有事件总线，系统一样可以正常运行，比较轻量级，而且不依赖其他模块系统。")])]),t._v(" "),r("h3",{attrs:{id:"_1-2-架构图"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-架构图","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.2 架构图")]),t._v(" "),r("p",[r("img",{attrs:{src:a(628),alt:"event-bus-module"}})]),t._v(" "),r("ul",[r("li",[t._v("事件总线模块主要含2部分交互逻辑：\n"),r("ul",[r("li",[t._v("与系统核心模块的微服务注册与服务信息获取。")]),t._v(" "),r("li",[t._v("与其他基础模块间的事件消息创建、订阅、转发管理。")])])])]),t._v(" "),r("h2",{attrs:{id:"二、功能设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二、功能设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、功能设计")]),t._v(" "),r("h3",{attrs:{id:"_2-1-功能架构图"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-功能架构图","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.1 功能架构图")]),t._v(" "),r("p",[r("img",{attrs:{src:a(629),alt:"event-bus-content"}})]),t._v(" "),r("h3",{attrs:{id:"_2-2-模块服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-模块服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.2 模块服务")]),t._v(" "),r("p",[r("img",{attrs:{src:a(630),alt:"event-bus-model"}})]),t._v(" "),r("blockquote",[r("p",[t._v("该模块提供事件的订阅，事件的转发")])]),t._v(" "),r("h4",{attrs:{id:"_2-2-1-修改系统运行参数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-修改系统运行参数","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.2.1 修改系统运行参数")]),t._v(" "),r("blockquote",[r("p",[t._v("只依赖核心系统，核心系统可以对事件模块系统的启动，停止，参数修改等，")])]),t._v(" "),r("h3",{attrs:{id:"_2-3-模块内部功能"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-模块内部功能","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.3 模块内部功能")]),t._v(" "),r("p",[r("img",{attrs:{src:a(631),alt:"event-bus-function"}})]),t._v(" "),r("blockquote",[r("p",[t._v("模块内部工能主要包含，订阅管理器，事件管理器，转发管理器。")])]),t._v(" "),r("ul",[r("li",[t._v("微服务接口信息同步管理\n"),r("ul",[r("li",[t._v("用于与kernel服务治理模块之间的服务接口同步")])])]),t._v(" "),r("li",[t._v("事件储存管理(eventBus)\n"),r("ul",[r("li",[t._v("用于进行事件信息的创建，订阅等储存，并且在模块重启是进行信息的初始化。")])])]),t._v(" "),r("li",[t._v("事件订阅管理(subscribe)\n"),r("ul",[r("li",[t._v("维护订阅事件的“配置表”：包括所有各个模块订阅的重要参数")])])]),t._v(" "),r("li",[t._v("事件转发管理(dispatcher)\n"),r("ul",[r("li",[t._v("开放接口用于事件的接收，对接收事件按订阅进行转发，转发调用接口通过服务信息管理接口获得")])])]),t._v(" "),r("li",[t._v("功能接口管理(rpc)\n"),r("ul",[r("li",[t._v("开放查询接口供外部查询")])])])]),t._v(" "),r("h3",{attrs:{id:"_2-4-事件总线流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-事件总线流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.4 事件总线流程")]),t._v(" "),r("ul",[r("li",[t._v("事件处理时序")])]),t._v(" "),r("p",[r("img",{attrs:{src:a(632),alt:"event-bus-seq-flow"}})]),t._v(" "),r("ul",[r("li",[t._v("事件处理基本流程")])]),t._v(" "),r("p",[r("img",{attrs:{src:a(633),alt:"event-bus-main-flow"}})]),t._v(" "),r("h3",{attrs:{id:"_2-5-业务逻辑"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-业务逻辑","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.5 业务逻辑")]),t._v(" "),r("blockquote",[r("p",[t._v("在事件转发失败（比如网络原因）情况下进行的异常逻辑处理 ，按以下2种逻辑处理:")])]),t._v(" "),r("ul",[r("li",[t._v("1、保留事件调用 按队列重复调用，直到转发成功。")]),t._v(" "),r("li",[t._v("2、尝试多次后直接丢弃,(暂定5次)每10秒后重试一次。")])]),t._v(" "),r("h2",{attrs:{id:"三、接口设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#三、接口设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 三、接口设计")]),t._v(" "),r("h3",{attrs:{id:"_3-1-模块接口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-模块接口","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.1 模块接口")]),t._v(" "),r("h4",{attrs:{id:"_3-1-1-事件主题订阅"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-事件主题订阅","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.1.1 事件主题订阅")]),t._v(" "),r("blockquote",[r("p",[t._v("cmd: subscribe")])]),t._v(" "),r("h5",{attrs:{id:"参数说明-request-body"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-request-body","aria-hidden":"true"}},[t._v("#")]),t._v(" 参数说明 (request body)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"subscribe"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"min_version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"params"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.nuls.network.bandwidth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//topic 事件主题\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"moduleId"')]),t._v(" //moduleId订阅者模块id\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h5",{attrs:{id:"返回值说明-response-content"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#返回值说明-response-content","aria-hidden":"true"}},[t._v("#")]),t._v(" 返回值说明 (response content)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//操作码\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reponse message."')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//失败时的信息\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"app_secret"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxxxx"')]),t._v(" // app_secret"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("暂时不需要，后期如果需要不是本机调用可能需要验证\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h4",{attrs:{id:"_3-1-2-事件取消订阅"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-事件取消订阅","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.1.2 事件取消订阅")]),t._v(" "),r("blockquote",[r("p",[t._v("cmd: unsubscribe")])]),t._v(" "),r("h5",{attrs:{id:"参数说明-request-body-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-request-body-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 参数说明 (request body)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unsubscribe"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"min_version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"params"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.nuls.network.bandwidth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //topic 事件主题\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"moduleId"')]),t._v(" //moduleId订阅者模块id\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h5",{attrs:{id:"返回值说明：-response-content"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#返回值说明：-response-content","aria-hidden":"true"}},[t._v("#")]),t._v(" 返回值说明：(response content)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //操作码\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reponse message."')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//失败时的信息\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h4",{attrs:{id:"_3-1-3-事件发送【自动创建topic】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-事件发送【自动创建topic】","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.1.3 事件发送【自动创建topic】")]),t._v(" "),r("blockquote",[r("p",[t._v("在没人订阅情况下是否保留一定时间？")])]),t._v(" "),r("blockquote",[r("p",[t._v("cmd: send")])]),t._v(" "),r("h5",{attrs:{id:"参数说明-request-body-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-request-body-3","aria-hidden":"true"}},[t._v("#")]),t._v(" 参数说明(request body)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"send"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"min_version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"params"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n   "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.nuls.network.bandwidth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//topic 事件主题\n   "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"moduleId"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //moduleId订阅者模块id\n   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),t._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data value"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" // 需要发送的事件，jsonObj\n "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h5",{attrs:{id:"返回值说明-response-content-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#返回值说明-response-content-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 返回值说明(response content)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //操作码\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reponse message."')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//失败时的信息\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h4",{attrs:{id:"_3-1-4-事件广播-推送push-or-dispatcher"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-事件广播-推送push-or-dispatcher","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.1.4 事件广播(推送push or dispatcher)")]),t._v(" "),r("blockquote",[r("p",[t._v("需要每个接口在订阅事件时提供接口，我在广播时调用即可,我这里是多线程去掉你们接口，你们需要返回正确的code,否则会有走重试机制")])]),t._v(" "),r("h5",{attrs:{id:"参数说明-request-body-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-request-body-4","aria-hidden":"true"}},[t._v("#")]),t._v(" 参数说明(request body)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dispatcher"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"min_version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"params"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" //data 需要发送的事件，payload\n "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h5",{attrs:{id:"返回值说明-response-content-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#返回值说明-response-content-3","aria-hidden":"true"}},[t._v("#")]),t._v(" 返回值说明(response content)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //一定要正确返回"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("不要需要告诉你业务逻辑是否出错，你只要接收到了就告诉我你成功接收到了即可。\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reponse message."')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//失败时的信息\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h3",{attrs:{id:"_3-2-功能接口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-功能接口","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.2 功能接口")]),t._v(" "),r("blockquote",[r("p",[t._v("功能接口是提供给界面和命令行工具使用的接口")])]),t._v(" "),r("h4",{attrs:{id:"获取事件主题信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取事件主题信息","aria-hidden":"true"}},[t._v("#")]),t._v(" 获取事件主题信息")]),t._v(" "),r("blockquote",[r("p",[t._v("cmd: topics")])]),t._v(" "),r("h5",{attrs:{id:"参数说明-request-body-5"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-request-body-5","aria-hidden":"true"}},[t._v("#")]),t._v(" 参数说明(request body)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"topics"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"min_version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"params"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h5",{attrs:{id:"返回值说明-response-content-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#返回值说明-response-content-4","aria-hidden":"true"}},[t._v("#")]),t._v(" 返回值说明(response content)")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //一定要正确返回"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("不要需要告诉你业务逻辑是否出错，你只要接收到了就告诉我你成功接收到了即可。\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reponse message."')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("//失败时的信息\n  "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"result"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topics"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  //主题id\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"createTime"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t//创建时间\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"moduleId"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   //主题创建者（模块）Id\n        "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"subscribes"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("//订阅者信息\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"moduleId"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" //订阅者\n                "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"subscribeTime"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" //订阅时间\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h4",{attrs:{id:"获取事件主题信息-包含该主题上所有事件信息？-每个事件其实我不关心的。"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取事件主题信息-包含该主题上所有事件信息？-每个事件其实我不关心的。","aria-hidden":"true"}},[t._v("#")]),t._v(" 获取事件主题信息(包含该主题上所有事件信息？) 每个事件其实我不关心的。")]),t._v(" "),r("blockquote",[r("p",[t._v("cmd : get_topic")])]),t._v(" "),r("h2",{attrs:{id:"四、事件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#四、事件说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 四、事件说明")]),t._v(" "),r("blockquote",[r("p",[t._v("不依赖任何事件")])]),t._v(" "),r("h2",{attrs:{id:"五、协议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#五、协议","aria-hidden":"true"}},[t._v("#")]),t._v(" 五、协议")]),t._v(" "),r("h3",{attrs:{id:"_5-1-网络通讯协议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-网络通讯协议","aria-hidden":"true"}},[t._v("#")]),t._v(" 5.1 网络通讯协议")]),t._v(" "),r("p",[t._v("无")]),t._v(" "),r("h3",{attrs:{id:"_5-2-交易协议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-交易协议","aria-hidden":"true"}},[t._v("#")]),t._v(" 5.2 交易协议")]),t._v(" "),r("h2",{attrs:{id:"六、模块配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#六、模块配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 六、模块配置")]),t._v(" "),r("h3",{attrs:{id:"_6-1-配置说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-配置说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.1 配置说明")]),t._v(" "),r("blockquote",[r("p",[t._v("一般支持性配置，端口，重试次数，重试时间，默认执行器的线程池大小，网络调用超时配置等。")])]),t._v(" "),r("div",{staticClass:"language-yml extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("server:\n  ip: 127.0.0.1   //本机ip，用于提供服务给其他模块,可以不填，默认自动获取\n  port: 8080    //提供服务的端口,可以不填，默认自动获取\n")])])]),r("h3",{attrs:{id:"_6-2-模块依赖关系"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-模块依赖关系","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.2 模块依赖关系")]),t._v(" "),r("ul",[r("li",[t._v("内核模块\n"),r("ul",[r("li",[t._v("模块注册")]),t._v(" "),r("li",[t._v("模块注销")]),t._v(" "),r("li",[t._v("模块状态上报（心跳）")]),t._v(" "),r("li",[t._v("服务接口数据获取及定时更新")])])])]),t._v(" "),r("h2",{attrs:{id:"七、java特有的设计"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#七、java特有的设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 七、Java特有的设计")]),t._v(" "),r("blockquote",[r("p",[t._v("核心对象类定义,存储数据结构，......")])]),t._v(" "),r("h2",{attrs:{id:"八、补充内容"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#八、补充内容","aria-hidden":"true"}},[t._v("#")]),t._v(" 八、补充内容")]),t._v(" "),r("blockquote",[r("p",[t._v("上面未涉及的必须的内容")])])])}],e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},r,!1,null,null,null);n.options.__file="eventBusModuleDesign.md";s.default=n.exports}}]);