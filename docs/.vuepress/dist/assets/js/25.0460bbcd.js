(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{608:function(t,_,e){t.exports=e.p+"assets/img/block-module.ffc57f74.png"},609:function(t,_,e){t.exports=e.p+"assets/img/block-module-boot.4686b7bf.png"},610:function(t,_,e){t.exports=e.p+"assets/img/block-synchronization.3b5f0ded.png"},611:function(t,_,e){t.exports=e.p+"assets/img/block-synchronization2.1bde323a.png"},612:function(t,_,e){t.exports=e.p+"assets/img/block-synchronization3.99496017.png"},613:function(t,_,e){t.exports=e.p+"assets/img/block-basic-validation.07557d70.png"},614:function(t,_,e){t.exports=e.p+"assets/img/block-basic-validation1.cf392d66.png"},615:function(t,_,e){t.exports=e.p+"assets/img/block-fork.a3b65fd6.png"},616:function(t,_,e){t.exports=e.p+"assets/img/block-fork-chain.ceeb7bdd.png"},849:function(t,_,e){"use strict";e.r(_);var v=[function(){var t=this.$createElement,_=this._self._c||t;return _("h1",{attrs:{id:"区块管理模块设计文档"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#区块管理模块设计文档","aria-hidden":"true"}},[this._v("#")]),this._v(" 区块管理模块设计文档")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"一、总体描述"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#一、总体描述","aria-hidden":"true"}},[this._v("#")]),this._v(" 一、总体描述")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_1-1-模块概述"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-模块概述","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1 模块概述")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_1-1-1-为什么要有《区块管理》模块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-为什么要有《区块管理》模块","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1.1 为什么要有《区块管理》模块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_1-1-2-《区块管理》要做什么"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-《区块管理》要做什么","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1.2 《区块管理》要做什么")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("如果是自身节点打包区块，共识模块会把打包好的区块交给区块管理模块，区块管理模块会负责进行区块验证、区块保存、区块广播，并且要响应网络上的其他节点发起的获取该区块的请求。")]),this._v(" "),_("li",[this._v("如果是其他共识节点打包区块，本地节点会收到网络上发来的转发区块消息，此时要从其他节点获取区块信息，进行验证并保存，保存完成后再次转发该区块，让区块在全网传播。")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("pre",[_("code",[this._v("对外提供区块头、区块查询服务\n")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_1-1-3-《区块管理》在系统中的定位"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-《区块管理》在系统中的定位","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1.3 《区块管理》在系统中的定位")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("区块同步-依赖网络模块的通讯接口，依赖工具模块的序列化工具")]),this._v(" "),_("li",[this._v("区块存储、回滚-依赖工具模块的数据库存储工具、共识模块、交易管理模块")]),this._v(" "),_("li",[this._v("区块转发-依赖网络模块的广播消息接口")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("整个系统可以发起交易-区块同步")]),this._v(" "),_("li",[this._v("共识模块:区块详细验证、打包-区块查询、区块保存、区块广播、区块回滚")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_1-2-架构图"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-架构图","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.2 架构图")])},function(){var t=this.$createElement,_=this._self._c||t;return _("p",[_("img",{attrs:{src:e(608),alt:""}})])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"二、功能设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#二、功能设计","aria-hidden":"true"}},[this._v("#")]),this._v(" 二、功能设计")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_2-1-功能架构图"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-功能架构图","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 功能架构图")])},function(){var t=this.$createElement,_=this._self._c||t;return _("p",[_("img",{attrs:{src:"image/block-module/block-functions.png",alt:""}})])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ol",[e("li",[t._v("提供api，进行区块存储、查询、回滚的操作")]),t._v(" "),e("li",[t._v("从网络上同步最新区块，进行初步验证、分叉验证，如果没有分叉，调用共识模块进行共识验证，调用交易模块进行交易验证，全部验证通过后保存到本地。")]),t._v(" "),e("li",[t._v("区块同步、广播、转发消息的处理")]),t._v(" "),e("li",[t._v("分叉区块的判断、存储")]),t._v(" "),e("li",[t._v("孤儿区块的判断、存储")]),t._v(" "),e("li",[t._v("分叉链维护、切换")]),t._v(" "),e("li",[t._v("孤儿链维护、切换")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_2-2-模块服务"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-模块服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2 模块服务")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-1-获取本地最新区块头"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-获取本地最新区块头","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.1 获取本地最新区块头")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID、缓存的最新区块高度查询DB得到最新区块头HASH")]),this._v(" "),_("li",[this._v("根据HASH查询DB得到区块头byte数组")]),this._v(" "),_("li",[this._v("反序列化为区块头对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bestBlockHeader",\n  "minVersion":"1.1",\n  "params": ["888"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n        "chainId": "888",\n        "hash": "xxxxxxx",\n        "preHash": "xxxxxxx",\n        "merkleHash": "1",\n        "height": 1,\n        "size": 1,\n        "time": 1,\n        "txCount": 1,\n        "packingAddress": "1",\n        "reward": 0,\n        "fee": 0,\n        "extend": xxxxxxx,HEX\n        "scriptSig": "1"\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("上一区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块MerkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("size")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("区块大小")])]),t._v(" "),e("tr",[e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块打包时间")])]),t._v(" "),e("tr",[e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("packingAddress")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("打包地址")])]),t._v(" "),e("tr",[e("td",[t._v("reward")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("共识奖励")])]),t._v(" "),e("tr",[e("td",[t._v("fee")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("手续费")])]),t._v(" "),e("tr",[e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("扩展字段,HEX,包含roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot")])]),t._v(" "),e("tr",[e("td",[t._v("scriptSig")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-2-获取本地最新区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-获取本地最新区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.2 获取本地最新区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明:")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID获取本地最新区块头")]),this._v(" "),_("li",[this._v("根据区块头高度查询DB得到交易HASH列表")]),this._v(" "),_("li",[this._v("根据HASH列表从交易管理模块获取交易数据")]),this._v(" "),_("li",[this._v("组装成block对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bestBlock",\n  "minVersion":"1.1",\n  "params": ["888"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("pre",[e("code",[t._v('```\n{\n    "version": 1.2,\n    "code":1,\n    "msg" :"xxxxxxxxxxxxxxxxxx",\n    "result":{}\n}\n```\n')])]),t._v(" "),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n    \t"blockHeader": {\n            "chainId": "888",\n            "hash": "xxxxxxx",\n            "preHash": "xxxxxxx",\n            "merkleHash": "1",\n            "height": 1,\n            "size": 1,\n            "time": 1,\n            "txCount": 1,\n            "packingAddress": "1",\n            "reward": 0,\n            "fee": 0,\n            "extend": xxxxxxx,HEX\n            "scriptSig": "1"\n    \t}, //区块头\n    \t"transactions": [\n    \t    {\n                "chainId": "888", //链Id\n                "height": "1", //区块高度\n                "hash": "1", //交易HASH\n                "remark": "1", //交易备注\n                "size": "1", //交易大小\n                "time": "1", //交易时间\n                "type": "1", //交易类型\n                "transactionSignature": "1", //交易签名\n                "coinData": {\n                    "from" : [\n                        {\n                            "fromAssetsChainId":""//资产发行链的id  \n                            "fromAssetsId":""//资产id\n                            "fromAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "nonce":""//交易顺序号，递增\n                        },{...}\n                    ]\n                    "to" : [\n                        {\n                            "toAssetsChainId":""//资产发行链的id  \n                            "toAssetsId":""//资产id\n                            "toAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "locktime":""\n                        },{...}\n                    ]\n                }\n                "txData": XXXX, //交易数据 HEX\n    \t    },\n    \t    {...}\n    \t] //交易列表\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")]),t._v(" "),e("p",[t._v("略")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-3-根据高度获取区块头"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-根据高度获取区块头","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.3 根据高度获取区块头")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID、高度查询DB得到最新区块头HASH")]),this._v(" "),_("li",[this._v("根据HASH查询DB得到区块头byte数组")]),this._v(" "),_("li",[this._v("反序列化为区块头对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "getBlockHeaderByHeight",\n  "minVersion":"1.1",\n  "params": ["111","888"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("height")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("区块高度")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n        "chainId": "888",\n        "hash": "xxxxxxx",\n        "preHash": "xxxxxxx",\n        "merkleHash": "1",\n        "height": 1,\n        "size": 1,\n        "time": 1,\n        "txCount": 1,\n        "packingAddress": "1",\n        "reward": 0,\n        "fee": 0,\n        "extend": xxxxxxx,HEX\n        "scriptSig": "1"\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("链Id")])]),t._v(" "),e("tr",[e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("上一区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块MerkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("size")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("区块大小")])]),t._v(" "),e("tr",[e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块打包时间")])]),t._v(" "),e("tr",[e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("packingAddress")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("打包地址")])]),t._v(" "),e("tr",[e("td",[t._v("reward")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("共识奖励")])]),t._v(" "),e("tr",[e("td",[t._v("fee")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("手续费")])]),t._v(" "),e("tr",[e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("扩展字段,HEX,包含roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot")])]),t._v(" "),e("tr",[e("td",[t._v("scriptSig")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-4-根据高度获取区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-根据高度获取区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.4 根据高度获取区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明:")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID、高度获取区块头")]),this._v(" "),_("li",[this._v("根据区块头高度查询DB得到交易HASH列表")]),this._v(" "),_("li",[this._v("根据HASH列表从交易管理模块获取交易数据")]),this._v(" "),_("li",[this._v("组装成block对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getBlockByHeight",\n  "minVersion":"1.1",\n  "params": ["111","888"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("height")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("区块高度")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("pre",[e("code",[t._v('```\n{\n    "version": 1.2,\n    "code":1,\n    "msg" :"xxxxxxxxxxxxxxxxxx",\n    "result":{}\n}\n```\n')])]),t._v(" "),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n    \t"blockHeader": {\n            "chainId": "888",\n            "hash": "xxxxxxx",\n            "preHash": "xxxxxxx",\n            "merkleHash": "1",\n            "height": 1,\n            "size": 1,\n            "time": 1,\n            "txCount": 1,\n            "packingAddress": "1",\n            "reward": 0,\n            "fee": 0,\n            "extend": xxxxxxx,HEX\n            "scriptSig": "1"\n    \t}, //区块头\n    \t"transactions": [\n    \t    {\n                "chainId": "888",//链ID\n                "height": "1", //区块高度\n                "hash": "1", //交易HASH\n                "remark": "1", //交易备注\n                "size": "1", //交易大小\n                "time": "1", //交易时间\n                "type": "1", //交易类型\n                "transactionSignature": "1", //交易签名\n                "coinData": {\n                    "from" : [\n                        {\n                            "fromAssetsChainId":""//资产发行链的id  \n                            "fromAssetsId":""//资产id\n                            "fromAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "nonce":""//交易顺序号，递增\n                        },{...}\n                    ]\n                    "to" : [\n                        {\n                            "toAssetsChainId":""//资产发行链的id  \n                            "toAssetsId":""//资产id\n                            "toAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "nonce":""//交易顺序号，递增\n                        },{...}\n                    ]\n                }\n                "txData": XXXX, //交易数据 HEX\n    \t    },\n    \t    {...}\n    \t], //交易列表\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")]),t._v(" "),e("p",[t._v("略")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-5-根据hash获取区块头"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-根据hash获取区块头","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.5 根据HASH获取区块头")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID、HASH查询DB得到区块头byte数组")]),this._v(" "),_("li",[this._v("反序列化为区块头对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getBlockHeaderByHash",\n  "minVersion":"1.1",\n  "params": ["888","aaa"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("区块hash")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n        "chainId": "888",\n        "hash": "xxxxxxx",\n        "preHash": "xxxxxxx",\n        "merkleHash": "1",\n        "height": 1,\n        "size": 1,\n        "time": 1,\n        "txCount": 1,\n        "packingAddress": "1",\n        "reward": 0,\n        "fee": 0,\n        "extend": xxxxxxx,HEX\n        "scriptSig": "1"\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("上一区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块MerkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("size")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("区块大小")])]),t._v(" "),e("tr",[e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块打包时间")])]),t._v(" "),e("tr",[e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("packingAddress")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("打包地址")])]),t._v(" "),e("tr",[e("td",[t._v("reward")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("共识奖励")])]),t._v(" "),e("tr",[e("td",[t._v("fee")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("手续费")])]),t._v(" "),e("tr",[e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("扩展字段,HEX,包含roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot")])]),t._v(" "),e("tr",[e("td",[t._v("scriptSig")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-6-根据hash获取区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-根据hash获取区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.6 根据HASH获取区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明:")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据链ID、hash获取区块头")]),this._v(" "),_("li",[this._v("根据区块头高度查询DB得到交易HASH列表")]),this._v(" "),_("li",[this._v("根据HASH列表从交易管理模块获取交易数据")]),this._v(" "),_("li",[this._v("组装成block对象")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getBlockByHash",\n  "minVersion":"1.1",\n  "params": ["888","aaa"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("区块hash")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("pre",[e("code",[t._v('```\n{\n    "version": 1.2,\n    "code":1,\n    "msg" :"xxxxxxxxxxxxxxxxxx",\n    "result":{}\n}\n```\n')])]),t._v(" "),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n    \t"blockHeader": {\n    \t    "chainId": "888",\n            "hash": "xxxxxxx",\n            "preHash": "xxxxxxx",\n            "merkleHash": "1",\n            "height": 1,\n            "size": 1,\n            "time": 1,\n            "txCount": 1,\n            "packingAddress": "1",\n            "reward": 0,\n            "fee": 0,\n            "extend": xxxxxxx,HEX\n            "scriptSig": "1"\n    \t}, //区块头\n    \t"transactions": [\n    \t    {\n    \t        "chainId": "888",\n                "height": "1", //区块高度\n                "hash": "1", //交易HASH\n                "remark": "1", //交易备注\n                "size": "1", //交易大小\n                "time": "1", //交易时间\n                "type": "1", //交易类型\n                "transactionSignature": "1", //交易签名\n                "coinData": {\n                    "from" : [\n                        {\n                            "fromAssetsChainId":""//资产发行链的id  \n                            "fromAssetsId":""//资产id\n                            "fromAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "nonce":""//交易顺序号，递增\n                        },{...}\n                    ]\n                    "to" : [\n                        {\n                            "toAssetsChainId":""//资产发行链的id  \n                            "toAssetsId":""//资产id\n                            "toAddress":""//转出账户地址\n                            "amount":""//转出金额\n                            "nonce":""//交易顺序号，递增\n                        },{...}\n                    ]\n                }\n                "txData": XXXX, //交易数据 HEX\n    \t    },\n    \t    {...}\n    \t], //交易列表\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")]),t._v(" "),e("p",[t._v("略")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-7-获取当前同步区块状态"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-7-获取当前同步区块状态","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.7 获取当前同步区块状态")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getSynchronizeInfo",\n  "minVersion":"1.1",\n  "params": ["888"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {"chainId": "888", "sync": "true"}\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("sync")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块同步是否完成")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-8-获取某高度区间内区块头"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-8-获取某高度区间内区块头","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.8 获取某高度区间内区块头")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ol",[e("li",[t._v("令queryHash=endHash")]),t._v(" "),e("li",[t._v("根据链ID、queryHash查询DB得到区块头byte数组")]),t._v(" "),e("li",[t._v("反序列化为区块头对象blockHeader，添加到List中作为返回值")]),t._v(" "),e("li",[t._v("如果blockHeader.hash!=startHash，令queryHash=blockHeader.preHash，重复第2步")]),t._v(" "),e("li",[t._v("返回List")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getBlockHeaderBetweenHeights",\n  "minVersion":"1.1",\n  "params": ["888",111","111"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("startHeight")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("起始高度")])]),t._v(" "),e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("endHeight")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("结束高度")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n        "list" : [\n            {\n           "chainId": "888",\n           "hash": "xxxxxxx",\n           "preHash": "xxxxxxx",\n           "merkleHash": "1",\n           "height": 1,\n           "size": 1,\n           "time": 1,\n           "txCount": 1,\n           "packingAddress": "1",\n           "reward": 0,\n           "fee": 0,\n           "extend": xxxxxxx,HEX\n           "scriptSig": "1"\n           }\n        ]\n\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("上一区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块MerkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("size")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("区块大小")])]),t._v(" "),e("tr",[e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("区块打包时间")])]),t._v(" "),e("tr",[e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Integer")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("packingAddress")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("打包地址")])]),t._v(" "),e("tr",[e("td",[t._v("reward")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("共识奖励")])]),t._v(" "),e("tr",[e("td",[t._v("fee")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",[t._v("手续费")])]),t._v(" "),e("tr",[e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("扩展字段,HEX,包含roundIndex、roundStartTime、consensusMemberCount、packingIndexOfRound、stateRoot")])]),t._v(" "),e("tr",[e("td",[t._v("scriptSig")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-9-获取某高度区间内区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-9-获取某高度区间内区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.9 获取某高度区间内区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ol",[e("li",[t._v("令queryHash=endHash")]),t._v(" "),e("li",[t._v("根据链ID、queryHash查询DB得到区块byte数组")]),t._v(" "),e("li",[t._v("反序列化为区块对象block，添加到List中作为返回值")]),t._v(" "),e("li",[t._v("如果block.hash!=startHash，令queryHash=block.preHash，startHash，重复第2步")]),t._v(" "),e("li",[t._v("返回List")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("请求示例")]),this._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n  "cmd": "bl_getBlockBetweenHeights",\n  "minVersion":"1.1",\n  "params": ["888",111","111"]\n}\n')])])])]),this._v(" "),_("li",[_("p",[this._v("请求参数说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("index")]),t._v(" "),e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("required")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0")]),t._v(" "),e("td",[t._v("chainId")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("startHeight")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("起始高度")])]),t._v(" "),e("tr",[e("td",[t._v("2")]),t._v(" "),e("td",[t._v("endHeight")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Long")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("结束高度")])])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {\n        "list" : [\n            {\n                "blockHeader": {\n                    "chainId": "888",\n                    "hash": "xxxxxxx",\n                    "preHash": "xxxxxxx",\n                    "merkleHash": "1",\n                    "height": 1,\n                    "size": 1,\n                    "time": 1,\n                    "txCount": 1,\n                    "packingAddress": "1",\n                    "reward": 0,\n                    "fee": 0,\n                    "extend": xxxxxxx,HEX\n                    "scriptSig": "1"\n                }, //区块头\n                "transactions": [\n                    {\n                        "chainId": "888",\n                        "height": "1", //区块高度\n                        "hash": "1", //交易HASH\n                        "remark": "1", //交易备注\n                        "size": "1", //交易大小\n                        "time": "1", //交易时间\n                        "type": "1", //交易类型\n                        "transactionSignature": "1", //交易签名\n                        "coinData": {\n                            "from" : [\n                                {\n                                    "fromAssetsChainId":""//资产发行链的id  \n                                    "fromAssetsId":""//资产id\n                                    "fromAddress":""//转出账户地址\n                                    "amount":""//转出金额\n                                    "nonce":""//交易顺序号，递增\n                                },{...}\n                            ]\n                            "to" : [\n                                {\n                                    "toAssetsChainId":""//资产发行链的id  \n                                    "toAssetsId":""//资产id\n                                    "toAddress":""//转出账户地址\n                                    "amount":""//转出金额\n                                    "nonce":""//交易顺序号，递增\n                                },{...}\n                            ]\n                        }\n                        "txData": XXXX, //交易数据 HEX\n                    },\n                    {...}\n                ], //交易列表\n           }\n        ]\n\n    }\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")]),t._v(" "),e("p",[t._v("略")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-10-接收最新打包区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-10-接收最新打包区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.10 接收最新打包区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("请求示例")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n  "cmd": "receivePackingBlock",\n  "minVersion":"1.1",\n  "params": [\n  \tblockhex//能用hex就用hex\n  ]\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("请求参数说明")]),t._v(" "),e("p",[t._v("略")])]),t._v(" "),e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {"sync": "true"}\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("sync")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块是否保存成功")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-11-运行一条链"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-11-运行一条链","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.11 运行一条链")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("请求示例")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n  "cmd": "bl_startChain",\n  "minVersion":"1.1",\n  "params": ["888"]\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("请求参数说明")]),t._v(" "),e("p",[t._v("略")])]),t._v(" "),e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {"result": "true"}\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("result")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("新链是否启动成功")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-2-12-停止一条链"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-12-停止一条链","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2.12 停止一条链")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("接口说明")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("请求示例")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n  "cmd": "bl_stopChain",\n  "minVersion":"1.1",\n  "params": ["888"]\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("请求参数说明")]),t._v(" "),e("p",[t._v("略")])]),t._v(" "),e("li",[e("p",[t._v("返回示例")]),t._v(" "),e("p",[t._v("Failed")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 1,\n    "msg": "error message",\n    "result": {}\n}\n')])])]),e("p",[t._v("Success")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('{\n    "version": 1.2,\n    "code": 0,\n    "result": {"result": "true"}\n}\n')])])])]),t._v(" "),e("li",[e("p",[t._v("返回字段说明")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("parameter")]),t._v(" "),e("th",[t._v("type")]),t._v(" "),e("th",[t._v("description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("result")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("新链是否停止成功")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_2-3-模块内部功能"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-模块内部功能","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3 模块内部功能")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-1-模块启动"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-模块启动","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.1 模块启动")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("功能说明:")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("流程描述")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("p",[_("img",{attrs:{src:e(609),alt:""}})])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[t._v("1.加载区块模块配置信息")]),t._v(" "),e("li",[t._v("2.加载区块模块消息、消息处理器")]),t._v(" "),e("li",[t._v("3.注册区块模块服务接口（向核心模块注册）")]),t._v(" "),e("li",[t._v("4.注册区块模块事件（向事件总线模块注册）")]),t._v(" "),e("li",[t._v("5.启动同步区块线程、区块监控线程、分叉链处理线程")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("依赖服务")]),this._v(" "),_("p",[this._v("工具模块、内核模块")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-2-区块存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-区块存储","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.2 区块存储")])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("功能说明:")]),t._v(" "),e("p",[t._v("说明存储表划分")]),t._v(" "),e("ul",[e("li",[t._v("主链存储")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("     不同的链存到不同的表，表名加chainID后缀\n     一个完整的区块由区块头和交易组成，区块头与交易分别进行存储。\n       区块头:(放在区块管理模块)\n           key(区块高度)-value(区块头hash)              block-header-index\n           key(区块头hash)-value(完整的区块头)           block-header\n       交易:(放在交易管理模块)\n")])])]),e("ul",[e("li",[t._v("分叉链存储")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("     内存中缓存每一个分叉链的(起始高度、起始hash、结束高度、结束hash)，在硬盘中缓存全量分叉链数据\n     不同链的分叉链集合存在不同的表，表名加chainID后缀，每一个分叉链对象如下:\n         key(start区块高度+start区块hash)-value(完整的chains)          fork chains\n     private Chain chain;\n             private String id;\n             private String preChainId;\n             private BlockHeader startBlockHeader;\n             private BlockHeader endBlockHeader;\n             private List<BlockHeader> blockHeaderList;\n             private List<Block> blockList;\n")])])])]),t._v(" "),e("li",[e("p",[t._v("流程描述")]),t._v(" "),e("p",[t._v("略")])]),t._v(" "),e("li",[e("p",[t._v("依赖服务")]),t._v(" "),e("p",[t._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-2-区块同步"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-区块同步","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.2 区块同步")])},function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ul",[v("li",[v("p",[t._v("功能说明:")]),t._v(" "),v("p",[t._v("略")])]),t._v(" "),v("li",[v("p",[t._v("流程描述")]),t._v(" "),v("ul",[v("li",[t._v("区块同步主流程")])]),t._v(" "),v("p",[v("img",{attrs:{src:e(610),alt:""}})]),t._v(" "),v("ul",[v("li",[t._v("获取网络上可用节点列表")])]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("    1. 遍历节点，统计两个MAP，假定每个节点的(最新HASH+最新高度)是key\n    2. 一个以key为主键统计次数\n    3. 一个以key为主键记录持有该key的节点列表\n    4. 最终统计出出现频率最大的key，就获取到当前可信的最新高度与最新hash，以及可信的节点列表\n    \n    举个栗子:\n    现在同时连接到10个节点。其中4个节点(A,B,C,D)的最新区块高度是100，最新区块hash是aaa，其中6个节点(E,F,G,H,I,J)的最新区块高度是101，最新区块hash是bbb。\n    最终返回(101，bbb,[E,F,G,H,I,J])。\n")])])]),v("ul",[v("li",[t._v("下载区块逻辑")])]),t._v(" "),v("p",[v("img",{attrs:{src:e(611),alt:""}})]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("    在正式下载区块前，要判断本地与网络是否发生分叉，是否需要回滚。以便找到准确的区块下载高度。\n    以下分情况讨论:\n    取上一步的结果(101，bbb,[E,F,G,H,I,J])，同时LH(N)代表本地第N块的hash，RH(N)代表网络上第N块的hash。\n    1.本地高度100<网络高度101，LH(100)==RH(100)，正常，比远程节点落后，下载区块\n    2.本地高度100<网络高度101，LH(100)!=RH(100)，认为本地分叉，回滚本地区块，如果LH(99)==RH(99)\n    回滚结束，从99块开始下载，如果LH(99)!=RH(99)，继续回滚，重复上述逻辑。但最多回滚10个块就停止，等待下次同步，这样可以避免被恶意节点攻击，大量回滚正常区块。\n    3.本地高度102>网络高度101，LH(101)==RH(101)，正常，比远程节点领先，无需下载区块\n    4.本地高度102>网络高度101，LH(101)!=RH(101)，认为本地分叉，先一次性回滚到高度与远程一致，重复场景2\n    5.本地高度101=网络高度101，LH(101)==RH(101)，正常，与远程节点一致，无需下载区块\n    6.本地高度101=网络高度101，LH(101)!=RH(101)，认为本地分叉，重复场景2\n    \n    场景1、2需要额外从节点下载与本地高度一致的区块，进行hash判断\n    上述需要回滚的场景，要满足可用节点数(10个)>配置，一致可用节点数(6个)占比超80%两个条件，避免节点太少导致频繁回滚。以上两个条件都不满足，清空已连接节点，重新获取可用节点。\n\n    真正下载区块时，举个栗子:\n    当前高度100，网络高度500，可用节点12个，一致可用节点10个，每个节点每次下载区块2个\n    那么计算得出需要下载区块400个，400/(2*10)=20轮下载完毕，同时可以计算出每轮每个节点下载区块的高度范围\n    伪代码表示\n        For(20轮){\n            for(10个节点){\n                每个节点下载对应区块，并放到共享队列给区块验证线程处理\n            }\n        }\n    考虑下载过程中，节点掉线的情况。可能20轮不能下载完，所以外层加循环。\n        while(没有下载完){\n            重新计算轮次、各节点下载区块高度区间\n            For(20轮){\n                for(10个节点){\n                    每个节点下载对应区块，并放到共享队列给区块验证线程处理\n                }\n            }\n        }\n")])])]),v("ul",[v("li",[t._v("从节点下载某高度区间内的区块")])]),t._v(" "),v("p",[v("img",{attrs:{src:e(612),alt:""}})])]),t._v(" "),v("li",[v("p",[t._v("依赖服务")]),t._v(" "),v("p",[t._v("工具模块的数据库存储工具、RPC工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-3-区块基础验证"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-区块基础验证","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.3 区块基础验证")])},function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ul",[v("li",[v("p",[t._v("功能说明:")]),t._v(" "),v("p",[t._v("验证区块自身数据正确性,下载过程中验证，验证通过说明区块数据本身没有问题，验证失败则丢弃该区块")])]),t._v(" "),v("li",[v("p",[t._v("流程描述")]),t._v(" "),v("ul",[v("li",[t._v("区块基本验证")])]),t._v(" "),v("p",[v("img",{attrs:{src:e(613),alt:""}})]),t._v(" "),v("ul",[v("li",[t._v("区块头验证")])]),t._v(" "),v("p",[v("img",{attrs:{src:e(614),alt:""}})])]),t._v(" "),v("li",[v("p",[t._v("依赖服务")]),t._v(" "),v("p",[t._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-4-分叉块验证"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-分叉块验证","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.4 分叉块验证")])},function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ul",[v("li",[v("p",[t._v("功能说明:")]),t._v(" "),v("p",[t._v("验证区块上下文正确性，下载完成后验证，验证通过说明该区块与主链相连，验证失败说明该区块分叉，进入分叉链处理逻辑")])]),t._v(" "),v("li",[v("p",[t._v("流程描述")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("定义一条主链(MasterChain)，一个分叉链集合(forkChains)")])]),t._v(" "),v("li",[v("p",[t._v("定义待验证区块为Block")])]),t._v(" "),v("li",[v("p",[t._v("定义主链高度MG，待验证区块高度BG")])]),t._v(" "),v("li",[v("p",[t._v("定义主链最新区块HASH为MH，待验证区块HASH为BH，待验证区块PREHASH为BPH")])]),t._v(" "),v("li",[v("p",[t._v("分六种情况讨论")])]),t._v(" "),v("li",[v("p",[t._v("1.MG==BG，MH==BH，说明重复收到最新主链区块，丢弃")])]),t._v(" "),v("li",[v("p",[t._v("2.MG==BG，MH!=BH，说明网络分叉")]),t._v(" "),v("ul",[v("li",[t._v("遍历已有分叉链集合，判断是否已存在此区块\n"),v("ul",[v("li",[t._v("如果已存在，丢弃该区块")]),t._v(" "),v("li",[t._v("如果不存在，新建一条分叉链\n"),v("ul",[v("li",[t._v("判断是否能连接上其他的分叉链（若能连上，则连接到其他分叉链则视为一条链）")]),t._v(" "),v("li",[t._v("递归判断")])])])])])])]),t._v(" "),v("li",[v("p",[t._v("3.MG==BG-1，MH==BPH，说明区块连续，保存到主链")])]),t._v(" "),v("li",[v("p",[t._v("4.MG==BG-1，MH!=BPH，说明网络分叉，处理同第2步")])]),t._v(" "),v("li",[v("p",[t._v("5.MG<BG-1，说明网络分叉，处理同第2步")])]),t._v(" "),v("li",[v("p",[t._v("6.MG>BG，说明网络分叉，处理同第2步")])])]),t._v(" "),v("p",[t._v("高度差1000以内缓存到磁盘，磁盘空间做大小限制，超出高度则丢弃，缓存空间满则按加入缓存时间顺序清理分叉链。\n如果是正常运行时，收到其他节点转发的区块，发现分叉了要通知共识模块给生成这个区块的节点红牌惩罚，系统启动后的同步过程中不做这个判断")]),t._v(" "),v("p",[v("img",{attrs:{src:e(615),alt:""}})])]),t._v(" "),v("li",[v("p",[t._v("依赖服务")]),t._v(" "),v("p",[t._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-5-分叉链管理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-分叉链管理","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.5 分叉链管理")])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("功能说明:")]),t._v(" "),e("p",[t._v("判断分叉链与主链是否需要进行切换")])]),t._v(" "),e("li",[e("p",[t._v("流程描述\n​")]),t._v(" "),e("ul",[e("li",[t._v("检查是否有分叉链能链接上主链，如果有则链接")]),t._v(" "),e("li",[t._v("取出最长的一条分叉链与主链长度对比判断是否需要切换主链\n"),e("ul",[e("li",[t._v("如果分叉链长度比主链长度长3（配置）个区块以上则需要切换主链")]),t._v(" "),e("li",[t._v("找到主链与最长分叉链的分叉点")]),t._v(" "),e("li",[t._v("验证分叉链中的区块，如果验证通过继续往下执行")]),t._v(" "),e("li",[t._v("回滚主链区块")]),t._v(" "),e("li",[t._v("切换分叉链为主链")])])])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("p",[_("img",{attrs:{src:e(616),alt:""}})])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("依赖服务")]),this._v(" "),_("p",[this._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-5-孤儿链管理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-孤儿链管理","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.5 孤儿链管理")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-6-转发区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-转发区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.6 转发区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("功能说明:")]),this._v(" "),_("p",[this._v("详细说明")])]),this._v(" "),_("li",[_("p",[this._v("流程描述")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("使用blockHash组装ForwardSmallBlockMessage，发送给目标节点")]),this._v(" "),_("li",[this._v("目标节点收到ForwardSmallBlockMessage后，取出hash判断是否重复，如果不重复，使用hash组装GetSmallBlockMessage发给源节点")]),this._v(" "),_("li",[this._v("源节点收到GetSmallBlockMessage后，取出hash，查询SmallBlock并组装SmallBlockMessage，发给目标节点")]),this._v(" "),_("li",[this._v("后续交互流程参考广播区块")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("依赖服务")]),this._v(" "),_("p",[this._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-7-广播区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-7-广播区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.7 广播区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("功能说明:")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("流程描述")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ol",[e("li",[t._v("根据HASH获取BlockHeader,TxList,组装成SmallBlock，")]),t._v(" "),e("li",[t._v("将一个<SmallBlock.hash,SmallBlock>放入缓存中，若不主动删除，则在缓存存满或者存在时间超过1000秒时，自动清理")]),t._v(" "),e("li",[t._v("组装SmallBlockMessage，调用RPC模块发送消息给目标节点")]),t._v(" "),e("li",[t._v("目标节点收到消息后根据txHashList判断哪些交易本地没有,再组装GetTxGroupRequest发给源节点")]),t._v(" "),e("li",[t._v("源节点收到信息后按照hashlist组装TxGroupMessage,返回给目标节点")]),t._v(" "),e("li",[t._v("至此所有区块数据已经发送给目标节点。")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("依赖服务")]),this._v(" "),_("p",[this._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_2-3-8-区块监控"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-8-区块监控","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3.8 区块监控")])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ul",[e("li",[e("p",[t._v("功能说明:")]),t._v(" "),e("p",[t._v("略")])]),t._v(" "),e("li",[e("p",[t._v("流程描述")]),t._v(" "),e("ul",[e("li",[t._v("启动监控定时任务，每分钟执行一次")]),t._v(" "),e("li",[t._v("取本地最新区块头")]),t._v(" "),e("li",[t._v("验证网络模块是否需要重启（如果本地最新区块3分钟都没有更新过则需要网络模块断开并随机重连），这里区分chainID")])])]),t._v(" "),e("li",[e("p",[t._v("依赖服务")]),t._v(" "),e("p",[t._v("工具模块的数据库存储工具")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"三、事件说明"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#三、事件说明","aria-hidden":"true"}},[this._v("#")]),this._v(" 三、事件说明")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_3-1-发布的事件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-发布的事件","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 发布的事件")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_3-1-1-同步完成"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-同步完成","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1.1 同步完成")])},function(){var t=this.$createElement,_=this._self._c||t;return _("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v("data:{\n    chainId\n    height\n    hash\n}\n")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_3-1-2-保存区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-保存区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1.2 保存区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v("data:{\n    chainId\n    height\n    hash\n}\n")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_3-1-3-回滚区块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-回滚区块","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1.3 回滚区块")])},function(){var t=this.$createElement,_=this._self._c||t;return _("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v("data:{\n    chainId\n    height\n    hash\n}\n")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_3-2-订阅的事件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-订阅的事件","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 订阅的事件")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_3-2-1-网络稳定"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-网络稳定","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2.1 网络稳定")])},function(){var t=this.$createElement,_=this._self._c||t;return _("pre",[_("code",[this._v("data:{\n    chainId\n}\n")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"四、协议"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#四、协议","aria-hidden":"true"}},[this._v("#")]),this._v(" 四、协议")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_4-1-网络通讯协议"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-网络通讯协议","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.1 网络通讯协议")])},function(){var t=this.$createElement,_=this._self._c||t;return _("pre",[_("code",[this._v("参见网络模块\n")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h3",{attrs:{id:"_4-2-消息协议"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-消息协议","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2 消息协议")])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-1-单个摘要消息hashmessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-单个摘要消息hashmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.1 单个摘要消息HashMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"转发区块","孤儿链维护"功能')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("forward,getBlock,getsBlock")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("hash")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("目标节点收到消息后，先根据chainID判断缓存中hash是否重复")]),this._v(" "),_("li",[this._v("如果重复，说明已经收到别的节点转发的SmallBlock，丢弃消息")]),this._v(" "),_("li",[this._v("如果没有重复，用hash组装GetSmallBlockMessage，并发送给源节点")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-2-摘要列表消息hashlistmessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-摘要列表消息hashlistmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.2 摘要列表消息HashListMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"转发区块"功能')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("GetSmallBlock")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("blockHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("hash")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("hash")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据chainID、hash获取SmallBlock对象")]),this._v(" "),_("li",[this._v("组装SmallBlockMessage，并发送给源节点")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-3-区块广播消息smallblockmessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-区块广播消息smallblockmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.3 区块广播消息SmallBlockMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"转发区块"、"广播区块"功能')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（short）")]),this._v(" "),_("p",[this._v("SmallBlock")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("preHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("preHash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("preHash")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("merkleHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("merkleHash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("merkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("时间")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("extendLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("extend数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("extend")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("publicKeyLength")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("公钥数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("publicKey")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("公钥")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("signAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("签名算法类型")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("signBytesLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("签名数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("signBytes")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("签名")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txHashListLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("交易hash列表数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("交易hash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("交易hash")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ol",[e("li",[t._v("判断区块时间戳是否大于(当前时间+10s)，如果大于这个时间，则判定为恶意提前出块，忽略该消息")]),t._v(" "),e("li",[t._v("根据chainID、区块hash判断消息是否重复，如果重复，则忽略该消息(这里要求维护一个集合,按照chainID分类储存收到的区块hash)")]),t._v(" "),e("li",[t._v("根据chainID、区块hash在DB中查询本地是否已经有该区块，如果已经有了，则忽略该消息")]),t._v(" "),e("li",[t._v("验证区块头，验证失败，则忽略该消息")]),t._v(" "),e("li",[t._v("取txHashList，判断那些tx本地没有，组装HashListMessage，发给源节点，获取没有的那些交易信息")]),t._v(" "),e("li",[t._v("如果交易都有，组放入缓存队列，等待验证线程验证后存储")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-4-高度区间消息heightrangemessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-4-高度区间消息heightrangemessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.4 高度区间消息HeightRangeMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"同步区块"功能')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("GetBlocksByHeight")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("startHeight")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("起始高度")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("endHeight")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("结束高度")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("chainID、高度参数验证")]),this._v(" "),_("li",[this._v("返回响应消息ReactMessage")]),this._v(" "),_("li",[this._v("从endHeight开始查找Block,组装BlockMessage，发给目标节点")]),this._v(" "),_("li",[this._v("查找到startHeight为止，组装CompleteMessage，发给目标节点")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-5-完整的区块消息blockmessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-5-完整的区块消息blockmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.5 完整的区块消息BlockMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"区块同步"')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("Block")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("preHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("preHash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("preHash")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("merkleHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("merkleHash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("merkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("time")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("时间")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("height")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("extendLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("extend数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("extend")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("publicKeyLength")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("公钥数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("publicKey")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("公钥")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("signAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("签名算法类型")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("signBytesLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("签名数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("signBytes")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("区块签名")])]),t._v(" "),e("tr",[e("td",[t._v("16")]),t._v(" "),e("td",[t._v("type")]),t._v(" "),e("td",[t._v("uint16")]),t._v(" "),e("td",[t._v("交易类型")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("time")]),t._v(" "),e("td",[t._v("uint48")]),t._v(" "),e("td",[t._v("交易时间")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("remarkLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("备注数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("remark")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("备注")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("转出记录数")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromAssetsChainId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产发行链的id")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromAssetsId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产id")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("fromAddress")]),t._v(" "),e("td",[t._v("VarChar")]),t._v(" "),e("td",[t._v("转出账户地址")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("amount")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("转出金额")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("nonce")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("交易顺序号，递增")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("转入记录数")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toAssetsChainId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产发行链的id")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toAssetsId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产id")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("toAddress")]),t._v(" "),e("td",[t._v("VarChar")]),t._v(" "),e("td",[t._v("转入账户地址")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("amount")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("转入金额")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("lockTIme")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("锁定时间")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txData")]),t._v(" "),e("td",[t._v("T")]),t._v(" "),e("td",[t._v("交易数据")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txSignLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("交易签名数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txSign")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("交易签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("放入缓存队列")]),this._v(" "),_("li",[this._v("等待其他区块同步中")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-6-请求完成消息completemessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-6-请求完成消息completemessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.6 请求完成消息CompleteMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息说明:通用消息，用于异步请求，标志异步请求处理结束。")])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("Complete")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("HashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("Hash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("Hash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("Hash")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("success")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("成功标志")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ol",[_("li",[this._v("根据chainID、hash查找源节点缓存的异步请求，把处理结果标志设置为完成。")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h4",{attrs:{id:"_4-2-7-交易列表的消息txgroupmessage"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-7-交易列表的消息txgroupmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2.7 交易列表的消息TxGroupMessage")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v('消息说明:用于"转发区块"')])]),this._v(" "),_("li",[_("p",[this._v("消息类型（cmd）")]),this._v(" "),_("p",[this._v("TxGroup")])]),this._v(" "),_("li",[_("p",[this._v("消息的格式（messageBody）")])])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("table",[e("thead",[e("tr",[e("th",[t._v("Length")]),t._v(" "),e("th",[t._v("Fields")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Remark")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("chainID")]),t._v(" "),e("td",[t._v("uint32")]),t._v(" "),e("td",[t._v("链ID")])]),t._v(" "),e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[t._v("digestAlgType")]),t._v(" "),e("td",[t._v("byte")]),t._v(" "),e("td",[t._v("摘要算法标识")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("requestHashLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("requestHash数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("requestHash")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("requestHash")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("16")]),t._v(" "),e("td",[t._v("type")]),t._v(" "),e("td",[t._v("uint16")]),t._v(" "),e("td",[t._v("交易类型")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("time")]),t._v(" "),e("td",[t._v("uint48")]),t._v(" "),e("td",[t._v("交易时间")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("remarkLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("备注数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("remark")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("备注")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("转出记录数")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromAssetsChainId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产发行链的id")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("fromAssetsId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产id")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("fromAddress")]),t._v(" "),e("td",[t._v("VarChar")]),t._v(" "),e("td",[t._v("转出账户地址")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("amount")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("转出金额")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("nonce")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("交易顺序号，递增")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toCount")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("转入记录数")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toAssetsChainId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产发行链的id")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("toAssetsId")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("资产id")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("toAddress")]),t._v(" "),e("td",[t._v("VarChar")]),t._v(" "),e("td",[t._v("转入账户地址")])]),t._v(" "),e("tr",[e("td",[t._v("48")]),t._v(" "),e("td",[t._v("amount")]),t._v(" "),e("td",[t._v("Uint48")]),t._v(" "),e("td",[t._v("转入金额")])]),t._v(" "),e("tr",[e("td",[t._v("32")]),t._v(" "),e("td",[t._v("lockTIme")]),t._v(" "),e("td",[t._v("Uint32")]),t._v(" "),e("td",[t._v("锁定时间")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txData")]),t._v(" "),e("td",[t._v("T")]),t._v(" "),e("td",[t._v("交易数据")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txSignLength")]),t._v(" "),e("td",[t._v("VarInt")]),t._v(" "),e("td",[t._v("交易签名数组长度")])]),t._v(" "),e("tr",[e("td",[t._v("?")]),t._v(" "),e("td",[t._v("txSign")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("交易签名")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[_("p",[this._v("消息的验证")]),this._v(" "),_("p",[this._v("略")])]),this._v(" "),_("li",[_("p",[this._v("消息的处理逻辑")]),this._v(" "),_("p",[this._v("略")])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"五、模块配置"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#五、模块配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 五、模块配置")])},function(){var t=this.$createElement,_=this._self._c||t;return _("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[this._v('{\n    {\n        "name": "validBlockInterval",\n        "remark": "为阻止恶意节点提前出块，设置此参数，区块时间戳大于当前时间多少就丢弃该区块",\n        "readOnly": "true",\n        "value": "1000"\n    },\n    {\n        "name": "blockCache",\n        "remark": "同步区块时最多缓存多少个区块",\n        "readOnly": "true",\n        "value": "1000"\n    },\n    {\n        "name": "smallBlockCache",\n        "remark": "系统正常运行时最多缓存多少个从别的节点接收到的小区块",\n        "readOnly": "true",\n        "value": "100"\n    },\n    {\n        "name": "chainSwtichThreshold",\n        "remark": "分叉链切换为主链的高度差阈值",\n        "readOnly": "true",\n        "value": "1"\n    },\n    {\n        "name": "chainName",\n        "remark": "链名称",\n        "readOnly": "true",\n        "value": "nuls"\n    },\n    {\n        "name": "serverIp",\n        "remark": "服务ip",\n        "readOnly": "true",\n        "value": "127.0.0.1"\n    },\n    {\n        "name": "serverPort",\n        "remark": "服务端口",\n        "readOnly": "true",\n        "value": ""\n    },\n    {\n        "name": "blockMaxSize",\n        "remark": "区块大小最大值",\n        "readOnly": "false",\n        "value": "3145728"\n    },\n    {\n        "name": "resetTime",\n        "remark": "持续多长时间区块高度没有更新时，就重新获取可用节点",\n        "readOnly": "true",\n        "value": "180"\n    },\n    {\n        "name": "cacheSize",\n        "remark": "分叉链、孤儿链缓存区块最大数量",\n        "readOnly": "true",\n        "value": "10000"\n    },\n    {\n        "name": "heightRange",\n        "remark": "缓存到分叉链的高度区间",\n        "readOnly": "false",\n        "value": "1000"\n    },\n    {\n        "name": "maxRollback",\n        "remark": "每次最多回滚多少区块",\n        "readOnly": "true",\n        "value": "20"\n    },\n    {\n        "name": "consistencyNodePercent",\n        "remark": "一致可用节点最低比例，低于此数不同步区块",\n        "readOnly": "false",\n        "value": "80"\n    },\n    {\n        "name": "minNodeAmount",\n        "remark": "最小可用节点个数，低于此数不同步区块",\n        "readOnly": "false",\n        "value": "1"\n    },\n    {\n        "name": "downloadNumber",\n        "remark": "同步时，每次从一个节点下载多少区块",\n        "readOnly": "true",\n        "value": "20"\n    },\n    {\n        "name": "orphanChainMaxAge",\n        "remark": "孤儿链最大年龄",\n        "readOnly": "true",\n        "value": "10"\n    },\n    {\n        "name": "extendMaxSize",\n        "remark": "区块头扩展字段最大值",\n        "readOnly": "false",\n        "value": "1024"\n    }\n}\n\n')])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"六、java特有的设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#六、java特有的设计","aria-hidden":"true"}},[this._v("#")]),this._v(" 六、Java特有的设计")])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("Block对象设计")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("thead",[_("tr",[_("th",[_("code",[this._v("字段名称")])]),this._v(" "),_("th",[_("code",[this._v("字段类型")])]),this._v(" "),_("th",[_("code",[this._v("说明")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("tr",[_("td",[this._v("blockHeader")]),this._v(" "),_("td",[this._v("BlockHeader")]),this._v(" "),_("td",[this._v("区块头")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("SmallBlock对象设计")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("thead",[_("tr",[_("th",[_("code",[this._v("字段名称")])]),this._v(" "),_("th",[_("code",[this._v("字段类型")])]),this._v(" "),_("th",[_("code",[this._v("说明")])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("tr",[_("td",[this._v("blockHeader")]),this._v(" "),_("td",[this._v("BlockHeader")]),this._v(" "),_("td",[this._v("区块头")])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("BlockHeader对象设计")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("blockquote",[e("table",[e("thead",[e("tr",[e("th",[e("code",[t._v("字段名称")])]),t._v(" "),e("th",[e("code",[t._v("字段类型")])]),t._v(" "),e("th",[e("code",[t._v("说明")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("hash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("preHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("上一区块HASH")])]),t._v(" "),e("tr",[e("td",[t._v("merkleHash")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块MerkleHash")])]),t._v(" "),e("tr",[e("td",[t._v("height")]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[t._v("区块高度")])]),t._v(" "),e("tr",[e("td",[t._v("time")]),t._v(" "),e("td",[t._v("long")]),t._v(" "),e("td",[t._v("区块打包时间")])]),t._v(" "),e("tr",[e("td",[t._v("txCount")]),t._v(" "),e("td",[t._v("short")]),t._v(" "),e("td",[t._v("交易数")])]),t._v(" "),e("tr",[e("td",[t._v("packingAddress")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("打包地址")])]),t._v(" "),e("tr",[e("td",[t._v("extend")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("扩展字段")])]),t._v(" "),e("tr",[e("td",[t._v("blockSignature")]),t._v(" "),e("td",[t._v("BlockSignature")]),t._v(" "),e("td",[t._v("区块签名")])])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("ul",[_("li",[this._v("BlockSignature对象设计")])])},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("blockquote",[e("table",[e("thead",[e("tr",[e("th",[e("code",[t._v("字段名称")])]),t._v(" "),e("th",[e("code",[t._v("字段类型")])]),t._v(" "),e("th",[e("code",[t._v("说明")])])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("signData")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[t._v("区块签名")])]),t._v(" "),e("tr",[e("td",[t._v("publicKey")]),t._v(" "),e("td",[t._v("byte[]")]),t._v(" "),e("td",[t._v("公钥")])])])])])},function(){var t=this.$createElement,_=this._self._c||t;return _("h2",{attrs:{id:"七、补充内容"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#七、补充内容","aria-hidden":"true"}},[this._v("#")]),this._v(" 七、补充内容")])}],n=e(0),s=Object(n.a)({},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("[TOC]")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("​\t区块链上所有交易数据都保存在区块中，所以要有一个模块负责区块的存储与管理，以便其他模块对区块中数据进行验证、业务处理时可以获取到区块。")]),t._v(" "),e("p",[t._v("​\t区块链程序初次启动时，需要同步网络上的最新区块到本地，这个过程一般耗时较长，且同步未完成时不能发起交易，所以适合由单独模块来完成该工作。")]),t._v(" "),e("p",[t._v("​\t综上所述，为其他模块提供统一的区块数据服务是必要的，也能更好地把区块的管理与区块的具体业务进行分离，用到区块的模块不必关心区块的获取细节。")]),t._v(" "),t._m(4),t._v(" "),e("p",[t._v("​\t系统启动时，判断本地区块高度是否达到网络上大多数节点的最新高度，如果没有达到，要从网络上下载区块到本地，进行区块的验证，验证通过后，保存到本地数据库，这叫区块的同步。")]),t._v(" "),e("p",[t._v("​\t区块同步完成后，系统开始正常运行，分下面两种情况讨论")]),t._v(" "),t._m(5),t._v(" "),e("p",[t._v("异常情况下，区块验证不通过，新区块无法与主链上最后一个区块相连，则把该区块视为分叉区块或孤儿区块，放入分叉链集合维护。当发现有一条分叉链A比主链B高度更高时，进行链切换，以分叉链A为最新的链\n，原主链B回滚，并进入分叉链集合维护。")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),e("p",[t._v("区块管理是底层模块之一，以下分功能讨论模块依赖情况")]),t._v(" "),e("p",[t._v("依赖")]),t._v(" "),t._m(8),t._v(" "),e("p",[t._v("被依赖")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._v(" "),e("p",[t._v("某个ChainID上的区块同步完成时，更新缓存的同步状态标识。同步区块未完成时，禁止发起交易")]),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._v(" "),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),e("p",[t._v("本地节点共识模块打包后，调用此接口保存区块数据")]),t._v(" "),t._m(77),t._v(" "),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),e("p",[t._v("在链工厂发布一条链后，核心模块会调用区块管理模块的该接口，根据chainID初始化区块、分叉链数据库，开启chainID对应的一系列工作线程，并为运行新链做准备。")]),t._v(" "),t._m(81),t._v(" "),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84),t._v(" "),e("p",[t._v("在链工厂停止一条链后，核心模块会调用区块管理模块的该接口，删除该链的缓存区块、分叉链数据，停止chainID对应的一系列工作线程。")]),t._v(" "),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._v(" "),t._m(89),t._v(" "),t._m(90),t._v(" "),t._m(91),t._v(" "),t._m(92),t._v(" "),t._m(93),t._v(" "),t._m(94),t._v(" "),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._v(" "),t._m(98),t._v(" "),t._m(99),t._v(" "),t._m(100),t._v(" "),t._m(101),t._v(" "),t._m(102),t._v(" "),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._v(" "),t._m(106),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),t._m(109),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._v(" "),t._m(113),t._v(" "),t._m(114),t._v(" "),t._m(115),t._v(" "),t._m(116),t._v(" "),t._m(117),t._v(" "),t._m(118),t._v(" "),e("p",[t._v("说明:同步完成，本地区块高度与网络高度一致时，发布该事件")]),t._v(" "),e("p",[t._v('event_topic : "bl_blockSyncComplete",')]),t._v(" "),t._m(119),t._m(120),t._v(" "),e("p",[t._v("说明:每保存一个区块，发布该事件，初次同步时不发该事件")]),t._v(" "),e("p",[t._v('event_topic : "bl_saveBlock",')]),t._v(" "),t._m(121),t._m(122),t._v(" "),e("p",[t._v("说明:每回滚一个区块，发布该事件")]),t._v(" "),e("p",[t._v('event_topic : "bl_rollbackBlock",')]),t._v(" "),t._m(123),t._m(124),t._v(" "),t._m(125),t._v(" "),e("p",[t._v("说明:网络稳定时，发布该事件")]),t._v(" "),e("p",[t._v('event_topic : "nt_networkDone",')]),t._v(" "),t._m(126),t._v(" "),t._m(127),t._v(" "),t._m(128),t._v(" "),t._m(129),t._v(" "),t._m(130),t._v(" "),t._m(131),t._v(" "),t._m(132),t._v(" "),t._m(133),t._v(" "),t._m(134),t._v(" "),t._m(135),t._v(" "),t._m(136),t._v(" "),t._m(137),t._v(" "),t._m(138),t._v(" "),t._m(139),t._v(" "),t._m(140),t._v(" "),t._m(141),t._v(" "),t._m(142),t._v(" "),t._m(143),t._v(" "),t._m(144),t._v(" "),t._m(145),t._v(" "),t._m(146),t._v(" "),t._m(147),t._v(" "),t._m(148),t._v(" "),t._m(149),t._v(" "),t._m(150),t._v(" "),t._m(151),t._v(" "),t._m(152),t._v(" "),t._m(153),t._v(" "),t._m(154),t._v(" "),t._m(155),t._v(" "),t._m(156),t._v(" "),t._m(157),t._v(" "),t._m(158),t._v(" "),t._m(159),t._v(" "),t._m(160),t._v(" "),t._m(161),t._v(" "),t._m(162),t._v(" "),t._m(163),t._v(" "),t._m(164),t._v(" "),t._m(165),t._v(" "),t._m(166),t._m(167),t._v(" "),t._m(168),t._v(" "),e("blockquote",[e("table",[t._m(169),t._v(" "),e("tbody",[t._m(170),t._v(" "),e("tr",[e("td",[t._v("transactions")]),t._v(" "),e("td",[t._v("List"),e("Transaction")],1),t._v(" "),e("td",[t._v("交易列表")])])])])]),t._v(" "),t._m(171),t._v(" "),e("blockquote",[e("table",[t._m(172),t._v(" "),e("tbody",[t._m(173),t._v(" "),e("tr",[e("td",[t._v("transactions")]),t._v(" "),e("td",[t._v("List"),e("String")],1),t._v(" "),e("td",[t._v("所有交易HASH列表")])]),t._v(" "),e("tr",[e("td",[t._v("subTxList")]),t._v(" "),e("td",[t._v("List"),e("Transaction")],1),t._v(" "),e("td",[t._v("其他节点一定没有的交易(如共识奖励交易、红黄牌交易等)")])])])])]),t._v(" "),t._m(174),t._v(" "),t._m(175),t._v(" "),t._m(176),t._v(" "),t._m(177),t._v(" "),t._m(178)])},v,!1,null,null,null);s.options.__file="blockModuleDesign.md";_.default=s.exports}}]);