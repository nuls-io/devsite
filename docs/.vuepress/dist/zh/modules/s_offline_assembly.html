<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>合约交易离线组装 | 文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="全球AI消费层 - NULS AI 区块链文档">
    <meta name="theme-color" content="#A8D5FF">
    
    <link rel="preload" href="/assets/css/0.styles.c0387eb2.css" as="style"><link rel="preload" href="/assets/js/app.0bafe896.js" as="script"><link rel="preload" href="/assets/js/2.6c3a80b8.js" as="script"><link rel="preload" href="/assets/js/1.22a4e5b0.js" as="script"><link rel="preload" href="/assets/js/151.75a1e1d9.js" as="script"><link rel="prefetch" href="/assets/js/10.18a9796f.js"><link rel="prefetch" href="/assets/js/100.c6dcc4ee.js"><link rel="prefetch" href="/assets/js/101.7d7ebb68.js"><link rel="prefetch" href="/assets/js/102.58666c13.js"><link rel="prefetch" href="/assets/js/103.b682e489.js"><link rel="prefetch" href="/assets/js/104.24bacb02.js"><link rel="prefetch" href="/assets/js/105.3743813e.js"><link rel="prefetch" href="/assets/js/106.73fa77cb.js"><link rel="prefetch" href="/assets/js/107.f42da1f4.js"><link rel="prefetch" href="/assets/js/108.0282c3bd.js"><link rel="prefetch" href="/assets/js/109.ab04f47a.js"><link rel="prefetch" href="/assets/js/11.cb4cdfd8.js"><link rel="prefetch" href="/assets/js/110.a7414102.js"><link rel="prefetch" href="/assets/js/111.c99ec821.js"><link rel="prefetch" href="/assets/js/112.edf30d53.js"><link rel="prefetch" href="/assets/js/113.437a657d.js"><link rel="prefetch" href="/assets/js/114.ca376ebb.js"><link rel="prefetch" href="/assets/js/115.411f17d8.js"><link rel="prefetch" href="/assets/js/116.0be2757f.js"><link rel="prefetch" href="/assets/js/117.ed69432a.js"><link rel="prefetch" href="/assets/js/118.4f7585a0.js"><link rel="prefetch" href="/assets/js/119.bc60f714.js"><link rel="prefetch" href="/assets/js/12.e402ed1a.js"><link rel="prefetch" href="/assets/js/120.79d9e821.js"><link rel="prefetch" href="/assets/js/121.13efa6ca.js"><link rel="prefetch" href="/assets/js/122.767a3b55.js"><link rel="prefetch" href="/assets/js/123.8fe931f3.js"><link rel="prefetch" href="/assets/js/124.6adbbadd.js"><link rel="prefetch" href="/assets/js/125.626cef62.js"><link rel="prefetch" href="/assets/js/126.3dda9445.js"><link rel="prefetch" href="/assets/js/127.d62c90cb.js"><link rel="prefetch" href="/assets/js/128.c961670a.js"><link rel="prefetch" href="/assets/js/129.04de186a.js"><link rel="prefetch" href="/assets/js/13.847fb38c.js"><link rel="prefetch" href="/assets/js/130.e922ba04.js"><link rel="prefetch" href="/assets/js/131.e463809b.js"><link rel="prefetch" href="/assets/js/132.ddd02961.js"><link rel="prefetch" href="/assets/js/133.c0020aa7.js"><link rel="prefetch" href="/assets/js/134.a3f3bb32.js"><link rel="prefetch" href="/assets/js/135.8e4807f7.js"><link rel="prefetch" href="/assets/js/136.5cc7c540.js"><link rel="prefetch" href="/assets/js/137.9353bd9b.js"><link rel="prefetch" href="/assets/js/138.5e65b123.js"><link rel="prefetch" href="/assets/js/139.bdd7d1bc.js"><link rel="prefetch" href="/assets/js/14.0ebe191f.js"><link rel="prefetch" href="/assets/js/140.baee8264.js"><link rel="prefetch" href="/assets/js/141.cab83fae.js"><link rel="prefetch" href="/assets/js/142.2fccba43.js"><link rel="prefetch" href="/assets/js/143.6523903e.js"><link rel="prefetch" href="/assets/js/144.01c779f4.js"><link rel="prefetch" href="/assets/js/145.2017a624.js"><link rel="prefetch" href="/assets/js/146.d1de5a16.js"><link rel="prefetch" href="/assets/js/147.3b9d5abc.js"><link rel="prefetch" href="/assets/js/148.78a96ee0.js"><link rel="prefetch" href="/assets/js/149.ccd1442e.js"><link rel="prefetch" href="/assets/js/15.5ecc9329.js"><link rel="prefetch" href="/assets/js/150.c65eee6a.js"><link rel="prefetch" href="/assets/js/152.604fb4c8.js"><link rel="prefetch" href="/assets/js/153.93cfc5c0.js"><link rel="prefetch" href="/assets/js/154.d99114ee.js"><link rel="prefetch" href="/assets/js/155.168bfbc5.js"><link rel="prefetch" href="/assets/js/156.8b012700.js"><link rel="prefetch" href="/assets/js/157.3bd2e91d.js"><link rel="prefetch" href="/assets/js/158.041258e2.js"><link rel="prefetch" href="/assets/js/159.95e86c15.js"><link rel="prefetch" href="/assets/js/16.8d31e076.js"><link rel="prefetch" href="/assets/js/160.87143748.js"><link rel="prefetch" href="/assets/js/161.8593a3b4.js"><link rel="prefetch" href="/assets/js/162.b395549c.js"><link rel="prefetch" href="/assets/js/163.a2aa4a1d.js"><link rel="prefetch" href="/assets/js/17.4840b3c9.js"><link rel="prefetch" href="/assets/js/18.cefe558e.js"><link rel="prefetch" href="/assets/js/19.8e262afc.js"><link rel="prefetch" href="/assets/js/20.adeac68c.js"><link rel="prefetch" href="/assets/js/21.77d8c04a.js"><link rel="prefetch" href="/assets/js/22.a9f26a79.js"><link rel="prefetch" href="/assets/js/23.18ea5f72.js"><link rel="prefetch" href="/assets/js/24.cd796014.js"><link rel="prefetch" href="/assets/js/25.fb08cb66.js"><link rel="prefetch" href="/assets/js/26.5c949c09.js"><link rel="prefetch" href="/assets/js/27.2a2d4831.js"><link rel="prefetch" href="/assets/js/28.e0e4c4fb.js"><link rel="prefetch" href="/assets/js/29.b7521a49.js"><link rel="prefetch" href="/assets/js/3.e8b17741.js"><link rel="prefetch" href="/assets/js/30.ab6b748a.js"><link rel="prefetch" href="/assets/js/31.60464bb8.js"><link rel="prefetch" href="/assets/js/32.c95faf86.js"><link rel="prefetch" href="/assets/js/33.7d9d7a3b.js"><link rel="prefetch" href="/assets/js/34.26b92d69.js"><link rel="prefetch" href="/assets/js/35.1eeee0af.js"><link rel="prefetch" href="/assets/js/36.1c7f3048.js"><link rel="prefetch" href="/assets/js/37.9471e7bd.js"><link rel="prefetch" href="/assets/js/38.ec9abedd.js"><link rel="prefetch" href="/assets/js/39.f36e5ab8.js"><link rel="prefetch" href="/assets/js/4.8d532655.js"><link rel="prefetch" href="/assets/js/40.1ea1a444.js"><link rel="prefetch" href="/assets/js/41.8b5b74dd.js"><link rel="prefetch" href="/assets/js/42.04a077c1.js"><link rel="prefetch" href="/assets/js/43.0fe4c703.js"><link rel="prefetch" href="/assets/js/44.b935d6b9.js"><link rel="prefetch" href="/assets/js/45.2b7f5a17.js"><link rel="prefetch" href="/assets/js/46.8bc06ce9.js"><link rel="prefetch" href="/assets/js/47.82a83e28.js"><link rel="prefetch" href="/assets/js/48.6c0f32dd.js"><link rel="prefetch" href="/assets/js/49.029c21dc.js"><link rel="prefetch" href="/assets/js/5.99605394.js"><link rel="prefetch" href="/assets/js/50.e16baf5e.js"><link rel="prefetch" href="/assets/js/51.12ad3e3f.js"><link rel="prefetch" href="/assets/js/52.1ec26d8c.js"><link rel="prefetch" href="/assets/js/53.45cddd06.js"><link rel="prefetch" href="/assets/js/54.2108b43b.js"><link rel="prefetch" href="/assets/js/55.c08c272e.js"><link rel="prefetch" href="/assets/js/56.3bad307d.js"><link rel="prefetch" href="/assets/js/57.867e7ecf.js"><link rel="prefetch" href="/assets/js/58.bf774815.js"><link rel="prefetch" href="/assets/js/59.b8abadae.js"><link rel="prefetch" href="/assets/js/6.290b516c.js"><link rel="prefetch" href="/assets/js/60.61acacb6.js"><link rel="prefetch" href="/assets/js/61.81b74b64.js"><link rel="prefetch" href="/assets/js/62.264c985a.js"><link rel="prefetch" href="/assets/js/63.da901bb6.js"><link rel="prefetch" href="/assets/js/64.dbfc6dec.js"><link rel="prefetch" href="/assets/js/65.5a7bd5da.js"><link rel="prefetch" href="/assets/js/66.d7ebc9ac.js"><link rel="prefetch" href="/assets/js/67.08a9c448.js"><link rel="prefetch" href="/assets/js/68.50931544.js"><link rel="prefetch" href="/assets/js/69.e1c822fc.js"><link rel="prefetch" href="/assets/js/7.bfe2d576.js"><link rel="prefetch" href="/assets/js/70.640a1bf0.js"><link rel="prefetch" href="/assets/js/71.b22c16f7.js"><link rel="prefetch" href="/assets/js/72.bcdbc9a2.js"><link rel="prefetch" href="/assets/js/73.232c9381.js"><link rel="prefetch" href="/assets/js/74.8dd848c9.js"><link rel="prefetch" href="/assets/js/75.5b39d848.js"><link rel="prefetch" href="/assets/js/76.339f1901.js"><link rel="prefetch" href="/assets/js/77.fd812ad4.js"><link rel="prefetch" href="/assets/js/78.59c9582b.js"><link rel="prefetch" href="/assets/js/79.b4588cba.js"><link rel="prefetch" href="/assets/js/80.d20b7f7f.js"><link rel="prefetch" href="/assets/js/81.0de2e426.js"><link rel="prefetch" href="/assets/js/82.8fa26f1a.js"><link rel="prefetch" href="/assets/js/83.8cbb912a.js"><link rel="prefetch" href="/assets/js/84.a1b83b1c.js"><link rel="prefetch" href="/assets/js/85.4237db2a.js"><link rel="prefetch" href="/assets/js/86.4b6842e9.js"><link rel="prefetch" href="/assets/js/87.0290cd66.js"><link rel="prefetch" href="/assets/js/88.ad25d269.js"><link rel="prefetch" href="/assets/js/89.e34aa4b2.js"><link rel="prefetch" href="/assets/js/90.b9ad822e.js"><link rel="prefetch" href="/assets/js/91.4d2cd6d0.js"><link rel="prefetch" href="/assets/js/92.321d2cde.js"><link rel="prefetch" href="/assets/js/93.cec650ad.js"><link rel="prefetch" href="/assets/js/94.732e613a.js"><link rel="prefetch" href="/assets/js/95.b93723c8.js"><link rel="prefetch" href="/assets/js/96.c9532164.js"><link rel="prefetch" href="/assets/js/97.23e04641.js"><link rel="prefetch" href="/assets/js/98.c5b31a70.js"><link rel="prefetch" href="/assets/js/99.d3eae370.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.811c81b7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0387eb2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/logo.svg" alt="文档" class="logo"> <span class="site-name can-hide">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/user-guide/" class="nav-link">
  用户指南
</a></div><div class="nav-item"><a href="/zh/chain-api/" class="nav-link">
  API接口
</a></div><div class="nav-item"><a href="/zh/dapp-builder/" class="nav-link">
  DApp开发
</a></div><div class="nav-item"><a href="/zh/chain-builder/" class="nav-link">
  构建链
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link router-link-active">
  模块
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/s_offline_assembly.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/modules/s_offline_assembly.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/user-guide/" class="nav-link">
  用户指南
</a></div><div class="nav-item"><a href="/zh/chain-api/" class="nav-link">
  API接口
</a></div><div class="nav-item"><a href="/zh/dapp-builder/" class="nav-link">
  DApp开发
</a></div><div class="nav-item"><a href="/zh/chain-builder/" class="nav-link">
  构建链
</a></div><div class="nav-item"><a href="/zh/modules/" class="nav-link router-link-active">
  模块
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/s_offline_assembly.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/modules/s_offline_assembly.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>⚙️ 核心模块</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/modules/" aria-current="page" class="sidebar-link">⚙️ 核心模块</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>🏗️ 设计文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>📋 实现指南</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>🔧 系统工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/modules/s_offline_assembly.html" aria-current="page" class="active sidebar-link">合约交易离线组装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#前提" class="sidebar-link">前提</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-java-sdk" class="sidebar-link">1. Java SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-1-引入mavan依赖" class="sidebar-link">1.1 引入Mavan依赖</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-2-sdk初始化" class="sidebar-link">1.2 SDK初始化</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-3-发布合约离线交易" class="sidebar-link">1.3 发布合约离线交易</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-4-调用合约离线交易" class="sidebar-link">1.4 调用合约离线交易</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-5-删除合约离线交易" class="sidebar-link">1.5 删除合约离线交易</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_1-6-调用合约-向合约转入跨链资产" class="sidebar-link">1.6 调用合约 - 向合约转入跨链资产</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_2-java-离线组装合约交易代码详解" class="sidebar-link">2. Java - 离线组装合约交易代码详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_2-1-发布合约的交易" class="sidebar-link">2.1 发布合约的交易</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_2-2-调用合约的交易" class="sidebar-link">2.2 调用合约的交易</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_2-3-删除合约的交易" class="sidebar-link">2.3 删除合约的交易</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_3-javascript-sdk" class="sidebar-link">3. JavaScript SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_3-1-创建合约" class="sidebar-link">3.1 创建合约</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_3-2-调用合约" class="sidebar-link">3.2 调用合约</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_3-3-删除合约" class="sidebar-link">3.3 删除合约</a></li><li class="sidebar-sub-header"><a href="/zh/modules/s_offline_assembly.html#_3-4-调用合约-向合约转入跨链资产" class="sidebar-link">3.4 调用合约 - 向合约转入跨链资产</a></li></ul></li></ul></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="合约交易离线组装"><a href="#合约交易离线组装" class="header-anchor">#</a> 合约交易离线组装</h1> <h2 id="前提"><a href="#前提" class="header-anchor">#</a> 前提</h2> <ul><li><p>使用者: 不使用节点API创建交易，即私钥保存在本地的用户</p></li> <li><p>离线与在线的区别</p> <ul><li><p>离线: 私钥保存在本地</p></li> <li><p>在线: 私钥保存在节点上</p></li></ul></li></ul> <p><strong>智能合约有三种要组装的交易，分别是<code>发布合约</code>、<code>调用合约</code>、<code>删除合约</code>，下面将使用<code>Java</code>语言和<code>JavaScript</code>语言分别介绍这三种交易的离线组装方式</strong></p> <blockquote><p>文档中使用 <strong><code>NRC20合约代码</code></strong> 作为示例</p></blockquote> <h2 id="_1-java-sdk"><a href="#_1-java-sdk" class="header-anchor">#</a> 1. Java SDK</h2> <h3 id="_1-1-引入mavan依赖"><a href="#_1-1-引入mavan依赖" class="header-anchor">#</a> 1.1 引入Mavan依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- JDK11环境下 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.nuls.v2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sdk4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- JDK8环境下 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.nuls.v2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sdk4j-jdk8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_1-2-sdk初始化"><a href="#_1-2-sdk初始化" class="header-anchor">#</a> 1.2 SDK初始化</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 测试网SDK初始化</span>
<span class="token class-name">NulsSDKBootStrap</span><span class="token punctuation">.</span><span class="token function">initTest</span><span class="token punctuation">(</span><span class="token string">&quot;http://beta.api.nuls.io/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 主网SDK初始化</span>
<span class="token class-name">NulsSDKBootStrap</span><span class="token punctuation">.</span><span class="token function">initMain</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.nuls.io/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-3-发布合约离线交易"><a href="#_1-3-发布合约离线交易" class="header-anchor">#</a> 1.3 发布合约离线交易</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">String</span> alias <span class="token operator">=</span> <span class="token string">&quot;nrc20_token&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractCode <span class="token operator">=</span> <span class="token string">&quot;504b03040a0000080000....&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;air&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AIR&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过) - 验证发布合约的合法性，可不验证</span>
    <span class="token class-name">ContractValidateCreateForm</span> vForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateCreateForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setContractCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token constant">MAX_GASLIMIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vForm<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token constant">CONTRACT_MINIMUM_PRICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractCreate</span><span class="token punctuation">(</span>vForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span>vResult<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> vMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> vMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> vMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过) - 估算发布合约需要的GAS，可不估算，离线写一个合理的值</span>
    <span class="token class-name">ImputedGasContractCreateForm</span> iForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImputedGasContractCreateForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setContractCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> iResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">imputedContractCreateGas</span><span class="token punctuation">(</span>iForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>iResult<span class="token punctuation">)</span><span class="token punctuation">,</span> iResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> iResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过) - 获取代码的构造函数，生成参数类型的数组，若已知类型，自行编写类型数组，可不调用此接口</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContractConstructorInfoDto</span><span class="token punctuation">&gt;</span></span> constructorR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>constructorR<span class="token punctuation">)</span><span class="token punctuation">,</span> constructorR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ContractConstructorInfoDto</span> dto <span class="token operator">=</span> constructorR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsType <span class="token operator">=</span> dto<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">argsType2Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(不可跳过，一定要调用的接口) - 获取账户余额信息</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 组装发布合约的离线交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOfflineR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">createContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> contractCode<span class="token punctuation">,</span> gasLimit<span class="token punctuation">,</span> args<span class="token punctuation">,</span> argsType<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOfflineR<span class="token punctuation">)</span><span class="token punctuation">,</span> txOfflineR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> txOfflineR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;contractAddress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 签名交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口 - 广播交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcastTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcastTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s, contractAddress: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> contractAddress<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-4-调用合约离线交易"><a href="#_1-4-调用合约离线交易" class="header-anchor">#</a> 1.4 调用合约离线交易</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">callTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>main_chain_id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> value <span class="token operator">=</span> <span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token constant">ZERO</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaN3xDUFWonWsfsuG4kJKy2WajtjZbuB&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodDesc <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;tNULSeBaMnrs6JKrCy6TQdzYJZkMZJDng7QAsD&quot;</span><span class="token punctuation">,</span> <span class="token number">3800</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_call_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过) - 验证调用合约的合法性，可不验证</span>
    <span class="token class-name">ContractValidateCallForm</span> validateCallForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateCallForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span><span class="token constant">MAX_GASLIMIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token constant">CONTRACT_MINIMUM_PRICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    validateCallForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractCall</span><span class="token punctuation">(</span>validateCallForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>vResult<span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过) - 估算调用合约需要的GAS，可不估算，离线写一个合理的值</span>
    <span class="token class-name">ImputedGasContractCallForm</span> iForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImputedGasContractCallForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iForm<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> iResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">imputedContractCallGas</span><span class="token punctuation">(</span>iForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>iResult<span class="token punctuation">)</span><span class="token punctuation">,</span> iResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> iResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> assetChainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_chain_id<span class="token punctuation">;</span>
    <span class="token keyword">int</span> assetId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_asset_id<span class="token punctuation">;</span>
    <span class="token comment">// 在线接口(可跳过) - 生成参数类型的数组，若已知类型，自行编写类型数组，可不调用此接口</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argsType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ContractMethodForm</span> cFrom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractMethodForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cFrom<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Result</span> cResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getContractMethodArgsTypes</span><span class="token punctuation">(</span>cFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>cResult<span class="token punctuation">)</span><span class="token punctuation">,</span> cResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> cResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        argsType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
        argsType <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>argsType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在线接口(不可跳过，一定要调用的接口) - 获取账户余额信息</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 组装调用合约的离线交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOfflineR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">callContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> value<span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> gasLimit<span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> methodDesc<span class="token punctuation">,</span> args<span class="token punctuation">,</span> argsType<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOfflineR<span class="token punctuation">)</span><span class="token punctuation">,</span> txOfflineR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> txMap <span class="token operator">=</span> txOfflineR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 签名交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口 - 广播交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcaseTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcaseTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcaseTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcaseTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-5-删除合约离线交易"><a href="#_1-5-删除合约离线交易" class="header-anchor">#</a> 1.5 删除合约离线交易</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteTxOffline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>main_chain_id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token class-name">String</span> contractAddress <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaN2YfwVSBCwf35CgD5HtKa5gYGmLgCK&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> remark <span class="token operator">=</span> <span class="token string">&quot;remark_delete_test&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(可跳过）- 验证删除合约的合法性，可不验证</span>
    <span class="token class-name">ContractValidateDeleteForm</span> dForm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContractValidateDeleteForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dForm<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dForm<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Result</span> vResult <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">validateContractDelete</span><span class="token punctuation">(</span>dForm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>vResult<span class="token punctuation">)</span><span class="token punctuation">,</span> vResult<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> vResult<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口(不可跳过，一定要调用的接口) - 获取账户余额信息</span>
    <span class="token keyword">int</span> assetChainId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_chain_id<span class="token punctuation">;</span>
    <span class="token keyword">int</span> assetId <span class="token operator">=</span> <span class="token class-name">SDKContext</span><span class="token punctuation">.</span>nuls_asset_id<span class="token punctuation">;</span>
    <span class="token class-name">Result</span> accountBalanceR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">getAccountBalance</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>accountBalanceR<span class="token punctuation">)</span><span class="token punctuation">,</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> balance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> accountBalanceR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nonce <span class="token operator">=</span> balance<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 组装删除合约的离线交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> txOffline <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">deleteContractTxOffline</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> remark<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>txOffline<span class="token punctuation">)</span><span class="token punctuation">,</span> txOffline<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> txMap <span class="token operator">=</span> txOffline<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> txHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> txMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 离线接口 - 签名交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> signTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>txHex<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> priKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>signTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> signTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> resultData <span class="token operator">=</span> signTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> _hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> _hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> signedTxHex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> resultData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;txHex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在线接口 - 广播交易</span>
    <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> broadcastTxR <span class="token operator">=</span> <span class="token class-name">NulsSDKTool</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>signedTxHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token class-name">JSONUtils</span><span class="token punctuation">.</span><span class="token function">obj2PrettyJson</span><span class="token punctuation">(</span>broadcastTxR<span class="token punctuation">)</span><span class="token punctuation">,</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span> data <span class="token operator">=</span> broadcastTxR<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> hash1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;hash不一致&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">,</span> hash1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;hash: %s&quot;</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-6-调用合约-向合约转入跨链资产"><a href="#_1-6-调用合约-向合约转入跨链资产" class="header-anchor">#</a> 1.6 调用合约 - 向合约转入跨链资产</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-sdk4j/blob/master/src/test/java/io/nuls/v2/service/ContractServiceTest.java</code></p> <p>函数名是<code>callTxWithMultyAssetOffline</code>和<code>callTxWithMultyAssetOffline2</code></p> <h2 id="_2-java-离线组装合约交易代码详解"><a href="#_2-java-离线组装合约交易代码详解" class="header-anchor">#</a> 2. Java - 离线组装合约交易代码详解</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 主链的ID，示例中使用2</span>
<span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// 主链的资产ID，示例中使用1</span>
<span class="token keyword">int</span> assetsId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-1-发布合约的交易"><a href="#_2-1-发布合约的交易" class="header-anchor">#</a> 2.1 发布合约的交易</h3> <p>组装发布合约的交易需要与apiModule交互四次</p> <ul><li>获取构造函数</li> <li>验证发布合约的执行合法性</li> <li>预估发布合约需要的GAS</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>, <code>合约代码字节码的Hex字符串</code>, <code>合约别名</code>, <code>交易备注</code></strong></p> <h4 id="_2-1-1-调用接口获取合约代码构造函数"><a href="#_2-1-1-调用接口获取合约代码构造函数" class="header-anchor">#</a> 2.1.1) 调用接口获取合约代码构造函数</h4> <ul><li><p>接口: getContractConstructor</p></li> <li><p>参数: chainId, contractCode</p> <p>chainId : int //链ID</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractConstructor&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;constructor&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(String name, String symbol, BigInteger initialAmount, int decimals) return void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BigInteger&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;initialAmount&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;decimals&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span>
               <span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token property">&quot;returnArg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;payable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;isNrc20&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-2-根据构造函数参数组装参数数据-若是无参函数-则跳过此步"><a href="#_2-1-2-根据构造函数参数组装参数数据-若是无参函数-则跳过此步" class="header-anchor">#</a> 2.1.2) 根据构造函数参数组装参数数据(<strong>若是无参函数，则跳过此步</strong>)</h4> <ul><li><p>把构造函数的参数类型组装成一个字符串数组</p> <blockquote><p>从<code>getContractConstructor</code>接口中得到此类数据</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Map</span> constructor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;args&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    argTypes<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 此例中 argTypes 包含四个元素 {&quot;String&quot;, &quot;String&quot;, &quot;BigInteger&quot;, &quot;int&quot;}</span>
</code></pre></div></li> <li><p>使用一维Object数组，按顺序，把参数添加到数组中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;nulsIsEverything&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NULS&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>把参数一维数组转换为二维数组(由于链上合约方法参数接受的是二维数组，故有此步)</p> <blockquote><p>复制这个方法<code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code>到离线交易组装工具程序(eg. SDK)中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> <span class="token class-name">ContractUtil</span><span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_2-1-3-调用接口验证发布合约的合法性"><a href="#_2-1-3-调用接口验证发布合约的合法性" class="header-anchor">#</a> 2.1.3) 调用接口验证发布合约的合法性</h4> <ul><li><p>接口: validateContractCreate</p></li> <li><p>参数: chainId, sender, gasLimit, price, contractCode, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>gasLimit: long // gas限制</p> <p>price: long // gas单价</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit和price使用默认值: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCreate&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_2-1-4-调用接口预估发布合约需要的gas"><a href="#_2-1-4-调用接口预估发布合约需要的gas" class="header-anchor">#</a> 2.1.4) 调用接口预估发布合约需要的GAS</h4> <ul><li><p>接口: imputedContractCreateGas</p></li> <li><p>参数: chainId, sender, contractCode, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCreateGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">22363</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Long</span> gasLimit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-1-5-随机生成一个智能合约地址"><a href="#_2-1-5-随机生成一个智能合约地址" class="header-anchor">#</a> 2.1.5) 随机生成一个智能合约地址</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Address</span> contract <span class="token operator">=</span> <span class="token class-name">AccountTool</span><span class="token punctuation">.</span><span class="token function">createContractAddress</span><span class="token punctuation">(</span>chainId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contractAddressBytes <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">getAddressBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// String contractAddress = contract.toString();</span>
</code></pre></div><h4 id="_2-1-6-通过以上5步获取的数据-组装交易的txdata"><a href="#_2-1-6-通过以上5步获取的数据-组装交易的txdata" class="header-anchor">#</a> 2.1.6) 通过以上5步获取的数据，组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit 从第4步接口中得到</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">22363</span><span class="token punctuation">;</span>
<span class="token comment">// 默认GAS单价, 系统最小单价</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token class-name">CreateContractData</span> createContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-7-调用接口获取交易创建者的nonce值"><a href="#_2-1-7-调用接口获取交易创建者的nonce值" class="header-anchor">#</a> 2.1.7) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-1-8-通过以上7步获取的数据-组装发布合约的交易对象"><a href="#_2-1-8-通过以上7步获取的数据-组装发布合约的交易对象" class="header-anchor">#</a> 2.1.8) 通过以上7步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CreateContractTransaction</span> <span class="token function">newCreateTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">CreateContractData</span> createContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">CreateContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> createContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">CoinData</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">ContractData</span> contractData<span class="token punctuation">,</span> <span class="token keyword">int</span> txSize<span class="token punctuation">,</span> <span class="token keyword">int</span> txDataSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> gasUsed <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getGasLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> imputedValue <span class="token operator">=</span> <span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">LongUtils</span><span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>gasUsed<span class="token punctuation">,</span> contractData<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 总花费</span>
    <span class="token class-name">BigInteger</span> value <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigInteger</span> totalValue <span class="token operator">=</span> imputedValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CoinFrom</span> coinFrom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinFrom</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> totalValue<span class="token punctuation">,</span> <span class="token class-name">RPCUtil</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    coinData<span class="token punctuation">.</span><span class="token function">addFrom</span><span class="token punctuation">(</span>coinFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token constant">ZERO</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CoinTo</span> coinTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinTo</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getContractAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        coinData<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>coinTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">BigInteger</span> fee <span class="token operator">=</span> <span class="token class-name">TransactionFeeCalculator</span><span class="token punctuation">.</span><span class="token function">getNormalUnsignedTxFee</span><span class="token punctuation">(</span>txSize <span class="token operator">+</span> txDataSize <span class="token operator">+</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    totalValue <span class="token operator">=</span> totalValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>senderBalance<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Insufficient balance</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Insufficient balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    coinFrom<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coinData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calcSize</span><span class="token punctuation">(</span><span class="token class-name">NulsData</span> nulsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nulsData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> nulsData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算tx.size()时，当coinData和txData为空时，计算了1个长度，若此时nulsData不为空，则要扣减这1个长度</span>
    <span class="token keyword">return</span> <span class="token class-name">VarInt</span><span class="token punctuation">.</span><span class="token function">sizeOf</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">+</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-1-9-签名交易、广播交易-略"><a href="#_2-1-9-签名交易、广播交易-略" class="header-anchor">#</a> 2.1.9) 签名交易、广播交易（略）</h4> <hr> <h3 id="_2-2-调用合约的交易"><a href="#_2-2-调用合约的交易" class="header-anchor">#</a> 2.2 调用合约的交易</h3> <p>组装调用合约的交易需要与apiModule交互三<code>or</code>四次</p> <ul><li>获取合约方法的详细信息(若缓存了合约所有方法的详情，则跳过此步)</li> <li>验证调用合约的执行合法性</li> <li>预估调用合约需要的GAS</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>,<code>合约地址</code>,<code>调用者向合约地址转入的主网资产金额</code>,<code>调用方法名</code>,<code>调用方法的描述</code>, <code>调用方法的参数</code>, <code>交易备注</code></strong></p> <h4 id="_2-2-1-调用接口获取合约方法的参数类型列表-若缓存了合约所有方法的详情-可从缓存的方法中提取方法的参数类型列表-则跳过此步"><a href="#_2-2-1-调用接口获取合约方法的参数类型列表-若缓存了合约所有方法的详情-可从缓存的方法中提取方法的参数类型列表-则跳过此步" class="header-anchor">#</a> 2.2.1) 调用接口获取合约方法的参数类型列表**(若缓存了合约所有方法的详情，可从缓存的方法中提取方法的参数类型列表，则跳过此步)**</h4> <blockquote><p>这一步的作用是得到方法的参数类型数组，具体筛选的数据请查看<code>1.2.2</code></p></blockquote> <ul><li><p>接口: getContractMethodArgsTypes</p></li> <li><p>参数: chainId, contractAddress, methodName, methodDesc</p> <p>chainId : int //链ID</p> <p>contractAddress: String //合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述  (非必填)，若合约内方法没有重载，则此参数可以为空</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractMethodArgsTypes&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(Address to, BigInteger value) return boolean&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;Address&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;BigInteger&quot;</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-2-根据函数参数组装参数数据-若是无参函数-则跳过此步"><a href="#_2-2-2-根据函数参数组装参数数据-若是无参函数-则跳过此步" class="header-anchor">#</a> 2.2.2) 根据函数参数组装参数数据(<strong>若是无参函数，则跳过此步</strong>)</h4> <ul><li><p>把函数的参数类型组装成一个字符串数组</p> <blockquote><p>从<code>1.2.1</code>接口中得到此类数据 或者 从缓存的方法详情中获取</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
argTypes <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 此例中 argTypes 包含两个元素 {&quot;Address&quot;, &quot;BigInteger&quot;}</span>
</code></pre></div></li> <li><p>使用一维Object数组，按顺序，把参数添加到数组中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Object</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;tNULSeBaMnrs6JKrCy6TQdzYJZkMZJDng7QAsD&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>把参数一维数组转换为二维数组(由于链上合约方法参数接受的是二维数组，故有此步)</p> <blockquote><p>复制这个方法<code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code>到离线交易组装工具程序(eg. SDK)中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> <span class="token class-name">ContractUtil</span><span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_2-2-3-调用接口验证调用合约的合法性"><a href="#_2-2-3-调用接口验证调用合约的合法性" class="header-anchor">#</a> 2.2.3) 调用接口验证调用合约的合法性</h4> <ul><li><p>接口: validateContractCall</p></li> <li><p>参数: chainId, sender, value, gasLimit, price, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>value: BigInteger // 调用者向合约地址转入的主网资产金额，没有此业务时填BigInteger.ZERO</p> <p>gasLimit: long // gas限制</p> <p>price: long // gas单价</p> <p>contractAddress: String // 合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述，若合约内方法没有重载，则此参数可以为空</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit和price使用默认值: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCall&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_2-2-4-调用接口预估调用合约需要的gas"><a href="#_2-2-4-调用接口预估调用合约需要的gas" class="header-anchor">#</a> 2.2.4) 调用接口预估调用合约需要的GAS</h4> <ul><li><p>接口: imputedContractCallGas</p></li> <li><p>参数: chainId, sender, value, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>value: BigInteger // 调用者向合约地址转入的主网资产金额，没有此业务时填BigInteger.ZERO</p> <p>contractAddress: String // 合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述，若合约内方法没有重载，则此参数可以为空</p> <p>args: Object[] // 方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCallGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>

</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">10333</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-5-通过以上4步获取的数据-组装交易的txdata"><a href="#_2-2-5-通过以上4步获取的数据-组装交易的txdata" class="header-anchor">#</a> 2.2.5) 通过以上4步获取的数据，组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit 从第4步接口中得到</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">10333</span><span class="token punctuation">;</span>
<span class="token comment">// 默认GAS单价, 系统最小单价</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token comment">// value - 交易创建者转入合约地址的主链资产金额，没有此业务时填BigInteger.ZERO</span>
<span class="token comment">// methodName - 交易创建者选择要调用的合约方法</span>
<span class="token comment">// methodDesc - 通过contractInfo获取，若合约内方法没有重载，则此参数可以为空</span>
<span class="token class-name">CallContractData</span> callContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-6-调用接口获取交易创建者的nonce值"><a href="#_2-2-6-调用接口获取交易创建者的nonce值" class="header-anchor">#</a> 2.2.6) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-2-7-通过以上6步获取的数据-组装发布合约的交易对象"><a href="#_2-2-7-通过以上6步获取的数据-组装发布合约的交易对象" class="header-anchor">#</a> 2.2.7) 通过以上6步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CallContractTransaction</span> <span class="token function">newCallTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">CallContractData</span> callContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">CallContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> callContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-2-8-签名交易、广播交易-略"><a href="#_2-2-8-签名交易、广播交易-略" class="header-anchor">#</a> 2.2.8) 签名交易、广播交易（略）</h4> <hr> <h3 id="_2-3-删除合约的交易"><a href="#_2-3-删除合约的交易" class="header-anchor">#</a> 2.3 删除合约的交易</h3> <p>组装删除合约的交易需要与apiModule交互两次</p> <ul><li>验证调用合约的执行合法性</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>,<code>合约地址</code></strong></p> <h4 id="_2-3-1-调用接口验证删除合约的合法性"><a href="#_2-3-1-调用接口验证删除合约的合法性" class="header-anchor">#</a> 2.3.1) 调用接口验证删除合约的合法性</h4> <ul><li><p>接口: validateContractDelete</p></li> <li><p>参数: chainId, sender, contractAddress</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>contractAddress: String // 合约地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractDelete&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_2-3-2-组装交易的txdata"><a href="#_2-3-2-组装交易的txdata" class="header-anchor">#</a> 2.3.2) 组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
<span class="token class-name">String</span> sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> <span class="token class-name">AddressTool</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DeleteContractData</span> deleteContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="_2-3-3-调用接口获取交易创建者的nonce值"><a href="#_2-3-3-调用接口获取交易创建者的nonce值" class="header-anchor">#</a> 2.3.3) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">BigInteger</span> senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-3-4-通过以上3步获取的数据-组装发布合约的交易对象"><a href="#_2-3-4-通过以上3步获取的数据-组装发布合约的交易对象" class="header-anchor">#</a> 2.3.4) 通过以上3步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DeleteContractTransaction</span> <span class="token function">newDeleteTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> <span class="token class-name">BigInteger</span> senderBalance<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">DeleteContractData</span> deleteContractData<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeleteContractTransaction</span> tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        <span class="token class-name">CoinData</span> coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> deleteContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-3-5-签名交易、广播交易-略"><a href="#_2-3-5-签名交易、广播交易-略" class="header-anchor">#</a> 2.3.5) 签名交易、广播交易（略）</h4> <h2 id="_3-javascript-sdk"><a href="#_3-javascript-sdk" class="header-anchor">#</a> 3. JavaScript SDK</h2> <blockquote><p>本语言里，我们已经开发了JS-SDK，内部已经实现离线组装智能合约交易</p></blockquote> <p><strong>GitHub地址:</strong> <a href="https://github.com/nuls-io/nuls-v2-js-sdk" target="_blank" rel="noopener noreferrer">NULS-v2-JS-SDK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_3-1-创建合约"><a href="#_3-1-创建合约" class="header-anchor">#</a> 3.1 创建合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCreateTest.js</code></p> <h3 id="_3-2-调用合约"><a href="#_3-2-调用合约" class="header-anchor">#</a> 3.2 调用合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCallTest.js</code></p> <h3 id="_3-3-删除合约"><a href="#_3-3-删除合约" class="header-anchor">#</a> 3.3 删除合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractDeleteTest.js</code></p> <h3 id="_3-4-调用合约-向合约转入跨链资产"><a href="#_3-4-调用合约-向合约转入跨链资产" class="header-anchor">#</a> 3.4 调用合约 - 向合约转入跨链资产</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCallOfMultyAssetsTest1.js</code></p> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCallOfMultyAssetsTest2.js</code></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/master/docs/zh/modules/s_offline_assembly.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2025/9/1 09:45:12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/modules/i_transaction.html" class="prev">
        交易模块
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0bafe896.js" defer></script><script src="/assets/js/2.6c3a80b8.js" defer></script><script src="/assets/js/1.22a4e5b0.js" defer></script><script src="/assets/js/151.75a1e1d9.js" defer></script>
  </body>
</html>
